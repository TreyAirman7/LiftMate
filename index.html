<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: blob: https://images.unsplash.com; script-src 'self' 'unsafe-inline';">
    <title>LiftMate - Workout Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* Mobile Navigation Menu */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--card-color, #1a202c);
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
            z-index: 99;
            padding: 0.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mobile-nav-tabs {
            display: flex;
            justify-content: space-around;
        }
        
        .mobile-nav-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            color: rgba(255, 255, 255, 0.7); /* Light color with opacity for better contrast on dark backgrounds */
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
        }
        
        .mobile-nav-tab i {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }
        
        .mobile-nav-tab.active {
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .mobile-nav {
                display: block;
            }
            
            body {
                padding-bottom: 60px; /* Accommodate the mobile nav bar */
            }
            
            .container {
                margin-bottom: 1rem;
            }
        }
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
        }
        
        body {
            line-height: 1.6;
            font-family: 'Poppins', sans-serif;
            scroll-behavior: smooth;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color, #00d0ff);
            border-radius: 10px;
        }
        
        /* Workout Start Options - Main UI for template-focused approach */
        .workout-start-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Individual workout option card styling */
        .start-option {
            flex: 1;
            min-width: 200px;
            background: var(--card-color-alt, #1e2636);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .start-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Color-coding for different workout options */
        .start-option.template-option {
            border-left: 4px solid var(--primary-color, #00d0ff); /* Blue for templates */
        }
        
        .start-option.quick-option {
            border-left: 4px solid var(--secondary-color, #ff9a3c); /* Orange for quick workouts */
        }
        
        .start-option.timer-option {
            border-left: 4px solid var(--tertiary-color, #ff5c8d); /* Pink for timer workouts */
        }
        
        .option-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary-color, #00d0ff);
        }
        
        .start-option.quick-option .option-icon {
            color: var(--secondary-color, #ff9a3c);
        }
        
        .start-option.timer-option .option-icon {
            color: var(--tertiary-color, #ff5c8d);
        }
        
        .start-option h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .start-option p {
            margin-bottom: 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .option-button {
            background: transparent;
            border: 2px solid var(--primary-color, #00d0ff);
            color: var(--primary-color, #00d0ff);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-button:hover {
            background: var(--primary-color, #00d0ff);
            color: var(--bg-dark, #121824);
        }
        
        .quick-option .option-button {
            border-color: var(--secondary-color, #ff9a3c);
            color: var(--secondary-color, #ff9a3c);
        }
        
        .quick-option .option-button:hover {
            background: var(--secondary-color, #ff9a3c);
            color: var(--bg-dark, #121824);
        }
        
        .timer-option .option-button {
            border-color: var(--tertiary-color, #ff5c8d);
            color: var(--tertiary-color, #ff5c8d);
        }
        
        .timer-option .option-button:hover {
            background: var(--tertiary-color, #ff5c8d);
            color: var(--bg-dark, #121824);
        }
        
        .primary-button {
            background: var(--primary-color, #00d0ff);
            color: var(--bg-dark, #121824);
        }
        
        .primary-button:hover {
            background: var(--primary-color-dark, #00a8cc);
        }
        
        .secondary-button {
            background: transparent;
            border: 2px solid var(--text-muted);
            color: var(--text-muted);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .secondary-button:hover {
            background: var(--text-muted);
            color: var(--bg-dark, #121824);
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .workout-start-options {
                flex-direction: column;
            }
            
            .start-option {
                width: 100%;
            }
        }
        
        /* Template Cards Styling */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .template-card {
            background: var(--card-color-alt, #1e2636);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid var(--primary-color, #00d0ff);
        }
        
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .template-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .template-card-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .template-card-actions {
            display: flex;
            gap: 8px;
        }
        
        .template-card-actions button {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .template-card-actions button:hover {
            color: var(--primary-color);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .edit-template:hover {
            color: var(--secondary-color, #ff9a3c) !important;
        }
        
        .delete-template:hover {
            color: var(--tertiary-color, #ff5c8d) !important;
        }
        
        .template-card-info {
            flex-grow: 1;
            margin-bottom: 15px;
        }
        
        .template-date {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .template-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 5px;
        }
        
        .template-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .start-template-workout {
            background: var(--primary-color, #00d0ff);
            color: var(--bg-dark, #121824);
            border: none;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .start-template-workout:hover {
            background: var(--primary-color-dark, #00a8cc);
        }
        
        .empty-templates {
            text-align: center;
            padding: 30px;
            background: var(--card-color-alt, #1e2636);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .empty-icon {
            font-size: 3rem;
            color: var(--text-muted);
            margin-bottom: 15px;
        }
        
        .template-search {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .search-input-container {
            position: relative;
            flex-grow: 1;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        #template-search {
            padding: 10px 15px 10px 40px;
            background: var(--card-color-alt, #1e2636);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.9); /* Light color for better contrast on dark backgrounds */
            width: 100%;
        }
        
        #template-sort {
            padding: 10px 15px;
            background: var(--card-color-alt, #1e2636);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.9); /* Light color for better contrast on dark backgrounds */
        }
        
        .template-description {
            color: var(--text-muted);
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .template-search {
                flex-direction: column;
            }
            
            .template-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Enhanced Template Modal Styles */
        .template-selector-content {
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .primary-action-button {
            background: var(--primary-color, #00d0ff);
            color: var(--bg-dark, #121824);
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .primary-action-button:hover {
            background: var(--primary-color-dark, #00a8cc);
        }
        
        .secondary-action-button {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .secondary-action-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .template-selector-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color, #e100ff);
        }
        
        header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 1.5rem 0;
            position: relative;
            border-bottom-width: 2px;
            border-bottom-style: solid;
            border-image: linear-gradient(to right, transparent, var(--primary-color, #00d0ff), var(--secondary-color, #e100ff), transparent) 1;
        }
        
        header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }
        
        header .subtitle {
            opacity: 0.8;
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 0.5px;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .card {
            position: relative;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: var(--box-shadow, 0 8px 32px rgba(0, 0, 0, 0.2));
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover, 0 12px 48px rgba(0, 0, 0, 0.3));
        }
        
        .card h2 {
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            position: relative;
            font-weight: 700;
        }
        
        .card h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--gradient-primary, linear-gradient(90deg, var(--primary-color), var(--secondary-color)));
            border-radius: 3px;
        }
        
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
            
            header {
                margin-bottom: 1.5rem;
                padding: 1rem 0;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 1.25rem;
            }
            
            .summary-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
                margin-bottom: 1.5rem;
            }
            
            .summary-card {
                padding: 1rem;
            }
            
            .summary-value {
                font-size: 1.8rem;
            }
            
            .filter-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 1.5rem;
                max-height: 85vh;
            }
        }
        
        @media (max-width: 480px) {
            .summary-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .workout-detail {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }
        
        form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            position: relative;
        }
        
        label {
            font-weight: 500;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            font-size: 0.95rem;
        }
        
        label i {
            margin-right: 0.5rem;
            opacity: 0.7;
        }
        
        input, select, textarea {
            padding: 0.9rem 1rem;
            font-size: 1rem;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-family: inherit;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            width: 100%;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 0, 208, 255), 0.25);
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            input, select, textarea {
                padding: 0.75rem 1rem;
                font-size: 16px; /* Prevents iOS zoom on focus */
            }
            
            button {
                padding: 0.75rem 1.25rem;
                width: 100%;
                min-height: 44px; /* Apple's recommended minimum touch target size */
            }
            
            /* Make date inputs more touch friendly */
            input[type="date"] {
                min-height: 44px;
            }
        }
        
        button i {
            font-size: 1.1rem;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .workout-list {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .workout-item {
            padding: 1.25rem;
            border-radius: 10px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .workout-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.75rem;
        }
        
        .workout-title {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .workout-detail {
            font-size: 1rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .workout-item {
                padding: 1rem;
            }
            
            .workout-action {
                top: 0.5rem;
                right: 0.5rem;
            }
            
            .workout-action button {
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0;
                font-size: 1rem;
            }
            
            .workout-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .workout-title {
                font-size: 1.1rem;
                margin-right: 2.5rem; /* Space for action buttons */
            }
            
            .workout-date {
                font-size: 0.9rem;
            }
            
            .workout-detail {
                font-size: 0.9rem;
            }
            
            .workout-notes {
                font-size: 0.9rem;
                padding: 0.5rem 0.5rem 0.5rem 1rem;
            }
            
            .share-workout-btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }
        
        .workout-notes {
            background: rgba(255,255,255,0.05);
            padding: 0.75rem 0.75rem 0.75rem 1.25rem;
            border-radius: 8px;
            font-style: italic;
            margin-top: 0.5rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--primary-color, #00d0ff);
            position: relative;
        }
        
        .note-icon {
            opacity: 0.5;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            position: absolute;
            left: 0.5rem;
            top: 0.75rem;
        }
        
        .tag-icon {
            margin-right: 0.25rem;
        }
        
        .workout-action {
            position: absolute;
            top: 0.7rem;
            right: 0.7rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .share-workout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            background: rgba(255,255,255,0.1);
            border: none;
            color: inherit;
            cursor: pointer;
            transition: all 0.3s;
            width: auto;
        }
        
        .share-workout-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .summary-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }
        
        .summary-card {
            border-radius: 15px;
            padding: 1.75rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color, #00d0ff), var(--secondary-color, #e100ff));
        }
        
        .summary-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.75rem;
            line-height: 1.1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .summary-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
            opacity: 0.8;
        }
        
        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease-in-out;
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            padding: 2.5rem;
            border-radius: 20px;
            width: 95%;
            max-width: 550px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.4s forwards;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 1.25rem;
            right: 1.25rem;
            font-size: 1.75rem;
            cursor: pointer;
            height: 36px;
            width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
            background: rgba(255,255,255,0.1);
        }
        
        @media (max-width: 768px) {
            .modal-content {
                padding: 1.5rem;
                width: 90%;
                max-height: 80vh;
                border-radius: 15px;
            }
            
            .close-modal {
                top: 1rem;
                right: 1rem;
                height: 44px;
                width: 44px;
            }
            
            /* Bottom sheet style for modals on mobile */
            .modal.bottom-sheet {
                align-items: flex-end;
            }
            
            .modal.bottom-sheet .modal-content {
                border-radius: 20px 20px 0 0;
                max-height: 90vh;
                width: 100%;
                margin-bottom: 0;
                animation: modalSlideUp 0.3s forwards;
            }
            
            @keyframes modalSlideUp {
                from {
                    transform: translateY(100%);
                }
                to {
                    transform: translateY(0);
                }
            }
        }
        
        .close-modal:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }
        
        .chart-container {
            margin-top: 2rem;
            height: 300px;
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        /* Theme switcher */
        .theme-switcher {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 100;
            display: flex;
            gap: 0.5rem;
        }
        
        .theme-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .theme-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .theme-button.active {
            transform: scale(1.2);
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px currentColor;
        }
        
        @media (max-width: 768px) {
            .theme-switcher {
                top: auto;
                bottom: calc(60px + 1rem); /* Above the mobile nav */
                right: 0.5rem;
                flex-direction: column;
            }
            
            .theme-button {
                width: 30px;
                height: 30px;
                border-width: 1px;
            }
        }
        
        #theme-dark {
            background: linear-gradient(45deg, #00d0ff, #e100ff);
            color: #00d0ff;
        }
        
        #theme-nature {
            background: linear-gradient(45deg, #2e7d32, #81c784);
            color: #2e7d32;
        }
        
        #theme-futuristic {
            background: linear-gradient(45deg, #00d0ff, #0066ff, #ff00c8);
            color: #00d0ff;
        }
        
        #theme-retro {
            background: linear-gradient(45deg, #ff5277, #ffb74d);
            color: #ff5277;
        }
        
        /* DARK THEME */
        .theme-dark {
            --primary-color: #00d0ff;
            --secondary-color: #e100ff;
            --primary-rgb: 0, 208, 255;
            --secondary-rgb: 225, 0, 255;
            --dark-color: #0f1218;
            --card-color: #1a202c;
            --text-color: #e2e8f0;
            --text-muted: #a0aec0;
            --danger-color: #ff4d4d;
            --success-color: #48bb78;
            --warning-color: #f6ad55;
            --info-color: #4299e1;
            --card-border: rgba(255,255,255,0.05);
            --input-bg: rgba(255,255,255,0.05);
            --gradient-primary: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            --box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --box-shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.3);
        }
        
        .theme-dark body {
            background-color: var(--dark-color);
            color: var(--text-color);
        }
        
        .theme-dark header {
            border-bottom: 2px solid var(--primary-color);
        }
        
        .theme-dark header h1 {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .theme-dark .subtitle {
            color: var(--text-muted);
        }
        
        .theme-dark .card {
            background: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            padding: 1.5rem;
            border: 1px solid var(--card-border);
        }
        
        .theme-dark .card h2 {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .theme-dark label {
            color: var(--text-muted);
        }
        
        .theme-dark input, 
        .theme-dark select, 
        .theme-dark textarea {
            background-color: var(--input-bg);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-color);
        }
        
        .theme-dark input:focus, 
        .theme-dark select:focus, 
        .theme-dark textarea:focus {
            border-color: var(--primary-color);
            background-color: rgba(255,255,255,0.08);
        }
        
        .theme-dark button {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .theme-dark button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .theme-dark .workout-item {
            background: rgba(255,255,255,0.03);
            border-left: 4px solid;
            border-image: linear-gradient(to bottom, var(--primary-color), var(--secondary-color)) 1;
        }
        
        .theme-dark .workout-title {
            color: white;
        }
        
        .theme-dark .workout-date {
            color: var(--text-muted);
        }
        
        .theme-dark .workout-detail {
            color: var(--text-muted);
        }
        
        .theme-dark .btn-icon {
            color: var(--text-muted);
            background: none;
        }
        
        .theme-dark .btn-icon:hover {
            color: white;
            background: none;
        }
        
        .theme-dark .empty-state {
            color: var(--text-muted);
            background: rgba(255,255,255,0.03);
        }
        
        .theme-dark .tag {
            border-radius: 20px;
            text-transform: uppercase;
        }
        
        .theme-dark .tag.cardio {
            background: linear-gradient(45deg, #ff4b2b, #ff416c);
            color: white;
        }
        
        .theme-dark .tag.strength {
            background: linear-gradient(45deg, #32c5ff, #0077ff);
            color: white;
        }
        
        .theme-dark .tag.flexibility {
            background: linear-gradient(45deg, #a145ff, #7e57c2);
            color: white;
        }
        
        .theme-dark .tag.other {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
            color: #1a1a1a;
        }
        
        .theme-dark .summary-card {
            background: rgba(255,255,255,0.05);
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .theme-dark .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .theme-dark .summary-value {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .theme-dark .summary-label {
            color: var(--text-color);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .theme-dark .modal {
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        
        .theme-dark .modal-content {
            background-color: var(--card-color);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .theme-dark .close-modal {
            color: var(--text-muted);
        }
        
        .theme-dark .close-modal:hover {
            color: white;
        }
        
        .theme-dark .chart-container {
            background: var(--card-color);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        /* NATURE THEME */
        .theme-nature {
            --primary-color: #2e7d32;
            --secondary-color: #81c784;
            --accent-color: #ffb74d;
            --dark-color: #1b5e20;
            --light-color: #f1f8e9;
            --text-color: #33691e; /* Dark green for text on light backgrounds */
            --card-bg: rgba(255, 255, 255, 0.9);
            --text-muted: #1b5e20; /* Darkened from #558b2f for better contrast */
        }
        
        .theme-nature body {
            background-image: linear-gradient(rgba(241, 248, 233, 0.9), rgba(241, 248, 233, 0.9)), 
                              url('https://images.unsplash.com/photo-1501870190084-cdf29f15ef87?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-attachment: fixed;
            color: var(--text-color);
        }
        
        .theme-nature header {
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .theme-nature header h1 {
            color: var(--primary-color);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        
        .theme-nature .subtitle {
            color: var(--dark-color);
            opacity: 0.8;
        }
        
        .theme-nature .card {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            padding: 2rem;
            border: 1px solid rgba(129, 199, 132, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .theme-nature .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .theme-nature .card h2 {
            color: var(--primary-color);
            border-bottom: 1px solid rgba(129, 199, 132, 0.3);
        }
        
        .theme-nature label {
            color: var(--dark-color);
        }
        
        .theme-nature input, 
        .theme-nature select, 
        .theme-nature textarea {
            border: 1px solid rgba(129, 199, 132, 0.4);
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .theme-nature input:focus, 
        .theme-nature select:focus, 
        .theme-nature textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
        }
        
        .theme-nature button {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .theme-nature button:hover {
            background-color: var(--dark-color);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .theme-nature .workout-item {
            background: rgba(255, 255, 255, 0.7);
            border-left: 4px solid var(--primary-color);
        }
        
        .theme-nature .workout-title {
            color: var(--dark-color);
        }
        
        .theme-nature .workout-date {
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .theme-nature .btn-icon {
            color: var(--dark-color);
            background: none;
            box-shadow: none;
        }
        
        .theme-nature .btn-icon:hover {
            background: none;
            transform: scale(1.1);
            box-shadow: none;
        }
        
        .theme-nature .empty-state {
            color: var(--text-color);
            opacity: 0.7;
            background: rgba(255, 255, 255, 0.6);
        }
        
        .theme-nature .tag {
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .theme-nature .tag.cardio {
            background-color: #ffcc80;
            color: #e65100;
        }
        
        .theme-nature .tag.strength {
            background-color: #a5d6a7;
            color: #1b5e20;
        }
        
        .theme-nature .tag.flexibility {
            background-color: #90caf9;
            color: #0d47a1;
        }
        
        .theme-nature .tag.other {
            background-color: #b39ddb;
            color: #4a148c;
        }
        
        .theme-nature .summary-card {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 8px 20px rgba(46, 125, 50, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .theme-nature .summary-value {
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .theme-nature .summary-label {
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            color: white;
        }
        
        .theme-nature .modal {
            background-color: rgba(27, 94, 32, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .theme-nature .modal-content {
            background-color: var(--card-bg);
            box-shadow: 0 15px 50px rgba(0,0,0,0.15);
        }
        
        .theme-nature .close-modal {
            color: var(--text-color);
        }
        
        .theme-nature .chart-container {
            background: var(--card-bg);
            border: 1px solid rgba(129, 199, 132, 0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        /* FUTURISTIC THEME */
        .theme-futuristic {
            --primary-color: #00d0ff;
            --secondary-color: #0066ff;
            --accent-color: #ff00c8;
            --dark-color: #050a24;
            --light-color: #f0f4ff;
            --card-bg: rgba(8, 13, 40, 0.9);
            --card-border: rgba(0, 208, 255, 0.2);
            --text-color: #e0f0ff;
            --text-muted: #8096c2;
            --input-bg: rgba(8, 20, 40, 0.8);
        }
        
        @keyframes gradientAnimation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .theme-futuristic body {
            background: linear-gradient(-45deg, #050a24, #0a1245, #0a2c45, #051b2e);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            color: var(--text-color);
        }
        
        .theme-futuristic header {
            position: relative;
        }
        
        .theme-futuristic header::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }
        
        .theme-futuristic header h1 {
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--primary-color),
                        0 0 20px var(--primary-color),
                        0 0 30px var(--primary-color);
        }
        
        .theme-futuristic .subtitle {
            color: var(--text-muted);
            letter-spacing: 1px;
        }
        
        .theme-futuristic .card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 208, 255, 0.1);
            padding: 2rem;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .theme-futuristic .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color), var(--accent-color));
        }
        
        .theme-futuristic .card h2 {
            color: white;
            padding-bottom: 0.8rem;
            position: relative;
            letter-spacing: 1px;
        }
        
        .theme-futuristic .card h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background: var(--primary-color);
        }
        
        .theme-futuristic label {
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .theme-futuristic input, 
        .theme-futuristic select, 
        .theme-futuristic textarea {
            border: 1px solid rgba(0, 208, 255, 0.3);
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        .theme-futuristic input:focus, 
        .theme-futuristic select:focus, 
        .theme-futuristic textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(0, 208, 255, 0.3);
        }
        
        .theme-futuristic button {
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .theme-futuristic button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }
        
        .theme-futuristic button:hover::before {
            left: 100%;
        }
        
        .theme-futuristic button:hover {
            box-shadow: 0 0 15px var(--primary-color);
        }
        
        .theme-futuristic .workout-item {
            background: rgba(8, 20, 40, 0.7);
            border: 1px solid rgba(0, 208, 255, 0.1);
        }
        
        .theme-futuristic .workout-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(0, 208, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .theme-futuristic .workout-title {
            color: white;
        }
        
        .theme-futuristic .workout-date {
            color: var(--text-color);
        }
        
        .theme-futuristic .btn-icon {
            background: none;
            color: var(--text-color);
        }
        
        .theme-futuristic .btn-icon:hover {
            color: var(--primary-color);
            background: none;
            box-shadow: none;
        }
        
        .theme-futuristic .empty-state {
            color: var(--text-color);
            border: 1px dashed rgba(0, 208, 255, 0.2);
        }
        
        .theme-futuristic .tag {
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .theme-futuristic .tag.cardio {
            background: linear-gradient(90deg, #ff0055, #ff4081);
            color: white;
            box-shadow: 0 0 10px rgba(255, 0, 85, 0.3);
        }
        
        .theme-futuristic .tag.strength {
            background: linear-gradient(90deg, #0066ff, #00d0ff);
            color: white;
            box-shadow: 0 0 10px rgba(0, 102, 255, 0.3);
        }
        
        .theme-futuristic .tag.flexibility {
            background: linear-gradient(90deg, #00c8ff, #00fff0);
            color: #050a24;
            box-shadow: 0 0 10px rgba(0, 200, 255, 0.3);
        }
        
        .theme-futuristic .tag.other {
            background: linear-gradient(90deg, #aa00ff, #ff00c8);
            color: white;
            box-shadow: 0 0 10px rgba(170, 0, 255, 0.3);
        }
        
        .theme-futuristic .summary-card {
            background: rgba(8, 20, 40, 0.8);
            border: 1px solid var(--card-border);
            position: relative;
            overflow: hidden;
        }
        
        .theme-futuristic .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
        }
        
        .theme-futuristic .summary-value {
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(0, 208, 255, 0.5), 0 0 1px rgba(255, 255, 255, 0.3);
        }
        
        .theme-futuristic .summary-label {
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-color);
        }
        
        .theme-futuristic .modal {
            background-color: rgba(5, 10, 36, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .theme-futuristic .modal-content {
            background: var(--card-bg);
            box-shadow: 0 15px 50px rgba(0, 208, 255, 0.2);
            border: 1px solid var(--card-border);
        }
        
        .theme-futuristic .close-modal {
            color: var(--text-muted);
        }
        
        .theme-futuristic .close-modal:hover {
            color: var(--primary-color);
        }
        
        .theme-futuristic .chart-container {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            position: relative;
            overflow: hidden;
        }
        
        .theme-futuristic .chart-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }
        
        /* RETRO THEME */
        .theme-retro {
            --primary-color: #ff5277;
            --secondary-color: #ffb74d;
            --accent-color: #41c7c7;
            --dark-color: #2d2b55;
            --light-color: #fdf7ff;
            --text-color: #ffffff; /* Changed from #2d2b55 to white for contrast against dark backgrounds */
            --text-light: #5c5896;
            --bg-pattern: linear-gradient(135deg, #f5f7fa 25%, transparent 25%) -50px 0, 
                           linear-gradient(225deg, #f5f7fa 25%, transparent 25%) -50px 0, 
                           linear-gradient(315deg, #f5f7fa 25%, transparent 25%), 
                           linear-gradient(45deg, #f5f7fa 25%, transparent 25%);
        }
        
        .theme-retro body {
            background-color: #f9f4ff;
            background-image: var(--bg-pattern);
            background-size: 100px 100px;
            color: #2d2b55; /* Use dark color for text on light backgrounds */
        }
        
        .theme-retro header {
            background-color: var(--dark-color);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 0 #1d1b35;
            padding: 1.5rem;
        }
        
        .theme-retro header h1 {
            color: var(--secondary-color);
            text-shadow: 3px 3px 0 var(--primary-color),
                         6px 6px 0 rgba(0,0,0,0.2);
            letter-spacing: 2px;
            transform: rotate(-2deg);
        }
        
        .theme-retro .subtitle {
            color: #bbb8d4;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
        }
        
        .theme-retro .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 0 #dbd6e9;
            padding: 2rem;
            position: relative;
            border: 3px solid var(--text-color);
        }
        
        /* Make start option text white in Retro theme */
        .theme-retro .start-option h3,
        .theme-retro .start-option p,
        .theme-retro .template-option .option-button,
        .theme-retro .quick-option .option-button,
        .theme-retro .timer-option .option-button {
            color: white;
        }
        
        .theme-retro .card::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px dashed var(--text-light);
            border-radius: 5px;
            opacity: 0.3;
            pointer-events: none;
        }
        
        .theme-retro .card h2 {
            color: var(--primary-color);
            padding-bottom: 0.8rem;
            border-bottom: 4px dotted #e5e1f4;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
        }
        
        .theme-retro label {
            color: #2d2b55; /* Use dark color for labels on light backgrounds */
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'VT323', monospace;
        }
        
        .theme-retro input, 
        .theme-retro select, 
        .theme-retro textarea {
            border: 3px solid var(--text-color);
            background-color: white;
            font-family: 'Courier New', monospace;
            box-shadow: 3px 3px 0 var(--text-color);
        }
        
        .theme-retro input:focus, 
        .theme-retro select:focus, 
        .theme-retro textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 3px 3px 0 var(--primary-color);
        }
        
        .theme-retro button {
            background-color: var(--primary-color);
            color: white;
            border: 3px solid var(--text-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 3px 3px 0 var(--text-color);
            font-family: 'VT323', monospace;
        }
        
        .theme-retro button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 var(--text-color);
        }
        
        .theme-retro button:active {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 var(--text-color);
        }
        
        .theme-retro .workout-item {
            background: white;
            position: relative;
            border: 3px solid var(--text-color);
            box-shadow: 3px 3px 0 var(--text-color);
        }
        
        .theme-retro .workout-item:hover {
            transform: translateY(-5px);
            box-shadow: 5px 8px 0 var(--text-color);
        }
        
        .theme-retro .workout-title {
            color: #2d2b55; /* Use dark color for workout titles on light backgrounds */
            font-family: 'VT323', monospace;
        }
        
        .theme-retro .workout-date {
            color: var(--text-light);
        }
        
        .theme-retro .workout-detail {
            font-family: 'Courier New', monospace;
        }
        
        .theme-retro .btn-icon {
            background: none;
            border: none;
            box-shadow: none;
        }
        
        .theme-retro .btn-icon:hover {
            transform: scale(1.2);
        }
        
        .theme-retro .empty-state {
            color: var(--text-light);
            border: 3px dashed #e5e1f4;
            font-family: 'Courier New', monospace;
        }
        
        .theme-retro .tag {
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            text-transform: uppercase;
            border: 2px solid;
            font-family: 'VT323', monospace;
            letter-spacing: 1px;
        }
        
        .theme-retro .tag.cardio {
            background-color: #ffe1e7;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .theme-retro .tag.strength {
            background-color: #e1f5fe;
            color: #0288d1;
            border-color: #0288d1;
        }
        
        .theme-retro .tag.flexibility {
            background-color: #e8f5e9;
            color: #388e3c;
            border-color: #388e3c;
        }
        
        .theme-retro .tag.other {
            background-color: #fff8e1;
            color: #ffa000;
            border-color: #ffa000;
        }
        
        .theme-retro .summary-card {
            background: white;
            padding: 1.8rem;
            position: relative;
            border: 3px solid var(--text-color);
            box-shadow: 5px 5px 0 var(--text-color);
        }
        
        .theme-retro .summary-card::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            height: 30px;
            background: var(--secondary-color);
            border-radius: 50%;
            z-index: -1;
            border: 3px solid var(--text-color);
        }
        
        .theme-retro .summary-value {
            color: var(--primary-color);
            font-family: 'VT323', monospace;
            text-shadow: 2px 2px 0 var(--text-color);
        }
        
        .theme-retro .summary-label {
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #2d2b55; /* Use dark color for summary labels on white backgrounds */
            font-family: 'Courier New', monospace;
        }
        
        .theme-retro .modal {
            background-color: rgba(45, 43, 85, 0.8);
        }
        
        .theme-retro .modal-content {
            background: white;
            box-shadow: 10px 10px 0 rgba(0,0,0,0.2);
            border: 3px solid var(--text-color);
        }
        
        .theme-retro .close-modal {
            color: var(--primary-color);
        }
        
        .theme-retro .chart-container {
            background: white;
            border: 3px solid var(--text-color);
            box-shadow: 5px 5px 0 var(--text-color);
            position: relative;
        }
        
        .theme-retro .chart-container::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px dashed var(--text-light);
            border-radius: 5px;
            opacity: 0.3;
            pointer-events: none;
        }
        
        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .workout-item {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* Tabs Styling */
        .tabs-container {
            margin-bottom: 2rem;
            position: relative;
        }
        
        .tabs-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 10px 10px 0 0;
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.7;
            position: relative;
            overflow: hidden;
        }
        
        .tab-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .tab-button.active {
            color: var(--text-color);
            background: rgba(255,255,255,0.1);
            opacity: 1;
        }
        
        .tab-button.active::after {
            transform: scaleX(1);
        }
        
        .tab-button:hover {
            opacity: 1;
            background: rgba(255,255,255,0.1);
        }
        
        .tab-button i {
            font-size: 1.1rem;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .tabs-nav {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 0.5rem;
                margin-bottom: 1rem;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .tabs-nav::-webkit-scrollbar {
                display: none;
            }
            
            .tab-button {
                flex: 0 0 auto;
                white-space: nowrap;
            }
        }
        
        /* New Functionality Styles */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            -webkit-overflow-scrolling: touch;
        }
        
        .action-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            justify-content: center;
            min-width: 80px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-wrap: nowrap;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
                max-width: 100%;
            }
            
            .action-button {
                flex: 0 0 auto;
                white-space: nowrap;
                padding: 0.6rem 0.8rem;
            }
        }
        
        .action-button:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .action-icon {
            font-size: 1rem;
            opacity: 0.8;
            transition: all 0.3s;
        }
        
        .action-button:hover .action-icon {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .filter-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex: 1;
        }
        
        .timer-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2.5rem;
            position: relative;
            padding: 2rem;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .timer-time {
            font-size: 4rem;
            font-weight: 700;
            font-family: 'Poppins', monospace;
            margin-bottom: 1.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 5px 15px rgba(var(--primary-rgb), 0.3), 0 0 1px rgba(255, 255, 255, 0.3);
            position: relative;
            letter-spacing: 2px;
        }
        
        .timer-time::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 3px;
        }
        
        .timer-controls {
            display: flex;
            gap: 1.25rem;
            margin-top: 1rem;
            width: 100%;
            justify-content: center;
        }
        
        .timer-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 120px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .timer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .timer-btn:active {
            transform: translateY(0);
        }
        
        .timer-btn.start {
            background: var(--success-color);
            color: white;
        }
        
        .timer-btn.pause {
            background: var(--warning-color);
            color: #333;
        }
        
        .timer-btn.reset {
            background: var(--danger-color);
            color: white;
        }
        
        .timer-btn.save {
            background: var(--info-color);
            color: white;
            margin-top: 1rem;
            width: 100%;
        }
        
        .timer-presets {
            margin-bottom: 1.75rem;
            width: 100%;
        }
        
        .preset-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
            justify-content: center;
        }
        
        .preset-button {
            padding: 0.6rem 1rem;
            flex: 0 1 auto;
            min-width: 85px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-color);
            border-radius: 20px;
            box-shadow: none;
            transition: all 0.3s;
        }
        
        .preset-button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .preset-button.active {
            background: var(--gradient-primary);
            color: white;
            border-color: transparent;
        }
        
        .current-goals {
            margin-top: 2.5rem;
        }
        
        .goal-item {
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            position: relative;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .goal-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .goal-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            align-items: center;
        }
        
        .goal-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .goal-title i {
            opacity: 0.7;
        }
        
        .goal-stats {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .goal-percent {
            background: var(--gradient-primary);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .goal-progress-bar {
            height: 0.6rem;
            width: 100%;
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-top: 0.75rem;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .goal-progress-fill {
            height: 100%;
            border-radius: 10px;
            width: 0%;
            background: var(--gradient-primary);
            transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.5);
        }
        
        .goal-timeframe {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .goal-timeframe i {
            font-size: 0.8rem;
        }
        
        .goal-delete {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            transition: all 0.2s;
            font-size: 1rem;
            border: none;
            color: var(--text-muted);
        }
        
        .goal-delete:hover {
            background: var(--danger-color);
            color: white;
            transform: rotate(90deg);
        }
        
        .import-area {
            padding: 2rem;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 10px;
            text-align: center;
            margin-bottom: 1rem;
        }
        
        #import-file {
            display: none;
        }
        
        /* Statistics Dashboard Styles */
        .stats-time-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .stats-time-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stats-time-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: bold;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stats-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .stats-icon {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .stats-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .stats-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .stats-chart-container {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            height: 250px;
            position: relative;
        }
        
        /* Personal Records Styles */
        .records-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .records-filter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .records-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .record-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
            border-left: 4px solid;
        }
        
        .record-card.strength {
            border-color: #3498db;
        }
        
        .record-card.cardio {
            border-color: #e74c3c;
        }
        
        .record-card.flexibility {
            border-color: #9b59b6;
        }
        
        .record-card.other {
            border-color: #2ecc71;
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .record-title {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .record-category {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .record-category.strength {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        
        .record-category.cardio {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .record-category.flexibility {
            background-color: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }
        
        .record-category.other {
            background-color: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .record-value {
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .record-date {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        
        .record-notes {
            font-style: italic;
            background: rgba(255,255,255,0.05);
            padding: 0.5rem;
            border-radius: 5px;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .record-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .record-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-color);
            transition: color 0.2s;
        }
        
        .record-btn:hover {
            color: var(--primary-color);
        }
        
        .add-record-form {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }
        
        /* Exercise Library Styles */
        .exercise-library-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .exercise-filter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .exercise-search {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .exercise-search input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border-radius: 30px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23a0aec0' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 1rem center;
        }
        
        .exercise-library-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .exercise-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            border-top: 3px solid;
        }
        
        .exercise-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }
        
        .exercise-card.upper {
            border-color: #3498db;
        }
        
        .exercise-card.lower {
            border-color: #e74c3c;
        }
        
        .exercise-card.core {
            border-color: #f1c40f;
        }
        
        .exercise-card.cardio {
            border-color: #2ecc71;
        }
        
        .exercise-card.flexibility {
            border-color: #9b59b6;
        }
        
        .exercise-card.other {
            border-color: #1abc9c;
        }
        
        .exercise-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            padding-right: 1.5rem;
        }
        
        .exercise-muscles {
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            color: var(--text-muted);
        }
        
        .exercise-equipment {
            margin-top: auto;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
            margin-top: 0.5rem;
        }
        
        .exercise-detail {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .back-button {
            margin-bottom: 1rem;
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .back-button:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .exercise-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 1rem;
        }
        
        /* Comparison Feature Styles */
        .comparison-selectors {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
        }
        
        .comparison-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .comparison-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }
        
        .comparison-card h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: var(--text-muted);
        }
        
        .comparison-values {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .period-1-value, .period-2-value {
            font-size: 1.5rem;
            font-weight: bold;
            flex: 1;
        }
        
        .period-1-value {
            color: var(--primary-color);
        }
        
        .period-2-value {
            color: var(--secondary-color);
        }
        
        .comparison-change {
            position: relative;
            padding: 0.5rem;
            border-radius: 5px;
            font-weight: bold;
            margin: 0 1rem;
            min-width: 60px;
            text-align: center;
        }
        
        .comparison-change.positive {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
        }
        
        .comparison-change.negative {
            background: rgba(255, 77, 77, 0.2);
            color: #ff4d4d;
        }
        
        .comparison-change.neutral {
            background: rgba(160, 174, 192, 0.2);
            color: #a0aec0;
        }
        
        .comparison-chart-container {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            height: 300px;
        }
        
        .comparison-insights {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        .comparison-insights h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .comparison-insights ul {
            margin: 0;
            padding: 0 0 0 1.5rem;
        }
        
        .comparison-insights li {
            margin-bottom: 0.5rem;
        }
        
        .custom-dates {
            margin-top: 0.75rem;
            padding: 0.75rem;
            border-radius: 5px;
            background: rgba(255,255,255,0.03);
        }
        
        /* Nutrition Tracker Styles */
        .nutrition-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .nutrition-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 500;
            position: relative;
            transition: all 0.3s;
        }
        
        .nutrition-tab:hover {
            color: var(--text-color);
        }
        
        .nutrition-tab.active {
            color: var(--primary-color);
        }
        
        .nutrition-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .nutrition-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .date-selector button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .date-selector button:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .nutrition-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1rem;
        }
        
        .nutrition-stat {
            text-align: center;
        }
        
        .nutrition-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .nutrition-stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        .meal-sections {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .meal-section {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 1rem;
        }
        
        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .meal-header h4 {
            margin: 0;
        }
        
        .add-food-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 5px;
            padding: 0.5rem 0.75rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .add-food-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .food-items {
            min-height: 50px;
        }
        
        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            animation: fadeIn 0.3s;
        }
        
        .food-item-info {
            flex: 1;
        }
        
        .food-item-name {
            font-weight: 500;
        }
        
        .food-item-serving {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .food-item-macros {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
        }
        
        .food-item-calories {
            font-weight: 600;
        }
        
        .food-item-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .food-item-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }
        
        .food-item-remove:hover {
            color: var(--danger-color);
            transform: scale(1.1);
        }
        
        .nutrition-charts {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .nutrition-chart-container {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 1rem;
            height: 250px;
        }
        
        .nutrition-stats-period {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stats-period-btn {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stats-period-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 500;
        }
        
        .nested-modal {
            position: fixed;
            z-index: 200;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .nested-modal-content {
            background: var(--card-color, #1a202c);
            border-radius: 10px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.4s forwards;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close-nested-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            transition: all 0.2s;
        }
        
        .close-nested-modal:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }
        
        .food-search {
            display: flex;
            margin-bottom: 1rem;
        }
        
        .food-search input {
            flex: 1;
        }
        
        .food-search button {
            margin-left: 0.5rem;
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #food-search-results {
            margin-bottom: 1.5rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .search-result-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-result-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .meal-plan-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .meal-plans-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .meal-plan-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .meal-plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .meal-plan-card h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        
        .meal-plan-description {
            color: var(--text-muted);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .meal-plan-macros {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
        }
        
        .meal-plan-macros div {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .meal-plan-macros i {
            opacity: 0.7;
            font-size: 0.8rem;
        }
        
        .meal-plan-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .meal-plan-actions button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
        }
        
        .meal-plan-actions button:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary-color);
        }
        
        /* Social Sharing Styles */
        .share-preview {
            margin-bottom: 2rem;
        }
        
        .share-card {
            background: linear-gradient(135deg, var(--card-color, #1a202c), #2d3748);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .share-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.75rem;
        }
        
        .share-header h3 {
            margin: 0;
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .share-date {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .share-details {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .share-tag {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .share-notes {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-style: italic;
            border-left: 3px solid var(--primary-color);
        }
        
        .share-footer {
            text-align: center;
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .share-logo {
            font-weight: 700;
            font-size: 1.1rem;
            letter-spacing: 1px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .share-options, .share-platforms {
            margin-bottom: 1.5rem;
        }
        
        .share-options h3, .share-platforms h3 {
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            color: var(--text-muted);
        }
        
        .share-buttons, .platform-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .share-btn, .platform-btn {
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 1.25rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .share-btn:hover, .platform-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        
        .share-btn i, .platform-btn i {
            font-size: 1.1rem;
        }
        
        .platform-btn[data-platform="twitter"] i {
            color: #1DA1F2;
        }
        
        .platform-btn[data-platform="facebook"] i {
            color: #4267B2;
        }
        
        .platform-btn[data-platform="instagram"] i {
            color: #E1306C;
        }
        
        .platform-btn[data-platform="whatsapp"] i {
            color: #25D366;
        }
        
        .platform-btn[data-platform="email"] i {
            color: #EA4335;
        }
        
        .copy-section {
            margin-top: 1.5rem;
        }
        
        #share-content {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-color);
            margin-bottom: 0.75rem;
            font-family: 'Poppins', sans-serif;
            resize: vertical;
        }
        
        #copy-content {
            width: 100%;
        }
        
        .exercise-detail-name {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 1px rgba(226, 232, 240, 0.2);
        }
        
        .exercise-detail-category {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .exercise-detail-category.upper {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        
        .exercise-detail-category.lower {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .exercise-detail-category.core {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        
        .exercise-detail-category.cardio {
            background-color: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .exercise-detail-category.flexibility {
            background-color: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
        }
        
        .exercise-detail-category.other {
            background-color: rgba(26, 188, 156, 0.2);
            color: #1abc9c;
        }
        
        .exercise-detail-section {
            margin-bottom: 1.5rem;
        }
        
        .exercise-detail-section h3 {
            margin-bottom: 0.5rem;
            color: var(--text-muted);
            font-size: 1rem;
        }
        
        .exercise-detail-content {
            background: rgba(255,255,255,0.03);
            padding: 1rem;
            border-radius: 5px;
        }
        
        .exercise-detail-muscles, .exercise-detail-equipment {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .muscle-tag, .equipment-tag {
            background: rgba(255,255,255,0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .muscle-tag {
            background: rgba(52, 152, 219, 0.15);
            color: #3498db;
        }
        
        .equipment-tag {
            background: rgba(46, 204, 113, 0.15);
            color: #2ecc71;
        }
        
        /* Chart styles */
        .chart-wrapper {
            height: 280px;
            position: relative;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        /* Workout Template Styles */
        .template-modal-content {
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .template-exercises {
            margin-top: 1.5rem;
        }
        
        .add-exercise-form {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .set-container {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .set-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            padding: 0.75rem;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .set-item .form-group {
            flex: 1;
        }
        
        .remove-set {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            cursor: pointer;
            font-size: 1.2rem;
            background: none;
            border: none;
            color: var(--text-muted);
        }
        
        .remove-set:hover {
            color: var(--primary-color);
        }
        
        .template-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        #exercise-list {
            margin-top: 1rem;
        }
        
        .exercise-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .exercise-item h4 {
            margin-top: 0;
            margin-bottom: 0.75rem;
            padding-right: 2rem;
        }
        
        .exercise-sets {
            margin-top: 0.75rem;
            padding-left: 1rem;
        }
        
        .exercise-set {
            margin-bottom: 0.5rem;
        }
        
        .remove-exercise {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            cursor: pointer;
            font-size: 1.2rem;
            background: none;
            border: none;
            color: var(--text-muted);
        }
        
        .remove-exercise:hover {
            color: var(--primary-color);
        }
        
        .template-list-container {
            margin: 1.5rem 0;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .template-card {
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .template-card h3 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            padding-right: 3rem;
        }
        
        .template-card-info {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .template-card-exercise-count {
            margin-top: 0.5rem;
            font-weight: 500;
        }
        
        .template-card-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .template-card-actions button {
            background: none;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text-muted);
        }
        
        .template-card-actions button:hover {
            color: var(--primary-color);
        }
        
        .active-template-progress {
            margin: 1.5rem 0;
        }
        
        .progress-container {
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            height: 0.75rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .rest-timer-display {
            text-align: center;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .rest-timer-display h3 {
            margin-top: 0;
            margin-bottom: 1rem;
        }
        
        .active-exercise {
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .active-exercise h3 {
            margin-top: 0;
            margin-bottom: 1rem;
        }
        
        .exercise-notes {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-style: italic;
        }
        
        .set-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .set-number {
            font-weight: bold;
            padding: 0.5rem 0.75rem;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            min-width: 2.5rem;
            text-align: center;
        }
        
        .current-set {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .completed-set {
            background-color: rgba(0, 200, 100, 0.2);
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .active-set-form {
            margin-top: 1.5rem;
        }
        
        .active-set-form .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .active-set-form .form-group {
            flex: 1;
        }
        
        .previous-performance {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        .previous-performance h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .previous-set {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .action-buttons .action-button:nth-child(5) {
            flex: 2;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="theme-switcher">
        <button id="theme-dark" class="theme-button active" title="Dark Theme"></button>
        <button id="theme-nature" class="theme-button" title="Nature Theme"></button>
        <button id="theme-futuristic" class="theme-button" title="Futuristic Theme"></button>
        <button id="theme-retro" class="theme-button" title="Retro Theme"></button>
    </div>
    
    <div class="container">
        <header>
            <h1 id="app-title">LiftMate</h1>
            <p class="subtitle" id="app-subtitle">Track your workouts, monitor progress, achieve goals</p>
        </header>
        
        <div class="summary-container">
            <div class="summary-card">
                <div class="summary-value"><i class="fas fa-dumbbell summary-icon"></i><span id="total-workouts">0</span></div>
                <div class="summary-label">Total Workouts</div>
            </div>
            <div class="summary-card">
                <div class="summary-value"><i class="fas fa-calendar-week summary-icon"></i><span id="this-week">0</span></div>
                <div class="summary-label">This Week</div>
            </div>
            <div class="summary-card">
                <div class="summary-value"><i class="fas fa-fire-alt summary-icon"></i><span id="streak">0</span></div>
                <div class="summary-label">Day Streak</div>
            </div>
            <div class="summary-card">
                <div class="summary-value"><i class="fas fa-tasks summary-icon"></i><span id="goal-progress">0%</span></div>
                <div class="summary-label">Goal Progress</div>
            </div>
        </div>
        
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-button active" data-tab="workouts"><i class="fas fa-dumbbell"></i> Workouts</button>
                <button class="tab-button" data-tab="exercise-library"><i class="fas fa-book"></i> Exercise Library</button>
                <button class="tab-button" data-tab="goals"><i class="fas fa-bullseye"></i> Goals</button>
                <button class="tab-button" data-tab="timer"><i class="fas fa-stopwatch"></i> Timer</button>
                <button class="tab-button" data-tab="stats"><i class="fas fa-chart-line"></i> Statistics</button>
                <button class="tab-button" data-tab="settings"><i class="fas fa-cog"></i> Settings</button>
                <button class="tab-button" data-tab="records"><i class="fas fa-trophy"></i> Records</button>
            </div>

            <!-- Workouts Tab -->
            <div class="tab-content active" id="workouts-tab">
                <div class="app-container">
            <!-- Main workout card with options for starting workouts -->
            <div class="card">
                <h2>Start Workout</h2>
                <!-- Three main workout starting options -->
                <div class="workout-start-options">
                    <!-- Template option (primary recommended option) -->
                    <div class="start-option template-option">
                        <i class="fas fa-clipboard-list option-icon"></i>
                        <h3>Use Template</h3>
                        <p>Start a workout using one of your saved templates</p>
                        <button id="open-templates" class="option-button primary-button"><i class="fas fa-play"></i> Choose Template</button>
                    </div>
                    
                    <!-- Quick workout option for manual entry -->
                    <div class="start-option quick-option">
                        <i class="fas fa-bolt option-icon"></i>
                        <h3>Quick Workout</h3>
                        <p>Start a quick workout without a template</p>
                        <button id="start-quick-workout" class="option-button"><i class="fas fa-plus-circle"></i> New Workout</button>
                    </div>
                    
                    <!-- Timer-based workout option -->
                    <div class="start-option timer-option">
                        <i class="fas fa-stopwatch option-icon"></i>
                        <h3>Timer Workout</h3>
                        <p>Use timer to track your workout duration</p>
                        <button id="open-timer" class="option-button"><i class="fas fa-clock"></i> Start Timer</button>
                    </div>
                </div>
                
                <!-- Secondary action buttons for other features -->
                <div class="action-buttons">
                    <!-- Template creation shortcut -->
                    <button id="create-new-template" class="action-button"><i class="fas fa-plus action-icon"></i> New Template</button>
                    <!-- Other utility buttons -->
                    <button id="open-goals" class="action-button"><i class="fas fa-bullseye action-icon"></i> Goals</button>
                    <button id="open-stats" class="action-button"><i class="fas fa-chart-bar action-icon"></i> Stats</button>
                    <button id="open-records" class="action-button"><i class="fas fa-trophy action-icon"></i> Records</button>
                    <button id="open-exercise-library" class="action-button"><i class="fas fa-book action-icon"></i> Exercises</button>
                    <button id="open-comparison" class="action-button"><i class="fas fa-balance-scale action-icon"></i> Compare</button>
                    <button id="open-nutrition" class="action-button"><i class="fas fa-utensils action-icon"></i> Nutrition</button>
                    <button id="export-data" class="action-button"><i class="fas fa-file-export action-icon"></i> Export</button>
                    <button id="import-data" class="action-button"><i class="fas fa-file-import action-icon"></i> Import</button>
                </div>
                
                <!-- Quick workout form (hidden by default, shown when quick workout button is clicked) -->
                <div id="quick-workout-form" style="display: none;">
                    <h3>Quick Workout</h3>
                    <form id="workout-form">
                        <div class="form-group">
                            <label for="workout-type"><i class="fas fa-dumbbell"></i> Workout Type</label>
                            <select id="workout-type" required>
                                <option value="">Select workout type</option>
                                <option value="cardio">Cardio</option>
                                <option value="strength">Strength Training</option>
                                <option value="flexibility">Flexibility</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="workout-name"><i class="fas fa-heading"></i> Workout Name</label>
                            <input type="text" id="workout-name" placeholder="e.g. Running, Push-ups" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="workout-duration"><i class="fas fa-clock"></i> Duration (minutes)</label>
                            <input type="number" id="workout-duration" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="workout-intensity"><i class="fas fa-fire"></i> Intensity</label>
                            <select id="workout-intensity" required>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="workout-date"><i class="fas fa-calendar-alt"></i> Date</label>
                            <input type="date" id="workout-date" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="workout-notes"><i class="fas fa-sticky-note"></i> Notes (optional)</label>
                            <textarea id="workout-notes" rows="3" placeholder="Add any notes about your workout"></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="cancel-quick-workout" class="secondary-button"><i class="fas fa-times"></i> Cancel</button>
                            <button type="submit" id="submit-workout"><i class="fas fa-plus-circle"></i> Add Workout</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <h2>Workout History</h2>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="filter-type">Filter by Type:</label>
                        <select id="filter-type">
                            <option value="all">All Types</option>
                            <option value="cardio">Cardio</option>
                            <option value="strength">Strength</option>
                            <option value="flexibility">Flexibility</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-date">Date Range:</label>
                        <select id="filter-date">
                            <option value="all">All Time</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                </div>
                <div id="workout-list" class="workout-list">
                    <div class="empty-state" id="empty-state">
                        <p>No workouts added yet.</p>
                        <p>Add your first workout to get started!</p>
                    </div>
                </div>
            </div>
        </div>
        </div> <!-- End of workouts tab -->
            
        <!-- Exercise Library Tab -->
        <div class="tab-content" id="exercise-library-tab">
            <div class="card">
                <h2>Exercise Library</h2>
                <div class="action-buttons">
                    <button id="add-exercise-btn" class="action-button"><i class="fas fa-plus action-icon"></i> Add Exercise</button>
                </div>
                <div id="exercise-library-list" class="exercise-library-grid"></div>
                <div id="add-exercise-form" style="display: none;">
                    <h3>Add New Exercise</h3>
                    <form id="exercise-library-form">
                        <div class="form-group">
                            <label for="exercise-lib-name"><i class="fas fa-signature"></i> Exercise Name</label>
                            <input type="text" id="exercise-lib-name" required>
                        </div>
                        <div class="form-group">
                            <label for="exercise-lib-category"><i class="fas fa-layer-group"></i> Category</label>
                            <select id="exercise-lib-category">
                                <option value="strength">Strength</option>
                                <option value="cardio">Cardio</option>
                                <option value="flexibility">Flexibility</option>
                                <option value="balance">Balance</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exercise-lib-equipment"><i class="fas fa-dumbbell"></i> Equipment</label>
                            <select id="exercise-lib-equipment">
                                <option value="none">None / Bodyweight</option>
                                <option value="dumbbells">Dumbbells</option>
                                <option value="barbell">Barbell</option>
                                <option value="kettlebell">Kettlebell</option>
                                <option value="resistance-bands">Resistance Bands</option>
                                <option value="machine">Machine</option>
                                <option value="cable">Cable</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exercise-lib-muscles"><i class="fas fa-child"></i> Target Muscles</label>
                            <input type="text" id="exercise-lib-muscles" placeholder="e.g. Chest, Triceps">
                        </div>
                        <div class="form-group">
                            <label for="exercise-lib-description"><i class="fas fa-align-left"></i> Description</label>
                            <textarea id="exercise-lib-description" rows="3" placeholder="Describe how to perform this exercise"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="exercise-lib-notes"><i class="fas fa-sticky-note"></i> Personal Notes</label>
                            <textarea id="exercise-lib-notes" rows="2" placeholder="Any personal tips or notes"></textarea>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Save Exercise</button>
                            <button type="button" id="cancel-exercise" class="btn-secondary"><i class="fas fa-times"></i> Cancel</button>
                        </div>
                    </form>
                </div>
                <div id="exercise-detail" style="display: none;"></div>
            </div>
        </div>
            
        <!-- Goals Tab -->
        <div class="tab-content" id="goals-tab">
            <div class="card">
                <h2>My Fitness Goals</h2>
                <div class="action-buttons">
                    <button id="new-goal-btn" class="action-button"><i class="fas fa-plus action-icon"></i> New Goal</button>
                </div>
                <form id="goal-form" style="display: none;">
                    <div class="form-group">
                        <label for="goal-type"><i class="fas fa-tag"></i> Goal Type</label>
                        <select id="goal-type">
                            <option value="workouts">Complete X Workouts</option>
                            <option value="minutes">Exercise for X Minutes</option>
                            <option value="streak">Maintain X Day Streak</option>
                            <option value="cardio">Complete X Cardio Workouts</option>
                            <option value="strength">Complete X Strength Workouts</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="goal-target"><i class="fas fa-bullseye"></i> Target</label>
                        <input type="number" id="goal-target" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="goal-timeframe"><i class="fas fa-calendar-alt"></i> Timeframe</label>
                        <select id="goal-timeframe">
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                            <option value="custom">Custom Dates</option>
                        </select>
                    </div>
                    <div id="custom-dates" style="display: none;">
                        <div class="form-group">
                            <label for="goal-start-date"><i class="fas fa-calendar-day"></i> Start Date</label>
                            <input type="date" id="goal-start-date">
                        </div>
                        <div class="form-group">
                            <label for="goal-end-date"><i class="fas fa-calendar-day"></i> End Date</label>
                            <input type="date" id="goal-end-date">
                        </div>
                    </div>
                    <button type="submit" class="btn-primary"><i class="fas fa-save"></i> Save Goal</button>
                    <button type="button" id="cancel-goal" class="btn-secondary"><i class="fas fa-times"></i> Cancel</button>
                </form>
                <div id="goals-list" class="current-goals"></div>
            </div>
        </div>
            
        <!-- Timer Tab -->
        <div class="tab-content" id="timer-tab">
            <div class="card">
                <h2>Workout Timer</h2>
                <div class="timer-display">
                    <div id="timer-display" class="timer-time">00:00:00</div>
                    <div class="timer-presets">
                        <h3>Quick Presets</h3>
                        <div class="preset-buttons">
                            <button class="preset-button" data-time="300">5 Min</button>
                            <button class="preset-button" data-time="600">10 Min</button>
                            <button class="preset-button" data-time="1200">20 Min</button>
                            <button class="preset-button" data-time="1800">30 Min</button>
                            <button class="preset-button" data-time="2700">45 Min</button>
                            <button class="preset-button" data-time="3600">60 Min</button>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button id="timer-start" class="timer-btn start"><i class="fas fa-play"></i> Start</button>
                        <button id="timer-pause" class="timer-btn pause" disabled><i class="fas fa-pause"></i> Pause</button>
                        <button id="timer-reset" class="timer-btn reset"><i class="fas fa-redo"></i> Reset</button>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="timer-notes"><i class="fas fa-sticky-note"></i> Workout Notes</label>
                        <textarea id="timer-notes" rows="2" placeholder="Optional notes about this workout"></textarea>
                    </div>
                    <button id="timer-save" class="timer-btn save" disabled><i class="fas fa-save"></i> Save as Workout</button>
                </div>
            </div>
        </div>
            
        <!-- Statistics Tab -->
        <div class="tab-content" id="stats-tab">
            <div class="card">
                <h2>Workout Statistics</h2>
                <div class="stats-time-selector">
                    <button class="stats-time-btn active" data-timeframe="week">This Week</button>
                    <button class="stats-time-btn" data-timeframe="month">This Month</button>
                    <button class="stats-time-btn" data-timeframe="year">This Year</button>
                    <button class="stats-time-btn" data-timeframe="all">All Time</button>
                </div>
                <div class="stats-summary">
                    <div class="stats-row">
                        <div class="stats-metric">
                            <div class="stats-value" id="stats-total-workouts">0</div>
                            <div class="stats-label">Total Workouts</div>
                        </div>
                        <div class="stats-metric">
                            <div class="stats-value" id="stats-total-duration">0</div>
                            <div class="stats-label">Total Minutes</div>
                        </div>
                        <div class="stats-metric">
                            <div class="stats-value" id="stats-avg-per-week">0</div>
                            <div class="stats-label">Avg. Per Week</div>
                        </div>
                    </div>
                    <div class="stats-row">
                        <div class="stats-metric">
                            <div class="stats-value" id="stats-cardio-count">0</div>
                            <div class="stats-label">Cardio</div>
                        </div>
                        <div class="stats-metric">
                            <div class="stats-value" id="stats-strength-count">0</div>
                            <div class="stats-label">Strength</div>
                        </div>
                        <div class="stats-metric">
                            <div class="stats-value" id="stats-flexibility-count">0</div>
                            <div class="stats-label">Flexibility</div>
                        </div>
                    </div>
                </div>
                <div class="stats-charts">
                    <div class="chart-wrapper">
                        <h3>Workout Intensity Distribution</h3>
                        <canvas id="stats-intensity-chart" width="100%" height="250"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3>Workout Consistency</h3>
                        <canvas id="stats-consistency-chart" width="100%" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>
            
        <!-- Settings Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="card">
                <h2>App Settings</h2>
                <div class="settings-section">
                    <h3>Theme Preferences</h3>
                    <div class="theme-options">
                        <button id="settings-theme-dark" class="theme-option">
                            <div class="theme-preview dark"></div>
                            <span>Dark</span>
                        </button>
                        <button id="settings-theme-nature" class="theme-option">
                            <div class="theme-preview nature"></div>
                            <span>Nature</span>
                        </button>
                        <button id="settings-theme-futuristic" class="theme-option">
                            <div class="theme-preview futuristic"></div>
                            <span>Futuristic</span>
                        </button>
                        <button id="settings-theme-retro" class="theme-option">
                            <div class="theme-preview retro"></div>
                            <span>Retro</span>
                        </button>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Data Management</h3>
                    <div class="data-management-options">
                        <button id="export-data" class="btn-primary"><i class="fas fa-file-export"></i> Export Data</button>
                        <button id="import-data" class="btn-primary"><i class="fas fa-file-import"></i> Import Data</button>
                        <button id="clear-data" class="btn-danger"><i class="fas fa-trash-alt"></i> Clear All Data</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Records Tab -->
        <div class="tab-content" id="records-tab">
            <div class="card">
                <h2>Personal Records</h2>
                <p class="section-description">Track your personal bests and see your progress over time.</p>
                
                <div class="records-summary">
                    <div class="summary-card">
                        <div class="summary-value"><span id="total-records">0</span></div>
                        <div class="summary-label">Total Records</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value"><span id="recent-pr">0</span></div>
                        <div class="summary-label">Recent PRs</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value"><span id="strength-prs">0</span></div>
                        <div class="summary-label">Strength</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value"><span id="cardio-prs">0</span></div>
                        <div class="summary-label">Cardio</div>
                    </div>
                </div>
                
                <div class="record-filters">
                    <div class="filter-container">
                        <label for="record-type-filter">Record Type</label>
                        <select id="record-type-filter">
                            <option value="all">All Records</option>
                            <option value="strength">Strength</option>
                            <option value="cardio">Cardio</option>
                            <option value="flexibility">Flexibility</option>
                        </select>
                    </div>
                    <div class="filter-container">
                        <label for="record-sort">Sort By</label>
                        <select id="record-sort">
                            <option value="recent">Most Recent</option>
                            <option value="name">Exercise Name</option>
                            <option value="value">Record Value</option>
                        </select>
                    </div>
                </div>
                
                <div class="chart-container" id="pr-chart-container">
                    <h3>Personal Records Chart</h3>
                    <div class="chart-wrapper">
                        <canvas id="pr-chart" width="100%" height="280"></canvas>
                    </div>
                </div>
                
                <div class="records-list-container">
                    <h3>Your Records</h3>
                    <div id="records-list">
                        <!-- Records will be dynamically populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End of tabs-container -->
        
        <div class="chart-container" id="chart-container">
            <!-- Charts will be rendered here -->
        </div>
    </div>
    
    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav">
        <div class="mobile-nav-tabs">
            <div class="mobile-nav-tab active" data-tab="workout">
                <i class="fas fa-dumbbell"></i>
                <span>Workouts</span>
            </div>
            <div class="mobile-nav-tab" data-tab="timer">
                <i class="fas fa-stopwatch"></i>
                <span>Timer</span>
            </div>
            <div class="mobile-nav-tab" data-tab="stats">
                <i class="fas fa-chart-bar"></i>
                <span>Stats</span>
            </div>
            <div class="mobile-nav-tab" data-tab="more">
                <i class="fas fa-ellipsis-h"></i>
                <span>More</span>
            </div>
        </div>
    </div>
    
    <!-- Edit Workout Modal -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2>Edit Workout</h2>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <div class="form-group">
                    <label for="edit-type">Workout Type</label>
                    <select id="edit-type" required>
                        <option value="">Select workout type</option>
                        <option value="cardio">Cardio</option>
                        <option value="strength">Strength Training</option>
                        <option value="flexibility">Flexibility</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-name">Workout Name</label>
                    <input type="text" id="edit-name" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-duration">Duration (minutes)</label>
                    <input type="number" id="edit-duration" min="1" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-intensity">Intensity</label>
                    <select id="edit-intensity" required>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-date">Date</label>
                    <input type="date" id="edit-date" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-notes">Notes (optional)</label>
                    <textarea id="edit-notes" rows="3"></textarea>
                </div>
                
                <button type="submit">Update Workout</button>
            </form>
        </div>
    </div>
    
    <!-- Exercise Library Modal -->
    <div class="modal" id="exercise-library-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-exercise-library-modal">&times;</span>
            <h2>Exercise Library</h2>
            <div class="exercise-library-actions">
                <button id="add-exercise-btn" class="action-button">Add New Exercise</button>
                <div class="exercise-filter">
                    <label for="exercise-filter">Filter:</label>
                    <select id="exercise-category-filter">
                        <option value="all">All Categories</option>
                        <option value="upper">Upper Body</option>
                        <option value="lower">Lower Body</option>
                        <option value="core">Core</option>
                        <option value="cardio">Cardio</option>
                        <option value="flexibility">Flexibility</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="exercise-search">
                <input type="text" id="exercise-search" placeholder="Search exercises...">
            </div>
            <div id="exercise-library-list" class="exercise-library-list">
                <div class="empty-state" id="empty-exercises">
                    <p>No exercises added to your library yet.</p>
                    <p>Add your first exercise to start building your personal library!</p>
                </div>
            </div>
            <!-- Add Exercise Form (hidden by default) -->
            <div id="add-exercise-form" class="add-exercise-form" style="display: none;">
                <h3>Add New Exercise</h3>
                <form id="exercise-library-form">
                    <div class="form-group">
                        <label for="exercise-lib-name">Exercise Name</label>
                        <input type="text" id="exercise-lib-name" required placeholder="e.g., Bench Press, Deadlift">
                    </div>
                    <div class="form-group">
                        <label for="exercise-lib-category">Category</label>
                        <select id="exercise-lib-category" required>
                            <option value="upper">Upper Body</option>
                            <option value="lower">Lower Body</option>
                            <option value="core">Core</option>
                            <option value="cardio">Cardio</option>
                            <option value="flexibility">Flexibility</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exercise-lib-equipment">Equipment Needed</label>
                        <select id="exercise-lib-equipment" required>
                            <option value="none">None/Bodyweight</option>
                            <option value="dumbbells">Dumbbells</option>
                            <option value="barbell">Barbell</option>
                            <option value="kettlebell">Kettlebell</option>
                            <option value="resistance">Resistance Bands</option>
                            <option value="cable">Cable Machine</option>
                            <option value="machine">Weight Machine</option>
                            <option value="cardio">Cardio Equipment</option>
                            <option value="other">Other Equipment</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exercise-lib-muscles">Primary Muscles Targeted</label>
                        <input type="text" id="exercise-lib-muscles" placeholder="e.g., Chest, Triceps">
                    </div>
                    <div class="form-group">
                        <label for="exercise-lib-description">Exercise Description</label>
                        <textarea id="exercise-lib-description" rows="3" placeholder="Describe the proper form and technique for this exercise"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="exercise-lib-notes">Personal Notes (optional)</label>
                        <textarea id="exercise-lib-notes" rows="2" placeholder="Add your personal notes or tips for this exercise"></textarea>
                    </div>
                    <div class="form-buttons">
                        <button type="button" id="cancel-exercise">Cancel</button>
                        <button type="submit">Save Exercise</button>
                    </div>
                </form>
            </div>
            <!-- Exercise Detail View (hidden by default) -->
            <div id="exercise-detail" class="exercise-detail" style="display: none;">
                <button class="back-button" id="back-to-exercises">← Back to Exercises</button>
                <div id="exercise-detail-content"></div>
            </div>
        </div>
    </div>
    
    <!-- Personal Records Modal -->
    <div class="modal" id="records-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-records-modal">&times;</span>
            <h2>Personal Records</h2>
            <div class="records-actions">
                <button id="add-record-btn" class="action-button">Add New Record</button>
                <div class="records-filter">
                    <label for="records-filter">Filter:</label>
                    <select id="records-category-filter">
                        <option value="all">All Categories</option>
                        <option value="strength">Strength</option>
                        <option value="cardio">Cardio</option>
                        <option value="flexibility">Flexibility</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div id="records-list" class="records-list">
                <div class="empty-state" id="empty-records">
                    <p>No personal records added yet.</p>
                    <p>Add your first personal record to track your progress!</p>
                </div>
            </div>
            <!-- Add Record Form (hidden by default) -->
            <div id="add-record-form" class="add-record-form" style="display: none;">
                <h3>Add New Personal Record</h3>
                <form id="record-form">
                    <div class="form-group">
                        <label for="record-name">Exercise Name</label>
                        <input type="text" id="record-name" required placeholder="e.g., Bench Press, 5K Run">
                    </div>
                    <div class="form-group">
                        <label for="record-category">Category</label>
                        <select id="record-category" required>
                            <option value="strength">Strength</option>
                            <option value="cardio">Cardio</option>
                            <option value="flexibility">Flexibility</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="record-value">Value</label>
                        <input type="number" id="record-value" required step="0.01" min="0" placeholder="e.g., 225">
                    </div>
                    <div class="form-group">
                        <label for="record-unit">Unit</label>
                        <select id="record-unit" required>
                            <option value="lbs">lbs (weight)</option>
                            <option value="kg">kg (weight)</option>
                            <option value="reps">reps (repetitions)</option>
                            <option value="miles">miles (distance)</option>
                            <option value="km">km (distance)</option>
                            <option value="min">min (time)</option>
                            <option value="sec">sec (time)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="record-date">Date Achieved</label>
                        <input type="date" id="record-date" required>
                    </div>
                    <div class="form-group">
                        <label for="record-notes">Notes (optional)</label>
                        <textarea id="record-notes" rows="2" placeholder="Add any notes about your record"></textarea>
                    </div>
                    <div class="form-buttons">
                        <button type="button" id="cancel-record">Cancel</button>
                        <button type="submit">Save Record</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Statistics Dashboard Modal -->
    <div class="modal" id="stats-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-stats-modal">&times;</span>
            <h2>Workout Statistics Dashboard</h2>
            <div class="stats-time-selector">
                <button class="stats-time-btn active" data-timeframe="week">Week</button>
                <button class="stats-time-btn" data-timeframe="month">Month</button>
                <button class="stats-time-btn" data-timeframe="year">Year</button>
                <button class="stats-time-btn" data-timeframe="all">All Time</button>
            </div>
            <div class="stats-dashboard">
                <div class="stats-row">
                    <div class="stats-card">
                        <div class="stats-icon">🏋️</div>
                        <div class="stats-value" id="stats-total-workouts">0</div>
                        <div class="stats-label">Total Workouts</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-icon">⏱️</div>
                        <div class="stats-value" id="stats-total-duration">0</div>
                        <div class="stats-label">Total Minutes</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-icon">📅</div>
                        <div class="stats-value" id="stats-avg-per-week">0</div>
                        <div class="stats-label">Avg Workouts/Week</div>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stats-card">
                        <div class="stats-icon">❤️</div>
                        <div class="stats-value" id="stats-cardio-count">0</div>
                        <div class="stats-label">Cardio Workouts</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-icon">💪</div>
                        <div class="stats-value" id="stats-strength-count">0</div>
                        <div class="stats-label">Strength Workouts</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-icon">🧘</div>
                        <div class="stats-value" id="stats-flexibility-count">0</div>
                        <div class="stats-label">Flexibility Workouts</div>
                    </div>
                </div>
                <div class="stats-chart-container">
                    <canvas id="stats-intensity-chart"></canvas>
                </div>
                <div class="stats-chart-container">
                    <canvas id="stats-consistency-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Goals Modal -->
    <div class="modal" id="goals-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-goals-modal">&times;</span>
            <h2>Set Workout Goals</h2>
            <form id="goals-form">
                <div class="form-group">
                    <label for="goal-type">Goal Type</label>
                    <select id="goal-type" required>
                        <option value="workouts">Number of Workouts</option>
                        <option value="minutes">Minutes Exercised</option>
                        <option value="streak">Day Streak</option>
                        <option value="cardio">Cardio Workouts</option>
                        <option value="strength">Strength Workouts</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="goal-target">Target Amount</label>
                    <input type="number" id="goal-target" min="1" required>
                </div>
                
                <div class="form-group">
                    <label for="goal-timeframe">Timeframe</label>
                    <select id="goal-timeframe" required>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Date Range</option>
                    </select>
                </div>
                
                <div class="form-group date-range" style="display: none;">
                    <label for="goal-start-date">Start Date</label>
                    <input type="date" id="goal-start-date">
                </div>
                
                <div class="form-group date-range" style="display: none;">
                    <label for="goal-end-date">End Date</label>
                    <input type="date" id="goal-end-date">
                </div>
                
                <button type="submit">Set Goal</button>
            </form>
            
            <div class="current-goals">
                <h3>Active Goals</h3>
                <div id="goals-list"></div>
            </div>
        </div>
    </div>
    
    <!-- Timer Modal -->
    <div class="modal" id="timer-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-timer-modal">&times;</span>
            <h2>Workout Timer</h2>
            <div class="timer-display">
                <div class="timer-time" id="timer-display">00:00:00</div>
                <div class="timer-controls">
                    <button id="timer-start" class="timer-btn start"><i class="fas fa-play"></i> Start</button>
                    <button id="timer-pause" class="timer-btn pause" disabled><i class="fas fa-pause"></i> Pause</button>
                    <button id="timer-reset" class="timer-btn reset"><i class="fas fa-redo-alt"></i> Reset</button>
                </div>
            </div>
            <div class="timer-presets">
                <h3>Quick Presets</h3>
                <div class="preset-buttons">
                    <button class="preset-button" data-time="60">1 min</button>
                    <button class="preset-button" data-time="300">5 min</button>
                    <button class="preset-button" data-time="600">10 min</button>
                    <button class="preset-button" data-time="1800">30 min</button>
                    <button class="preset-button" data-time="3600">60 min</button>
                </div>
            </div>
            <div class="form-group">
                <label for="timer-notes">Workout Notes</label>
                <textarea id="timer-notes" rows="3" placeholder="What are you working on?"></textarea>
            </div>
            <button id="timer-save" class="timer-btn save" disabled><i class="fas fa-save"></i> Save Workout</button>
        </div>
    </div>
    
    <!-- Template Creator Modal -->
    <div class="modal" id="template-creator-modal">
        <div class="modal-content template-modal-content">
            <span class="close-modal" id="close-template-creator-modal">&times;</span>
            <h2>Create Workout Template</h2>
            
            <div class="form-group">
                <label for="template-name">Template Name</label>
                <input type="text" id="template-name" placeholder="e.g. Upper Body, Leg Day, Full Body" required>
            </div>
            
            <div class="template-exercises">
                <h3>Exercises</h3>
                <div id="exercise-list"></div>
                
                <div class="add-exercise-form">
                    <h4>Add Exercise</h4>
                    <div class="form-group">
                        <label for="exercise-name">Exercise Name</label>
                        <input type="text" id="exercise-name" placeholder="e.g. Bench Press, Deadlift, Squats">
                    </div>
                    
                    <div class="set-container">
                        <h5>Sets</h5>
                        <div id="sets-list">
                            <div class="set-item">
                                <div class="form-group">
                                    <label>Target Reps</label>
                                    <input type="number" class="set-reps" min="1" value="10">
                                </div>
                                <div class="form-group">
                                    <label>Rest Time (seconds)</label>
                                    <input type="number" class="set-rest" min="0" value="60">
                                </div>
                            </div>
                        </div>
                        <button type="button" id="add-set">+ Add Another Set</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="exercise-notes">Notes (optional)</label>
                        <textarea id="exercise-notes" rows="2" placeholder="Any tips or notes for this exercise"></textarea>
                    </div>
                    
                    <button type="button" id="add-exercise-to-template">Add Exercise to Template</button>
                </div>
            </div>
            
            <div class="template-actions">
                <button type="button" id="save-template">Save Template</button>
                <button type="button" id="cancel-template">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Template Selector Modal -->
    <div class="modal" id="template-selector-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-template-selector-modal">&times;</span>
            <h2>Workout Templates</h2>
            
            <div class="template-list-container">
                <div id="template-list">
                    <p class="empty-templates">No templates created yet. Create your first template to get started!</p>
                </div>
            </div>
            
            <div class="template-selector-actions">
                <button type="button" id="create-new-template">Create New Template</button>
            </div>
        </div>
    </div>
    
    <!-- Active Template Modal -->
    <div class="modal" id="active-template-modal">
        <div class="modal-content template-modal-content">
            <span class="close-modal" id="close-active-template-modal">&times;</span>
            <h2 id="active-template-name">Template Name</h2>
            
            <div class="active-template-progress">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="template-progress-fill"></div>
                    </div>
                    <div class="progress-text">
                        <span id="completed-exercises">0</span>/<span id="total-exercises">0</span> exercises completed
                    </div>
                </div>
            </div>
            
            <div class="rest-timer-display" id="rest-timer-container" style="display: none;">
                <h3>Rest Time</h3>
                <div class="timer-time" id="rest-timer-display">00:00</div>
                <button type="button" id="skip-rest">Skip Rest</button>
            </div>
            
            <div id="active-exercise-container">
                <!-- Current exercise will display here -->
            </div>
            
            <div class="template-actions">
                <button type="button" id="finish-workout">Finish Workout</button>
                <button type="button" id="cancel-workout">Cancel Workout</button>
            </div>
        </div>
    </div>
    
    <!-- Workout Comparison Modal -->
    <div class="modal" id="comparison-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-comparison-modal">&times;</span>
            <h2>Workout Comparison</h2>
            <div class="comparison-selectors">
                <div class="form-group">
                    <label for="comparison-period-1">First Period</label>
                    <select id="comparison-period-1">
                        <option value="last7">Last 7 Days</option>
                        <option value="last30">Last 30 Days</option>
                        <option value="last90">Last 90 Days</option>
                        <option value="custom">Custom Dates</option>
                    </select>
                    <div class="custom-dates" id="custom-dates-1" style="display: none;">
                        <div class="form-group">
                            <label>From</label>
                            <input type="date" id="period-1-start">
                        </div>
                        <div class="form-group">
                            <label>To</label>
                            <input type="date" id="period-1-end">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="comparison-period-2">Second Period</label>
                    <select id="comparison-period-2">
                        <option value="previous7">Previous 7 Days</option>
                        <option value="previous30">Previous 30 Days</option>
                        <option value="previous90">Previous 90 Days</option>
                        <option value="custom">Custom Dates</option>
                    </select>
                    <div class="custom-dates" id="custom-dates-2" style="display: none;">
                        <div class="form-group">
                            <label>From</label>
                            <input type="date" id="period-2-start">
                        </div>
                        <div class="form-group">
                            <label>To</label>
                            <input type="date" id="period-2-end">
                        </div>
                    </div>
                </div>
                <button id="generate-comparison" class="action-button">Generate Comparison</button>
            </div>
            <div class="comparison-results">
                <div class="comparison-summary">
                    <div class="comparison-card">
                        <h4>Total Workouts</h4>
                        <div class="comparison-values">
                            <div class="period-1-value">0</div>
                            <div class="comparison-change">0%</div>
                            <div class="period-2-value">0</div>
                        </div>
                    </div>
                    <div class="comparison-card">
                        <h4>Total Duration</h4>
                        <div class="comparison-values">
                            <div class="period-1-value">0 min</div>
                            <div class="comparison-change">0%</div>
                            <div class="period-2-value">0 min</div>
                        </div>
                    </div>
                    <div class="comparison-card">
                        <h4>Workout Intensity</h4>
                        <div class="comparison-values">
                            <div class="period-1-value">0</div>
                            <div class="comparison-change">0%</div>
                            <div class="period-2-value">0</div>
                        </div>
                    </div>
                </div>
                <div class="comparison-chart-container">
                    <canvas id="comparison-chart"></canvas>
                </div>
                <div class="comparison-insights">
                    <h3>Insights</h3>
                    <ul id="comparison-insights-list">
                        <li>Select two periods to compare your workout data.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Nutrition Tracker Modal -->
    <div class="modal" id="nutrition-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-nutrition-modal">&times;</span>
            <h2>Nutrition Tracker</h2>
            <div class="nutrition-tabs">
                <button class="nutrition-tab active" data-tab="food-log">Food Log</button>
                <button class="nutrition-tab" data-tab="nutrition-stats">Statistics</button>
                <button class="nutrition-tab" data-tab="meal-plans">Meal Plans</button>
            </div>
            
            <div class="nutrition-tab-content" id="food-log-content">
                <div class="nutrition-header">
                    <h3>Daily Food Log</h3>
                    <div class="date-selector">
                        <button id="prev-day"><i class="fas fa-chevron-left"></i></button>
                        <input type="date" id="nutrition-date">
                        <button id="next-day"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                
                <div class="nutrition-summary">
                    <div class="nutrition-stat">
                        <div class="nutrition-stat-value" id="total-calories">0</div>
                        <div class="nutrition-stat-label">Calories</div>
                    </div>
                    <div class="nutrition-stat">
                        <div class="nutrition-stat-value" id="total-protein">0g</div>
                        <div class="nutrition-stat-label">Protein</div>
                    </div>
                    <div class="nutrition-stat">
                        <div class="nutrition-stat-value" id="total-carbs">0g</div>
                        <div class="nutrition-stat-label">Carbs</div>
                    </div>
                    <div class="nutrition-stat">
                        <div class="nutrition-stat-value" id="total-fat">0g</div>
                        <div class="nutrition-stat-label">Fat</div>
                    </div>
                </div>
                
                <div class="meal-sections">
                    <div class="meal-section">
                        <div class="meal-header">
                            <h4>Breakfast</h4>
                            <button class="add-food-btn" data-meal="breakfast"><i class="fas fa-plus"></i> Add Food</button>
                        </div>
                        <div class="food-items" id="breakfast-items"></div>
                    </div>
                    
                    <div class="meal-section">
                        <div class="meal-header">
                            <h4>Lunch</h4>
                            <button class="add-food-btn" data-meal="lunch"><i class="fas fa-plus"></i> Add Food</button>
                        </div>
                        <div class="food-items" id="lunch-items"></div>
                    </div>
                    
                    <div class="meal-section">
                        <div class="meal-header">
                            <h4>Dinner</h4>
                            <button class="add-food-btn" data-meal="dinner"><i class="fas fa-plus"></i> Add Food</button>
                        </div>
                        <div class="food-items" id="dinner-items"></div>
                    </div>
                    
                    <div class="meal-section">
                        <div class="meal-header">
                            <h4>Snacks</h4>
                            <button class="add-food-btn" data-meal="snacks"><i class="fas fa-plus"></i> Add Food</button>
                        </div>
                        <div class="food-items" id="snacks-items"></div>
                    </div>
                </div>
            </div>
            
            <div class="nutrition-tab-content" id="nutrition-stats-content" style="display: none;">
                <h3>Nutrition Statistics</h3>
                <div class="nutrition-stats-period">
                    <button class="stats-period-btn active" data-period="week">Week</button>
                    <button class="stats-period-btn" data-period="month">Month</button>
                    <button class="stats-period-btn" data-period="year">Year</button>
                </div>
                
                <div class="nutrition-charts">
                    <div class="nutrition-chart-container">
                        <h4>Calorie Intake Over Time</h4>
                        <canvas id="calories-chart"></canvas>
                    </div>
                    <div class="nutrition-chart-container">
                        <h4>Macronutrient Distribution</h4>
                        <canvas id="macros-chart"></canvas>
                    </div>
                </div>
                
                <div class="nutrition-insights">
                    <h4>Insights</h4>
                    <ul id="nutrition-insights-list">
                        <li>Start tracking your nutrition to see insights here.</li>
                    </ul>
                </div>
            </div>
            
            <div class="nutrition-tab-content" id="meal-plans-content" style="display: none;">
                <div class="meal-plans-header">
                    <h3>Meal Plans</h3>
                    <button id="create-meal-plan" class="action-button"><i class="fas fa-plus"></i> Create New Plan</button>
                </div>
                
                <div id="meal-plans-list">
                    <div class="empty-state" id="empty-meal-plans">
                        <p>No meal plans created yet.</p>
                        <p>Create your first meal plan to get started!</p>
                    </div>
                </div>
                
                <!-- Meal Plan Creator (hidden by default) -->
                <div id="meal-plan-creator" style="display: none;">
                    <h3>Create Meal Plan</h3>
                    <form id="meal-plan-form">
                        <div class="form-group">
                            <label for="meal-plan-name">Plan Name</label>
                            <input type="text" id="meal-plan-name" name="meal-plan-name" placeholder="e.g., Bulking Plan, Cutting Plan, Maintenance" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="meal-plan-description">Description</label>
                            <textarea id="meal-plan-description" name="meal-plan-description" rows="2" placeholder="Describe your meal plan"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="calorie-target">Daily Calorie Target</label>
                            <input type="number" id="calorie-target" name="calorie-target" min="500" step="50" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="protein-target">Protein Target (g)</label>
                            <input type="number" id="protein-target" name="protein-target" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="carbs-target">Carbs Target (g)</label>
                            <input type="number" id="carbs-target" name="carbs-target" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="fat-target">Fat Target (g)</label>
                            <input type="number" id="fat-target" name="fat-target" min="0" required>
                        </div>
                        
                        <div class="meal-plan-buttons">
                            <button type="button" id="cancel-meal-plan">Cancel</button>
                            <button type="submit">Save Meal Plan</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Add Food Modal (nested modal) -->
            <div id="add-food-modal" class="nested-modal" style="display: none;">
                <div class="nested-modal-content">
                    <span class="close-nested-modal">&times;</span>
                    <h3>Add Food Item</h3>
                    <div class="food-search">
                        <label for="food-search-input" class="sr-only">Search for food</label>
                        <input type="text" id="food-search-input" name="food-search-input" placeholder="Search for a food...">
                        <button id="search-food-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <div id="food-search-results"></div>
                    
                    <form id="add-food-form">
                        <input type="hidden" id="food-meal-type" name="food-meal-type">
                        <div class="form-group">
                            <label for="food-name">Food Name</label>
                            <input type="text" id="food-name" name="food-name" required>
                        </div>
                        <div class="form-group">
                            <label for="food-serving">Serving Size</label>
                            <input type="text" id="food-serving" name="food-serving" placeholder="e.g., 1 cup, 100g" required>
                        </div>
                        <div class="form-group">
                            <label for="food-calories">Calories</label>
                            <input type="number" id="food-calories" name="food-calories" min="0" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="food-protein">Protein (g)</label>
                                <input type="number" id="food-protein" name="food-protein" min="0" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="food-carbs">Carbs (g)</label>
                                <input type="number" id="food-carbs" name="food-carbs" min="0" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="food-fat">Fat (g)</label>
                                <input type="number" id="food-fat" name="food-fat" min="0" step="0.1" required>
                            </div>
                        </div>
                        <button type="submit">Add Food</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Social Sharing Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-share-modal">&times;</span>
            <h2>Share Your Workout</h2>
            <div class="share-preview">
                <div class="share-card">
                    <div class="share-header">
                        <h3 id="share-title">Workout Title</h3>
                        <div id="share-date">Date</div>
                    </div>
                    <div class="share-details">
                        <div id="share-type" class="share-tag">Type</div>
                        <div id="share-duration"><i class="far fa-clock"></i> Duration</div>
                        <div id="share-intensity"><i class="fas fa-thermometer-half"></i> Intensity</div>
                    </div>
                    <div id="share-notes" class="share-notes">Notes will appear here...</div>
                    <div class="share-footer">
                        <div class="share-logo">Fitness Tracker</div>
                    </div>
                </div>
            </div>
            
            <div class="share-options">
                <h3>Share as:</h3>
                <div class="share-buttons">
                    <button id="share-image" class="share-btn"><i class="fas fa-image"></i> Image</button>
                    <button id="share-text" class="share-btn"><i class="fas fa-align-left"></i> Text</button>
                    <button id="share-link" class="share-btn"><i class="fas fa-link"></i> Link</button>
                </div>
            </div>
            
            <div class="share-platforms">
                <h3>Share to:</h3>
                <div class="platform-buttons">
                    <button class="platform-btn" data-platform="twitter"><i class="fab fa-twitter"></i> Twitter</button>
                    <button class="platform-btn" data-platform="facebook"><i class="fab fa-facebook"></i> Facebook</button>
                    <button class="platform-btn" data-platform="instagram"><i class="fab fa-instagram"></i> Instagram</button>
                    <button class="platform-btn" data-platform="whatsapp"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                    <button class="platform-btn" data-platform="email"><i class="fas fa-envelope"></i> Email</button>
                </div>
            </div>
            
            <div class="copy-section">
                <textarea id="share-content" readonly></textarea>
                <button id="copy-content">Copy to Clipboard</button>
            </div>
        </div>
    </div>
    
    <script>
        // Set today's date as default
        document.getElementById('workout-date').valueAsDate = new Date();
        
        // Initialize app on load
        function initializeApp() {
            console.log("Initializing LiftMate app...");
            
            // Clear any potentially corrupted data
            try {
                const themeValue = localStorage.getItem('preferred-theme');
                if (themeValue && (themeValue === 'theme-dark' || themeValue === 'theme-nature' || 
                                 themeValue === 'theme-futuristic' || themeValue === 'theme-retro')) {
                    // Theme is valid, keep it
                } else if (themeValue) {
                    // Theme is invalid, reset it
                    console.log("Resetting invalid theme value:", themeValue);
                    localStorage.removeItem('preferred-theme');
                }
            } catch (e) {
                console.error("Error processing theme:", e);
            }
            
            // Initialize required localStorage keys if missing
            initializeRequiredKeys();
        }
        
        // Theme switcher functionality
        const htmlElement = document.documentElement;
        const themeButtons = document.querySelectorAll('.theme-button');
        const appTitle = document.getElementById('app-title');
        const appSubtitle = document.getElementById('app-subtitle');
        
        // Theme data
        const themes = {
            'theme-dark': {
                title: 'LIFTMATE',
                subtitle: 'Track your workouts • Monitor progress • Achieve goals'
            },
            'theme-nature': {
                title: 'LiftMate Naturals',
                subtitle: 'Embrace nature, nurture your body, track your journey'
            },
            'theme-futuristic': {
                title: 'LIFTMATE AI',
                subtitle: 'Advanced Workout Analytics & Tracking System'
            },
            'theme-retro': {
                title: 'LIFT-O-MATIC',
                subtitle: '/// Totally awesome workout tracker ///'
            }
        };
        
        // Set active theme
        function setActiveTheme(themeId) {
            // Default to dark theme if the themeId is invalid
            if (!themes[themeId]) {
                themeId = 'theme-dark';
            }
            
            // Remove all theme classes
            htmlElement.classList.remove('theme-dark', 'theme-nature', 'theme-futuristic', 'theme-retro');
            
            // Add the selected theme class
            htmlElement.classList.add(themeId);
            
            // Update active button
            themeButtons.forEach(button => {
                button.classList.remove('active');
                if (button.id === themeId) {
                    button.classList.add('active');
                }
            });
            
            // Update title and subtitle
            const themeData = themes[themeId];
            if (appTitle) appTitle.textContent = themeData.title;
            if (appSubtitle) appSubtitle.textContent = themeData.subtitle;
            
            // Save theme preference to localStorage
            safeSaveItem('preferred-theme', themeId);
        }
        
        // Initialize nutrition data storage
        let nutritionData = safeGetItem('nutrition-data', {});
        let mealPlans = safeGetItem('meal-plans', []);
        
        // Add event listeners to theme buttons
        themeButtons.forEach(button => {
            button.addEventListener('click', () => {
                setActiveTheme(button.id);
            });
        });
        
        // Load saved theme or default to dark theme
        const savedTheme = safeGetItem('preferred-theme', 'theme-dark');
        setActiveTheme(savedTheme);
        
        // Mobile Navigation Functionality
        const mobileNavTabs = document.querySelectorAll('.mobile-nav-tab');
        
        mobileNavTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                mobileNavTabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                const tabType = this.dataset.tab;
                
                // Handle tab actions
                if (tabType === 'timer') {
                    document.getElementById('timer-modal').style.display = 'flex';
                    document.getElementById('timer-modal').classList.add('bottom-sheet');
                } else if (tabType === 'stats') {
                    document.getElementById('stats-modal').style.display = 'flex';
                    document.getElementById('stats-modal').classList.add('bottom-sheet');
                } else if (tabType === 'more') {
                    // Create a bottom sheet menu with more options
                    const moreMenu = document.createElement('div');
                    moreMenu.className = 'modal bottom-sheet';
                    moreMenu.id = 'more-menu-modal';
                    moreMenu.style.display = 'flex';
                    
                    moreMenu.innerHTML = `
                        <div class="modal-content">
                            <span class="close-modal" id="close-more-menu">&times;</span>
                            <h3>More Options</h3>
                            <div class="action-buttons" style="flex-direction: column; margin-top: 1rem;">
                                <button id="more-goals" class="action-button"><i class="fas fa-bullseye action-icon"></i> Goals</button>
                                <button id="more-records" class="action-button"><i class="fas fa-trophy action-icon"></i> Records</button>
                                <button id="more-exercises" class="action-button"><i class="fas fa-book action-icon"></i> Exercises</button>
                                <button id="more-compare" class="action-button"><i class="fas fa-balance-scale action-icon"></i> Compare</button>
                                <button id="more-nutrition" class="action-button"><i class="fas fa-utensils action-icon"></i> Nutrition</button>
                                <button id="more-templates" class="action-button"><i class="fas fa-clipboard-list action-icon"></i> Templates</button>
                                <button id="more-export" class="action-button"><i class="fas fa-file-export action-icon"></i> Export</button>
                                <button id="more-import" class="action-button"><i class="fas fa-file-import action-icon"></i> Import</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(moreMenu);
                    
                    // Add event listeners to more menu buttons
                    document.getElementById('close-more-menu').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.querySelector('.mobile-nav-tab[data-tab="workout"]').click();
                    });
                    
                    document.getElementById('more-goals').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('goals-modal').style.display = 'flex';
                        document.getElementById('goals-modal').classList.add('bottom-sheet');
                    });
                    
                    document.getElementById('more-records').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('records-modal').style.display = 'flex';
                        document.getElementById('records-modal').classList.add('bottom-sheet');
                    });
                    
                    document.getElementById('more-exercises').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('exercise-library-modal').style.display = 'flex';
                        document.getElementById('exercise-library-modal').classList.add('bottom-sheet');
                    });
                    
                    document.getElementById('more-compare').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('comparison-modal').style.display = 'flex';
                        document.getElementById('comparison-modal').classList.add('bottom-sheet');
                    });
                    
                    document.getElementById('more-nutrition').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('nutrition-modal').style.display = 'flex';
                        document.getElementById('nutrition-modal').classList.add('bottom-sheet');
                    });
                    
                    document.getElementById('more-templates').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('template-selector-modal').style.display = 'flex';
                        document.getElementById('template-selector-modal').classList.add('bottom-sheet');
                    });
                    
                    document.getElementById('more-export').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        exportData();
                        document.querySelector('.mobile-nav-tab[data-tab="workout"]').click();
                    });
                    
                    document.getElementById('more-import').addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.getElementById('import-data').click();
                        document.querySelector('.mobile-nav-tab[data-tab="workout"]').click();
                    });
                    
                    // Prevent modal clicks from propagating
                    moreMenu.querySelector('.modal-content').addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                    
                    // Close modal when clicking outside
                    moreMenu.addEventListener('click', function() {
                        document.body.removeChild(moreMenu);
                        document.querySelector('.mobile-nav-tab[data-tab="workout"]').click();
                    });
                }
            });
        });
        
        // Make modals mobile-friendly
        function setupMobileModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            // Add bottom-sheet class to modal on mobile
            function updateModalStyle() {
                if (window.innerWidth <= 768) {
                    modal.classList.add('bottom-sheet');
                } else {
                    modal.classList.remove('bottom-sheet');
                }
            }
            
            // Initial setup
            updateModalStyle();
            
            // Update on window resize
            window.addEventListener('resize', updateModalStyle);
        }
        
        // Setup all modals for mobile
        const modalIds = [
            'edit-modal', 'goals-modal', 'timer-modal', 'stats-modal', 
            'records-modal', 'exercise-library-modal', 'comparison-modal', 
            'nutrition-modal', 'share-modal', 'template-creator-modal', 
            'template-selector-modal', 'active-template-modal'
        ];
        
        modalIds.forEach(setupMobileModal);
        
        // Export all data to file
        function exportData() {
            try {
                const allData = {
                    workouts: workouts,
                    goals: goals,
                    templates: templates,
                    templateHistory: templateHistory,
                    personalRecords: personalRecords,
                    exerciseLibrary: exerciseLibrary,
                    nutritionData: nutritionData,
                    mealPlans: mealPlans
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'fitness_tracker_backup_' + new Date().toISOString().slice(0,10) + '.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('Data exported successfully!');
            } catch (error) {
                console.error('Export error:', error);
                alert('Failed to export data: ' + error.message);
            }
        }
        
        // Import data from file
        function importData(file) {
            try {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validate imported data
                        const requiredKeys = ['workouts', 'goals', 'templates', 'templateHistory', 
                                             'personalRecords', 'exerciseLibrary'];
                        
                        const missingKeys = requiredKeys.filter(key => !importedData.hasOwnProperty(key));
                        
                        if (missingKeys.length > 0) {
                            throw new Error('Import file missing required data: ' + missingKeys.join(', '));
                        }
                        
                        // Update data
                        workouts = importedData.workouts || [];
                        goals = importedData.goals || [];
                        templates = importedData.templates || [];
                        templateHistory = importedData.templateHistory || {};
                        personalRecords = importedData.personalRecords || [];
                        exerciseLibrary = importedData.exerciseLibrary || [];
                        nutritionData = importedData.nutritionData || {};
                        mealPlans = importedData.mealPlans || [];
                        
                        // Save to localStorage
                        safeSaveItem('workouts', workouts);
                        safeSaveItem('goals', goals);
                        safeSaveItem('workout-templates', templates);
                        safeSaveItem('template-history', templateHistory);
                        safeSaveItem('personal-records', personalRecords);
                        safeSaveItem('exercise-library', exerciseLibrary);
                        safeSaveItem('nutrition-data', nutritionData);
                        safeSaveItem('meal-plans', mealPlans);
                        
                        // Update UI
                        renderWorkouts();
                        updateSummary();
                        updateGoalProgress();
                        renderCharts();
                        
                        alert('Data imported successfully!');
                    } catch (parseError) {
                        console.error('Import parsing error:', parseError);
                        alert('Failed to import data: ' + parseError.message);
                    }
                };
                
                reader.onerror = function() {
                    alert('Error reading file');
                };
                
                reader.readAsText(file);
            } catch (error) {
                console.error('Import error:', error);
                alert('Failed to import data: ' + error.message);
            }
        }
        
        // Create file input element for imports
        function setupImportExport() {
            // Create hidden file input for importing
            const importInput = document.createElement('input');
            importInput.type = 'file';
            importInput.id = 'import-data';
            importInput.accept = '.json';
            importInput.style.display = 'none';
            document.body.appendChild(importInput);
            
            // Add event listener for file selection
            importInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    importData(e.target.files[0]);
                }
            });
            
            // Create diagnostic button
            const diagnosticBtn = document.createElement('button');
            diagnosticBtn.id = 'storage-diagnostic';
            diagnosticBtn.innerHTML = '<i class="fas fa-stethoscope"></i> Storage Diagnostic';
            diagnosticBtn.style.position = 'fixed';
            diagnosticBtn.style.bottom = '10px';
            diagnosticBtn.style.right = '10px';
            diagnosticBtn.style.zIndex = '9999';
            diagnosticBtn.style.padding = '5px 10px';
            diagnosticBtn.style.fontSize = '12px';
            diagnosticBtn.style.border = 'none';
            diagnosticBtn.style.borderRadius = '4px';
            diagnosticBtn.style.backgroundColor = 'var(--primary-color, #00d0ff)';
            diagnosticBtn.style.color = 'black';
            diagnosticBtn.style.cursor = 'pointer';
            diagnosticBtn.style.opacity = '0.7';
            
            diagnosticBtn.addEventListener('click', function() {
                runStorageDiagnostic();
            });
            
            document.body.appendChild(diagnosticBtn);
        }
        
        // Run diagnostic on localStorage
        function runStorageDiagnostic() {
            let results = [];
            
            try {
                // Check basic localStorage availability
                results.push({test: 'Basic localStorage available', result: !!window.localStorage});
                
                // Try setting and getting a test value
                const testKey = '__test_key_' + Date.now();
                localStorage.setItem(testKey, 'test_value');
                const testValue = localStorage.getItem(testKey);
                results.push({test: 'Set and get test item', result: testValue === 'test_value'});
                localStorage.removeItem(testKey);
                
                // Check storage quota
                let size = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        size += localStorage[key].length;
                    }
                }
                // Convert to megabytes
                const usedSpace = (size / 1024 / 1024).toFixed(2);
                results.push({test: 'Used storage space', result: `${usedSpace} MB`});
                
                // Check for security context
                results.push({test: 'Secure context', result: window.isSecureContext});
                
                // Check all required keys exist
                const requiredKeys = ['workouts', 'goals', 'workout-templates', 'template-history', 
                                     'personal-records', 'exercise-library', 'nutrition-data', 'meal-plans'];
                                     
                const missingKeys = requiredKeys.filter(key => localStorage.getItem(key) === null);
                results.push({test: 'All required keys exist', result: missingKeys.length === 0});
                if (missingKeys.length > 0) {
                    results.push({test: 'Missing keys', result: missingKeys.join(', ')});
                }
                
            } catch (e) {
                results.push({test: 'Error during tests', result: e.message});
            }
            
            // Display results in a modal
            let resultsHTML = '<h3>Storage Diagnostic Results</h3><ul>';
            results.forEach(item => {
                const resultText = typeof item.result === 'boolean' 
                    ? (item.result ? '✅ Pass' : '❌ Fail') 
                    : item.result;
                resultsHTML += `<li><strong>${item.test}:</strong> ${resultText}</li>`;
            });
            resultsHTML += '</ul>';
            
            resultsHTML += `<p>If you're having trouble saving data, try these steps:</p>
            <ol>
                <li>Export your data now as a backup</li>
                <li>If using Safari, try Chrome or Firefox instead</li>
                <li>Check that you haven't blocked cookies for this site</li>
                <li>Ensure you're not in private/incognito browsing mode</li>
                <li>If on iOS/iPhone, verify that "Prevent Cross-Site Tracking" is off for this site</li>
                <li>Clear your browser cache and reload</li>
            </ol>`;
            
            alert(resultsHTML);
        }
        
        // Check localStorage availability and add debug
        function checkLocalStorage() {
            try {
                const testKey = '__storage_test__';
                localStorage.setItem(testKey, testKey);
                localStorage.removeItem(testKey);
                return true;
            } catch (e) {
                console.error('localStorage not available!', e);
                alert('Storage access is blocked. Your data cannot be saved! Please check your browser privacy settings and allow storage for this site.');
                return false;
            }
        }

        // Helper to safely get data from localStorage
        function safeGetItem(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                // Handle theme differently - it's not JSON but a string
                if (key === 'preferred-theme') {
                    return data || defaultValue;
                }
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error(`Error getting ${key} from localStorage:`, error);
                // If there was a parsing error, try to recover by clearing bad data
                if (error instanceof SyntaxError) {
                    localStorage.removeItem(key);
                }
                return defaultValue;
            }
        }

        // Helper to safely save data to localStorage
        function safeSaveItem(key, data) {
            try {
                // Special handling for theme which should not be JSON stringified
                if (key === 'preferred-theme') {
                    localStorage.setItem(key, data);
                } else {
                    localStorage.setItem(key, JSON.stringify(data));
                }
                return true;
            } catch (error) {
                console.error(`Error saving ${key} to localStorage:`, error);
                alert(`Failed to save your data! Storage might be full or blocked by privacy settings.`);
                return false;
            }
        }

        // Check localStorage on start
        const isStorageAvailable = checkLocalStorage();

        // Workout data storage
        // Initialize all required storage keys
        function initializeRequiredKeys() {
            const requiredKeys = [
                'workouts', 
                'workout-templates', 
                'template-history', 
                'personal-records', 
                'exercise-library', 
                'nutrition-data', 
                'meal-plans'
            ];
            
            requiredKeys.forEach(key => {
                if (localStorage.getItem(key) === null) {
                    const defaultValue = key === 'template-history' || key === 'nutrition-data' ? {} : [];
                    safeSaveItem(key, defaultValue);
                }
            });
        }
        
        // Initialize storage on load
        initializeRequiredKeys();
        
        // Call main initialization function
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        let workouts = safeGetItem('workouts', []);
        let goals = safeGetItem('goals', []);
        let templates = safeGetItem('workout-templates', []);
        let templateHistory = safeGetItem('template-history', {});
        let personalRecords = safeGetItem('personal-records', []);
        let exerciseLibrary = safeGetItem('exercise-library', []);
        
        // Form submission
        document.getElementById('workout-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const workoutType = document.getElementById('workout-type').value;
            const workoutName = document.getElementById('workout-name').value;
            const workoutDuration = parseInt(document.getElementById('workout-duration').value);
            const workoutIntensity = document.getElementById('workout-intensity').value;
            const workoutDate = document.getElementById('workout-date').value;
            const workoutNotes = document.getElementById('workout-notes').value;
            
            // Create workout object
            const workout = {
                id: Date.now(),
                type: workoutType,
                name: workoutName,
                duration: workoutDuration,
                intensity: workoutIntensity,
                date: workoutDate,
                notes: workoutNotes,
                timestamp: new Date().toISOString()
            };
            
            // Add to workouts array
            workouts.push(workout);
            
            // Save to localStorage
            safeSaveItem('workouts', workouts);
            
            // Reset form
            this.reset();
            document.getElementById('workout-date').valueAsDate = new Date();
            
            // Update UI
            renderWorkouts();
            updateSummary();
            updateGoalProgress();
            renderCharts();
        });
        
        // Render workouts with filtering
        function renderWorkouts() {
            const workoutList = document.getElementById('workout-list');
            // Check if these elements exist - they may not if called from another context
            const emptyState = document.getElementById('empty-state');
            const filterTypeElement = document.getElementById('filter-type');
            const filterDateElement = document.getElementById('filter-date');
            
            // Apply filters (if elements exist)
            let filteredWorkouts = [...workouts];
            
            // Filter by type (if element exists)
            if (filterTypeElement && filterTypeElement.value !== 'all') {
                filteredWorkouts = filteredWorkouts.filter(workout => workout.type === filterTypeElement.value);
            }
            
            // Filter by date (if element exists)
            const today = new Date();
            if (filterDateElement) {
                const filterDate = filterDateElement.value;
                if (filterDate === 'week') {
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay());
                    startOfWeek.setHours(0, 0, 0, 0);
                    filteredWorkouts = filteredWorkouts.filter(workout => new Date(workout.date) >= startOfWeek);
                } else if (filterDate === 'month') {
                    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                    filteredWorkouts = filteredWorkouts.filter(workout => new Date(workout.date) >= startOfMonth);
                } else if (filterDate === 'year') {
                    const startOfYear = new Date(today.getFullYear(), 0, 1);
                    filteredWorkouts = filteredWorkouts.filter(workout => new Date(workout.date) >= startOfYear);
                }
            }
            
            // Sort workouts by date (newest first)
            filteredWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Only continue if workoutList exists
            if (!workoutList) return;
            
            if (filteredWorkouts.length === 0 && emptyState) {
                emptyState.style.display = 'block';
                workoutList.innerHTML = '';
                workoutList.appendChild(emptyState);
                return;
            }
            
            // Only manipulate emptyState if it exists
            if (emptyState) {
                emptyState.style.display = 'none';
            }
            workoutList.innerHTML = '';
            
            filteredWorkouts.forEach(workout => {
                const workoutItem = document.createElement('div');
                workoutItem.className = 'workout-item';
                workoutItem.dataset.id = workout.id;
                
                // Format date
                const workoutDate = new Date(workout.date);
                const formattedDate = workoutDate.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                workoutItem.innerHTML = `
                    <div class="workout-action">
                        <button class="btn-icon edit-workout" data-id="${workout.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn-icon delete-workout" data-id="${workout.id}"><i class="fas fa-trash-alt"></i></button>
                    </div>
                    <div class="workout-header">
                        <div class="workout-title">${workout.name}</div>
                        <div class="workout-date"><i class="far fa-calendar-alt"></i> ${formattedDate}</div>
                    </div>
                    <div class="workout-detail">
                        <div><span class="tag ${workout.type}"><i class="fas fa-${workout.type === 'cardio' ? 'heartbeat' : workout.type === 'strength' ? 'dumbbell' : workout.type === 'flexibility' ? 'spa' : 'running'} tag-icon"></i> ${workout.type}</span></div>
                        <div><i class="far fa-clock"></i> ${workout.duration} mins</div>
                        <div><i class="fas fa-thermometer-${workout.intensity === 'low' ? 'quarter' : workout.intensity === 'medium' ? 'half' : 'full'}"></i> ${workout.intensity}</div>
                    </div>
                    ${workout.notes ? `<div class="workout-notes"><i class="fas fa-quote-left note-icon"></i>${workout.notes}</div>` : ''}
                    <button class="share-workout-btn" data-id="${workout.id}"><i class="fas fa-share-alt"></i> Share</button>
                `;
                
                workoutList.appendChild(workoutItem);
            });
            
            // Add event listeners for delete and edit buttons
            addWorkoutEventListeners();
        }
        
        // Add event listeners to workout items
        function addWorkoutEventListeners() {
            // Delete workout
            document.querySelectorAll('.delete-workout').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    if (confirm('Are you sure you want to delete this workout?')) {
                        workouts = workouts.filter(workout => workout.id !== id);
                        localStorage.setItem('workouts', JSON.stringify(workouts));
                        renderWorkouts();
                        updateSummary();
                        updateGoalProgress();
                        renderCharts();
                    }
                });
            });
            
            // Edit workout
            document.querySelectorAll('.edit-workout').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    const workout = workouts.find(workout => workout.id === id);
                    
                    if (workout) {
                        // Fill edit form
                        document.getElementById('edit-id').value = workout.id;
                        document.getElementById('edit-type').value = workout.type;
                        document.getElementById('edit-name').value = workout.name;
                        document.getElementById('edit-duration').value = workout.duration;
                        document.getElementById('edit-intensity').value = workout.intensity;
                        document.getElementById('edit-date').value = workout.date;
                        document.getElementById('edit-notes').value = workout.notes;
                        
                        // Show modal
                        document.getElementById('edit-modal').style.display = 'flex';
                    }
                });
            });
        }
        
        // Edit form submission
        document.getElementById('edit-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('edit-id').value);
            const workoutIndex = workouts.findIndex(workout => workout.id === id);
            
            if (workoutIndex !== -1) {
                workouts[workoutIndex] = {
                    ...workouts[workoutIndex],
                    type: document.getElementById('edit-type').value,
                    name: document.getElementById('edit-name').value,
                    duration: parseInt(document.getElementById('edit-duration').value),
                    intensity: document.getElementById('edit-intensity').value,
                    date: document.getElementById('edit-date').value,
                    notes: document.getElementById('edit-notes').value
                };
                
                localStorage.setItem('workouts', JSON.stringify(workouts));
                renderWorkouts();
                updateSummary();
                updateGoalProgress();
                renderCharts();
                
                // Close modal
                document.getElementById('edit-modal').style.display = 'none';
            }
        });
        
        // Close modals when clicking the X or outside the modal
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('edit-modal').style.display = 'none';
        });
        
        document.getElementById('close-goals-modal').addEventListener('click', function() {
            document.getElementById('goals-modal').style.display = 'none';
        });
        
        document.getElementById('close-timer-modal').addEventListener('click', function() {
            document.getElementById('timer-modal').style.display = 'none';
        });
        
        document.getElementById('close-comparison-modal').addEventListener('click', function() {
            document.getElementById('comparison-modal').style.display = 'none';
        });
        
        document.getElementById('close-nutrition-modal').addEventListener('click', function() {
            document.getElementById('nutrition-modal').style.display = 'none';
        });
        
        document.getElementById('close-share-modal').addEventListener('click', function() {
            document.getElementById('share-modal').style.display = 'none';
        });
        
        window.addEventListener('click', function(e) {
            const editModal = document.getElementById('edit-modal');
            const goalsModal = document.getElementById('goals-modal');
            const timerModal = document.getElementById('timer-modal');
            const comparisonModal = document.getElementById('comparison-modal');
            const nutritionModal = document.getElementById('nutrition-modal');
            const shareModal = document.getElementById('share-modal');
            
            if (e.target === editModal) {
                editModal.style.display = 'none';
            } else if (e.target === goalsModal) {
                goalsModal.style.display = 'none';
            } else if (e.target === timerModal) {
                timerModal.style.display = 'none';
            } else if (e.target === comparisonModal) {
                comparisonModal.style.display = 'none';
            } else if (e.target === nutritionModal) {
                nutritionModal.style.display = 'none';
            } else if (e.target === shareModal) {
                shareModal.style.display = 'none';
            }
        });
        
        // Filter event listeners
        document.getElementById('filter-type').addEventListener('change', renderWorkouts);
        document.getElementById('filter-date').addEventListener('change', renderWorkouts);
        
        // Update summary statistics
        function updateSummary() {
            const totalWorkouts = workouts.length;
            document.getElementById('total-workouts').textContent = totalWorkouts;
            
            // Calculate workouts this week
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday as start of week
            startOfWeek.setHours(0, 0, 0, 0);
            
            const workoutsThisWeek = workouts.filter(workout => {
                const workoutDate = new Date(workout.date);
                return workoutDate >= startOfWeek;
            }).length;
            
            document.getElementById('this-week').textContent = workoutsThisWeek;
            
            // Calculate streak
            let streak = 0;
            const dates = [...new Set(workouts.map(w => w.date))].sort((a, b) => new Date(b) - new Date(a));
            
            if (dates.length > 0) {
                // Check if worked out today
                const todayStr = today.toISOString().split('T')[0];
                const hasWorkoutToday = dates.includes(todayStr);
                
                if (hasWorkoutToday) {
                    streak = 1;
                    let checkDate = new Date(today);
                    
                    // Check previous consecutive days
                    while (true) {
                        checkDate.setDate(checkDate.getDate() - 1);
                        const checkDateStr = checkDate.toISOString().split('T')[0];
                        
                        if (dates.includes(checkDateStr)) {
                            streak++;
                        } else {
                            break;
                        }
                    }
                }
            }
            
            document.getElementById('streak').textContent = streak;
        }
        
        // Goals System
        document.getElementById('open-goals').addEventListener('click', function() {
            document.getElementById('goals-modal').style.display = 'flex';
            renderGoals();
        });
        
        // Goal timeframe change handler
        document.getElementById('goal-timeframe').addEventListener('change', function() {
            const dateRangeFields = document.querySelectorAll('.date-range');
            if (this.value === 'custom') {
                dateRangeFields.forEach(field => field.style.display = 'flex');
            } else {
                dateRangeFields.forEach(field => field.style.display = 'none');
            }
        });
        
        // Goal form submission
        document.getElementById('goals-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const goalType = document.getElementById('goal-type').value;
            const goalTarget = parseInt(document.getElementById('goal-target').value);
            const goalTimeframe = document.getElementById('goal-timeframe').value;
            
            let startDate, endDate;
            
            if (goalTimeframe === 'custom') {
                startDate = document.getElementById('goal-start-date').value;
                endDate = document.getElementById('goal-end-date').value;
                
                if (!startDate || !endDate) {
                    alert('Please select both start and end dates for custom timeframe.');
                    return;
                }
            } else {
                const today = new Date();
                
                if (goalTimeframe === 'week') {
                    // Current week (Sunday to Saturday)
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay());
                    startOfWeek.setHours(0, 0, 0, 0);
                    
                    const endOfWeek = new Date(startOfWeek);
                    endOfWeek.setDate(startOfWeek.getDate() + 6);
                    endOfWeek.setHours(23, 59, 59, 999);
                    
                    startDate = startOfWeek.toISOString().split('T')[0];
                    endDate = endOfWeek.toISOString().split('T')[0];
                } else if (goalTimeframe === 'month') {
                    // Current month
                    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                    const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    
                    startDate = startOfMonth.toISOString().split('T')[0];
                    endDate = endOfMonth.toISOString().split('T')[0];
                } else if (goalTimeframe === 'year') {
                    // Current year
                    const startOfYear = new Date(today.getFullYear(), 0, 1);
                    const endOfYear = new Date(today.getFullYear(), 11, 31);
                    
                    startDate = startOfYear.toISOString().split('T')[0];
                    endDate = endOfYear.toISOString().split('T')[0];
                }
            }
            
            // Create goal object
            const goal = {
                id: Date.now(),
                type: goalType,
                target: goalTarget,
                timeframe: goalTimeframe,
                startDate: startDate,
                endDate: endDate,
                current: 0,
                createdAt: new Date().toISOString()
            };
            
            // Add to goals array
            goals.push(goal);
            
            // Save to localStorage
            localStorage.setItem('goals', JSON.stringify(goals));
            
            // Reset form
            this.reset();
            document.querySelectorAll('.date-range').forEach(field => field.style.display = 'none');
            
            // Update UI
            renderGoals();
            updateGoalProgress();
        });
        
        // Render goals
        function renderGoals() {
            const goalsList = document.getElementById('goals-list');
            goalsList.innerHTML = '';
            
            if (goals.length === 0) {
                goalsList.innerHTML = '<p>No active goals. Set a goal to track your progress!</p>';
                return;
            }
            
            goals.forEach(goal => {
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';
                goalItem.dataset.id = goal.id;
                
                const progress = Math.min(100, Math.round((goal.current / goal.target) * 100));
                const timeframeText = getTimeframeText(goal.timeframe, goal.startDate, goal.endDate);
                
                goalItem.innerHTML = `
                    <div class="goal-delete" data-id="${goal.id}">❌</div>
                    <div class="goal-title">${getGoalTypeText(goal.type)}: ${goal.target}</div>
                    <div class="goal-timeframe">${timeframeText}</div>
                    <div class="goal-progress">Progress: ${goal.current} / ${goal.target} (${progress}%)</div>
                    <div class="goal-progress-bar">
                        <div class="goal-progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                goalsList.appendChild(goalItem);
            });
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.goal-delete').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    if (confirm('Are you sure you want to delete this goal?')) {
                        goals = goals.filter(goal => goal.id !== id);
                        localStorage.setItem('goals', JSON.stringify(goals));
                        renderGoals();
                        updateGoalProgress();
                    }
                });
            });
        }
        
        // Update goal progress
        function updateGoalProgress() {
            goals.forEach(goal => {
                // Filter workouts within the goal's date range
                const relevantWorkouts = workouts.filter(workout => {
                    const workoutDate = new Date(workout.date);
                    return workoutDate >= new Date(goal.startDate) && 
                           workoutDate <= new Date(goal.endDate);
                });
                
                // Calculate progress based on goal type
                if (goal.type === 'workouts') {
                    goal.current = relevantWorkouts.length;
                } else if (goal.type === 'minutes') {
                    goal.current = relevantWorkouts.reduce((total, workout) => total + workout.duration, 0);
                } else if (goal.type === 'streak') {
                    // For streak, current will be updated separately
                    goal.current = parseInt(document.getElementById('streak').textContent) || 0;
                } else if (goal.type === 'cardio' || goal.type === 'strength') {
                    goal.current = relevantWorkouts.filter(workout => workout.type === goal.type).length;
                }
            });
            
            // Save updated goals
            localStorage.setItem('goals', JSON.stringify(goals));
            
            // Update display if goals modal is open
            if (document.getElementById('goals-modal').style.display === 'flex') {
                renderGoals();
            }
            
            // Update overall goal progress in summary
            let overallProgress = 0;
            
            if (goals.length > 0) {
                const totalProgress = goals.reduce((sum, goal) => {
                    return sum + Math.min(100, (goal.current / goal.target) * 100);
                }, 0);
                
                overallProgress = Math.round(totalProgress / goals.length);
            }
            
            document.getElementById('goal-progress').textContent = `${overallProgress}%`;
        }
        
        // Helper functions for goals
        function getGoalTypeText(type) {
            switch(type) {
                case 'workouts': return 'Total Workouts';
                case 'minutes': return 'Total Minutes';
                case 'streak': return 'Day Streak';
                case 'cardio': return 'Cardio Workouts';
                case 'strength': return 'Strength Workouts';
                default: return type;
            }
        }
        
        function getTimeframeText(timeframe, startDate, endDate) {
            if (timeframe === 'custom') {
                const start = new Date(startDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const end = new Date(endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                return `${start} - ${end}`;
            } else {
                return `This ${timeframe.charAt(0).toUpperCase() + timeframe.slice(1)}`;
            }
        }
        
        // Timer functionality
        let timerInterval;
        let timerSeconds = 0;
        let timerRunning = false;
        
        document.getElementById('open-timer').addEventListener('click', function() {
            document.getElementById('timer-modal').style.display = 'flex';
        });
        
        // Timer control buttons
        document.getElementById('timer-start').addEventListener('click', startTimer);
        document.getElementById('timer-pause').addEventListener('click', pauseTimer);
        document.getElementById('timer-reset').addEventListener('click', resetTimer);
        
        // Timer preset buttons
        document.querySelectorAll('.preset-button').forEach(button => {
            button.addEventListener('click', function() {
                const seconds = parseInt(this.dataset.time);
                timerSeconds = seconds;
                updateTimerDisplay();
                
                // Auto-start timer
                startTimer();
            });
        });
        
        // Save workout from timer
        document.getElementById('timer-save').addEventListener('click', function() {
            const duration = Math.round(timerSeconds / 60);
            const notes = document.getElementById('timer-notes').value;
            
            // Only save if timer has been used
            if (duration > 0) {
                // Create workout object with timer duration
                const workout = {
                    id: Date.now(),
                    type: 'other', // Default to other, user can edit later
                    name: 'Timed Workout',
                    duration: duration,
                    intensity: 'medium', // Default to medium, user can edit later
                    date: new Date().toISOString().split('T')[0],
                    notes: notes,
                    timestamp: new Date().toISOString()
                };
                
                // Add to workouts array
                workouts.push(workout);
                
                // Save to localStorage
                localStorage.setItem('workouts', JSON.stringify(workouts));
                
                // Update UI
                renderWorkouts();
                updateSummary();
                updateGoalProgress();
                renderCharts();
                
                // Reset timer
                resetTimer();
                
                // Close modal
                document.getElementById('timer-modal').style.display = 'none';
                
                // Show confirmation
                alert('Workout saved successfully!');
            } else {
                alert('Please use the timer before saving a workout.');
            }
        });
        
        function startTimer() {
            if (!timerRunning) {
                timerRunning = true;
                
                // Update button states
                document.getElementById('timer-start').disabled = true;
                document.getElementById('timer-pause').disabled = false;
                document.getElementById('timer-save').disabled = true;
                
                // Start the timer
                timerInterval = setInterval(function() {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }
        
        function pauseTimer() {
            if (timerRunning) {
                timerRunning = false;
                
                // Update button states
                document.getElementById('timer-start').disabled = false;
                document.getElementById('timer-pause').disabled = true;
                document.getElementById('timer-save').disabled = false;
                
                // Stop the timer
                clearInterval(timerInterval);
            }
        }
        
        function resetTimer() {
            // Stop the timer if running
            if (timerRunning) {
                clearInterval(timerInterval);
                timerRunning = false;
            }
            
            // Reset time
            timerSeconds = 0;
            
            // Update display
            updateTimerDisplay();
            
            // Reset button states
            document.getElementById('timer-start').disabled = false;
            document.getElementById('timer-pause').disabled = true;
            document.getElementById('timer-save').disabled = true;
            
            // Clear notes
            document.getElementById('timer-notes').value = '';
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
            
            // Format as HH:MM:SS
            const display = [
                hours.toString().padStart(2, '0'),
                minutes.toString().padStart(2, '0'),
                seconds.toString().padStart(2, '0')
            ].join(':');
            
            document.getElementById('timer-display').textContent = display;
        }
        
        // Export/Import functionality
        document.getElementById('export-data').addEventListener('click', exportData);
        document.getElementById('import-data').addEventListener('click', function() {
            // Create an import modal
            const importModal = document.createElement('div');
            importModal.className = 'modal';
            importModal.style.display = 'flex';
            
            importModal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" id="close-import-modal">&times;</span>
                    <h2>Import Data</h2>
                    <p>Upload a JSON file with your workout data.</p>
                    <div class="import-area" id="import-area">
                        <p>Click to select file or drag and drop</p>
                    </div>
                    <input type="file" id="import-file" accept=".json">
                    <button id="import-btn" disabled>Import Data</button>
                </div>
            `;
            
            document.body.appendChild(importModal);
            
            // Setup file input
            const importArea = document.getElementById('import-area');
            const fileInput = document.getElementById('import-file');
            const importBtn = document.getElementById('import-btn');
            
            // Close button
            document.getElementById('close-import-modal').addEventListener('click', function() {
                document.body.removeChild(importModal);
            });
            
            // Click to select file
            importArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // Handle file selection
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    importArea.textContent = `File selected: ${this.files[0].name}`;
                    importBtn.disabled = false;
                }
            });
            
            // Drag and drop
            importArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                importArea.style.borderColor = 'var(--primary-color)';
            });
            
            importArea.addEventListener('dragleave', function() {
                importArea.style.borderColor = 'rgba(255,255,255,0.2)';
            });
            
            importArea.addEventListener('drop', function(e) {
                e.preventDefault();
                importArea.style.borderColor = 'rgba(255,255,255,0.2)';
                
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    importArea.textContent = `File selected: ${e.dataTransfer.files[0].name}`;
                    importBtn.disabled = false;
                }
            });
            
            // Import button
            importBtn.addEventListener('click', function() {
                const file = fileInput.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (importedData.workouts) {
                                if (confirm('This will replace your current workout data. Continue?')) {
                                    workouts = importedData.workouts;
                                    localStorage.setItem('workouts', JSON.stringify(workouts));
                                    
                                    if (importedData.goals) {
                                        goals = importedData.goals;
                                        localStorage.setItem('goals', JSON.stringify(goals));
                                    }
                                    
                                    renderWorkouts();
                                    updateSummary();
                                    updateGoalProgress();
                                    renderCharts();
                                    
                                    alert('Data imported successfully!');
                                    document.body.removeChild(importModal);
                                }
                            } else {
                                alert('Invalid data format. The file should contain a "workouts" array.');
                            }
                        } catch (error) {
                            alert('Error parsing file: ' + error.message);
                        }
                    };
                    
                    reader.readAsText(file);
                }
            });
        });
        
        function exportData() {
            // Create export data object
            const exportData = {
                workouts: workouts,
                goals: goals,
                exportDate: new Date().toISOString()
            };
            
            // Convert to JSON string
            const dataStr = JSON.stringify(exportData, null, 2);
            
            // Create download link
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            // Create timestamp for filename
            const timestamp = new Date().toISOString().replace(/:/g, '-').split('.')[0];
            
            // Create invisible link and trigger download
            const exportLink = document.createElement('a');
            exportLink.setAttribute('href', dataUri);
            exportLink.setAttribute('download', `workout-data-${timestamp}.json`);
            exportLink.style.display = 'none';
            
            document.body.appendChild(exportLink);
            exportLink.click();
            document.body.removeChild(exportLink);
        }
        
        // Chart visualization
        function renderCharts() {
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = '';
            
            if (workouts.length === 0) {
                chartContainer.innerHTML = '<p class="empty-state">Add workouts to see charts and analytics.</p>';
                return;
            }
            
            // Create chart wrapper
            const chartWrapper = document.createElement('div');
            chartWrapper.className = 'chart-wrapper';
            chartContainer.appendChild(chartWrapper);
            
            // Get data for charts
            const last30Days = getLast30DaysData();
            
            // Render chart with canvas and JavaScript
            chartWrapper.innerHTML = '<canvas id="workout-chart" width="100%" height="280"></canvas>';
            
            // Create simple bar chart with workouts per day (last 30 days)
            const canvas = document.getElementById('workout-chart');
            const ctx = canvas.getContext('2d');
            
            // Calculate canvas dimensions
            const canvasWidth = canvas.clientWidth;
            const canvasHeight = canvas.clientHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // Chart configurations
            const chartPadding = 40;
            const barPadding = 2;
            const barWidth = (canvasWidth - 2 * chartPadding) / last30Days.days.length - barPadding;
            
            // Find max value for scaling
            const maxCardio = Math.max(...last30Days.cardio);
            const maxStrength = Math.max(...last30Days.strength);
            const maxFlexibility = Math.max(...last30Days.flexibility);
            const maxOther = Math.max(...last30Days.other);
            const maxValue = Math.max(maxCardio, maxStrength, maxFlexibility, maxOther, 1);
            
            // Draw chart background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // Draw axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath();
            ctx.moveTo(chartPadding, chartPadding);
            ctx.lineTo(chartPadding, canvasHeight - chartPadding);
            ctx.lineTo(canvasWidth - chartPadding, canvasHeight - chartPadding);
            ctx.stroke();
            
            // Draw y-axis labels
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            for (let i = 0; i <= 5; i++) {
                const value = Math.round(maxValue * (i / 5));
                const y = canvasHeight - chartPadding - ((canvasHeight - 2 * chartPadding) * (i / 5));
                
                ctx.fillText(value.toString(), chartPadding - 5, y);
                
                // Draw horizontal grid lines
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.beginPath();
                ctx.moveTo(chartPadding, y);
                ctx.lineTo(canvasWidth - chartPadding, y);
                ctx.stroke();
            }
            
            // Draw x-axis labels (every 5 days)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            
            for (let i = 0; i < last30Days.days.length; i += 5) {
                const x = chartPadding + i * (barWidth + barPadding) + barWidth / 2;
                ctx.fillText(last30Days.days[i], x, canvasHeight - chartPadding + 5);
            }
            
            // Draw title
            ctx.textAlign = 'center';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Workouts per Day (Last 30 Days)', canvasWidth / 2, 15);
            
            // Draw bars for each workout type
            for (let i = 0; i < last30Days.days.length; i++) {
                const x = chartPadding + i * (barWidth + barPadding);
                const barHeight = canvasHeight - 2 * chartPadding;
                
                // Cardio
                const cardioValue = last30Days.cardio[i];
                if (cardioValue > 0) {
                    const cardioHeight = (cardioValue / maxValue) * barHeight;
                    ctx.fillStyle = 'rgba(255, 77, 77, 0.7)';
                    ctx.fillRect(x, canvasHeight - chartPadding - cardioHeight, barWidth / 4, cardioHeight);
                }
                
                // Strength
                const strengthValue = last30Days.strength[i];
                if (strengthValue > 0) {
                    const strengthHeight = (strengthValue / maxValue) * barHeight;
                    ctx.fillStyle = 'rgba(0, 153, 255, 0.7)';
                    ctx.fillRect(x + barWidth / 4, canvasHeight - chartPadding - strengthHeight, barWidth / 4, strengthHeight);
                }
                
                // Flexibility
                const flexValue = last30Days.flexibility[i];
                if (flexValue > 0) {
                    const flexHeight = (flexValue / maxValue) * barHeight;
                    ctx.fillStyle = 'rgba(153, 51, 255, 0.7)';
                    ctx.fillRect(x + 2 * barWidth / 4, canvasHeight - chartPadding - flexHeight, barWidth / 4, flexHeight);
                }
                
                // Other
                const otherValue = last30Days.other[i];
                if (otherValue > 0) {
                    const otherHeight = (otherValue / maxValue) * barHeight;
                    ctx.fillStyle = 'rgba(0, 204, 153, 0.7)';
                    ctx.fillRect(x + 3 * barWidth / 4, canvasHeight - chartPadding - otherHeight, barWidth / 4, otherHeight);
                }
            }
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'chart-legend';
            legend.innerHTML = `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(255, 77, 77, 0.7)"></div>
                    <span>Cardio</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(0, 153, 255, 0.7)"></div>
                    <span>Strength</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(153, 51, 255, 0.7)"></div>
                    <span>Flexibility</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(0, 204, 153, 0.7)"></div>
                    <span>Other</span>
                </div>
            `;
            chartContainer.appendChild(legend);
        }
        
        function getLast30DaysData() {
            // Generate array of last 30 days
            const days = [];
            const cardioData = [];
            const strengthData = [];
            const flexibilityData = [];
            const otherData = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const shortDate = `${date.getMonth() + 1}/${date.getDate()}`;
                
                days.push(shortDate);
                
                // Count workouts by type for this day
                const dayWorkouts = workouts.filter(w => w.date === dateStr);
                
                cardioData.push(dayWorkouts.filter(w => w.type === 'cardio').length);
                strengthData.push(dayWorkouts.filter(w => w.type === 'strength').length);
                flexibilityData.push(dayWorkouts.filter(w => w.type === 'flexibility').length);
                otherData.push(dayWorkouts.filter(w => w.type === 'other').length);
            }
            
            return {
                days: days,
                cardio: cardioData,
                strength: strengthData,
                flexibility: flexibilityData,
                other: otherData
            };
        }
        
        // Action button event listeners
        document.getElementById('open-goals').addEventListener('click', function() {
            document.getElementById('goals-modal').style.display = 'flex';
            renderGoals();
        });
        
        // Statistics Dashboard functionality
        document.getElementById('open-stats').addEventListener('click', function() {
            document.getElementById('stats-modal').style.display = 'flex';
            renderStats('week');
        });
        
        document.getElementById('close-stats-modal').addEventListener('click', function() {
            document.getElementById('stats-modal').style.display = 'none';
        });
        
        document.querySelectorAll('.stats-time-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('.stats-time-btn').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Render stats for selected timeframe
                renderStats(this.dataset.timeframe);
            });
        });
        
        function renderStats(timeframe) {
            // Get filtered workouts based on timeframe
            let filteredWorkouts = [...workouts];
            const today = new Date();
            
            if (timeframe === 'week') {
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay());
                startOfWeek.setHours(0, 0, 0, 0);
                filteredWorkouts = filteredWorkouts.filter(workout => new Date(workout.date) >= startOfWeek);
            } else if (timeframe === 'month') {
                const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                filteredWorkouts = filteredWorkouts.filter(workout => new Date(workout.date) >= startOfMonth);
            } else if (timeframe === 'year') {
                const startOfYear = new Date(today.getFullYear(), 0, 1);
                filteredWorkouts = filteredWorkouts.filter(workout => new Date(workout.date) >= startOfYear);
            }
            
            // Calculate statistics
            const totalWorkouts = filteredWorkouts.length;
            const totalDuration = filteredWorkouts.reduce((sum, workout) => sum + workout.duration, 0);
            
            // Calculate average workouts per week
            let avgPerWeek = 0;
            if (totalWorkouts > 0) {
                if (timeframe === 'week') {
                    avgPerWeek = totalWorkouts;
                } else if (timeframe === 'month') {
                    avgPerWeek = Math.round((totalWorkouts / 30) * 7 * 10) / 10;
                } else if (timeframe === 'year') {
                    avgPerWeek = Math.round((totalWorkouts / 365) * 7 * 10) / 10;
                } else {
                    // All time - calculate weeks since first workout
                    const dates = workouts.map(w => new Date(w.date)).sort((a, b) => a - b);
                    if (dates.length > 0) {
                        const firstDate = dates[0];
                        const weeks = Math.max(1, Math.ceil((today - firstDate) / (7 * 24 * 60 * 60 * 1000)));
                        avgPerWeek = Math.round((totalWorkouts / weeks) * 10) / 10;
                    }
                }
            }
            
            // Count by type
            const cardioCount = filteredWorkouts.filter(w => w.type === 'cardio').length;
            const strengthCount = filteredWorkouts.filter(w => w.type === 'strength').length;
            const flexibilityCount = filteredWorkouts.filter(w => w.type === 'flexibility').length;
            
            // Update UI
            document.getElementById('stats-total-workouts').textContent = totalWorkouts;
            document.getElementById('stats-total-duration').textContent = totalDuration;
            document.getElementById('stats-avg-per-week').textContent = avgPerWeek;
            document.getElementById('stats-cardio-count').textContent = cardioCount;
            document.getElementById('stats-strength-count').textContent = strengthCount;
            document.getElementById('stats-flexibility-count').textContent = flexibilityCount;
            
            // Render intensity chart
            renderIntensityChart(filteredWorkouts);
            
            // Render consistency chart
            renderConsistencyChart(filteredWorkouts, timeframe);
        }
        
        function renderIntensityChart(filteredWorkouts) {
            const canvas = document.getElementById('stats-intensity-chart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set canvas dimensions
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            
            // Count workouts by intensity
            const lowCount = filteredWorkouts.filter(w => w.intensity === 'low').length;
            const mediumCount = filteredWorkouts.filter(w => w.intensity === 'medium').length;
            const highCount = filteredWorkouts.filter(w => w.intensity === 'high').length;
            
            // If no data, show message
            if (lowCount + mediumCount + highCount === 0) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No workout data available', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Chart settings
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.8;
            
            // Calculate total for percentages
            const total = lowCount + mediumCount + highCount;
            
            // Draw title
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Workout Intensity Distribution', centerX, 25);
            
            // Draw chart
            let startAngle = 0;
            
            // Low intensity slice
            if (lowCount > 0) {
                const sliceAngle = (lowCount / total) * 2 * Math.PI;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = 'rgba(75, 192, 192, 0.7)';
                ctx.fill();
                
                // Label
                const labelAngle = startAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`${Math.round((lowCount / total) * 100)}%`, labelX, labelY);
                
                startAngle += sliceAngle;
            }
            
            // Medium intensity slice
            if (mediumCount > 0) {
                const sliceAngle = (mediumCount / total) * 2 * Math.PI;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = 'rgba(255, 206, 86, 0.7)';
                ctx.fill();
                
                // Label
                const labelAngle = startAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`${Math.round((mediumCount / total) * 100)}%`, labelX, labelY);
                
                startAngle += sliceAngle;
            }
            
            // High intensity slice
            if (highCount > 0) {
                const sliceAngle = (highCount / total) * 2 * Math.PI;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = 'rgba(255, 99, 132, 0.7)';
                ctx.fill();
                
                // Label
                const labelAngle = startAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`${Math.round((highCount / total) * 100)}%`, labelX, labelY);
            }
            
            // Legend
            const legendY = canvas.height - 30;
            
            // Low
            ctx.fillStyle = 'rgba(75, 192, 192, 0.7)';
            ctx.fillRect(centerX - 150, legendY, 15, 15);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.textAlign = 'left';
            ctx.font = '14px Arial';
            ctx.fillText('Low', centerX - 130, legendY + 12);
            
            // Medium
            ctx.fillStyle = 'rgba(255, 206, 86, 0.7)';
            ctx.fillRect(centerX - 50, legendY, 15, 15);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText('Medium', centerX - 30, legendY + 12);
            
            // High
            ctx.fillStyle = 'rgba(255, 99, 132, 0.7)';
            ctx.fillRect(centerX + 50, legendY, 15, 15);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText('High', centerX + 70, legendY + 12);
        }
        
        function renderConsistencyChart(filteredWorkouts, timeframe) {
            const canvas = document.getElementById('stats-consistency-chart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set canvas dimensions
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            
            // Prepare data based on timeframe
            let labels = [];
            let data = [];
            
            const today = new Date();
            
            if (timeframe === 'week') {
                // Last 7 days
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    
                    labels.push(dayName);
                    data.push(filteredWorkouts.filter(w => w.date === dateStr).length);
                }
            } else if (timeframe === 'month') {
                // Last 4 weeks
                for (let i = 3; i >= 0; i--) {
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - (today.getDay() + i * 7));
                    weekStart.setHours(0, 0, 0, 0);
                    
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    weekEnd.setHours(23, 59, 59, 999);
                    
                    labels.push(`Week ${4-i}`);
                    
                    data.push(filteredWorkouts.filter(w => {
                        const date = new Date(w.date);
                        return date >= weekStart && date <= weekEnd;
                    }).length);
                }
            } else if (timeframe === 'year' || timeframe === 'all') {
                // Last 12 months
                for (let i = 11; i >= 0; i--) {
                    const monthDate = new Date(today.getFullYear(), today.getMonth() - i, 1);
                    const monthName = monthDate.toLocaleDateString('en-US', { month: 'short' });
                    
                    labels.push(monthName);
                    
                    const monthYear = monthDate.getFullYear();
                    const month = monthDate.getMonth();
                    
                    data.push(filteredWorkouts.filter(w => {
                        const date = new Date(w.date);
                        return date.getFullYear() === monthYear && date.getMonth() === month;
                    }).length);
                }
            }
            
            // If no data, show message
            if (data.every(val => val === 0)) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No workout data available', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Chart settings
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            const barSpacing = chartWidth / labels.length;
            const barWidth = barSpacing * 0.7;
            
            // Find max value for scaling
            const maxValue = Math.max(...data, 1);
            
            // Draw title
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Workout Consistency', canvas.width / 2, 25);
            
            // Draw y-axis
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw x-axis
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw y-axis labels and grid lines
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            for (let i = 0; i <= 5; i++) {
                const value = Math.ceil(maxValue * i / 5);
                const y = canvas.height - padding - (chartHeight * i / 5);
                
                ctx.fillText(value.toString(), padding - 5, y);
                
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Draw bars and x-axis labels
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            
            for (let i = 0; i < labels.length; i++) {
                const x = padding + i * barSpacing + (barSpacing - barWidth) / 2;
                const barHeight = (data[i] / maxValue) * chartHeight;
                const y = canvas.height - padding - barHeight;
                
                // Draw bar
                const gradient = ctx.createLinearGradient(x, y, x, canvas.height - padding);
                gradient.addColorStop(0, 'rgba(75, 192, 192, 0.8)');
                gradient.addColorStop(1, 'rgba(75, 192, 192, 0.3)');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Draw label
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.fillText(labels[i], x + barWidth / 2, canvas.height - padding + 5);
                
                // Draw value above bar if there's data
                if (data[i] > 0) {
                    ctx.fillText(data[i].toString(), x + barWidth / 2, y - 20);
                }
            }
        }
        
        // Exercise Library functionality
        document.getElementById('open-exercise-library').addEventListener('click', function() {
            document.getElementById('exercise-library-modal').style.display = 'flex';
            renderExerciseLibrary();
        });
        
        document.getElementById('close-exercise-library-modal').addEventListener('click', function() {
            document.getElementById('exercise-library-modal').style.display = 'none';
        });
        
        document.getElementById('add-exercise-btn').addEventListener('click', function() {
            // Show the add exercise form
            document.getElementById('add-exercise-form').style.display = 'block';
            document.getElementById('exercise-library-list').style.display = 'none';
            document.getElementById('exercise-detail').style.display = 'none';
        });
        
        document.getElementById('cancel-exercise').addEventListener('click', function() {
            // Hide the add exercise form
            document.getElementById('add-exercise-form').style.display = 'none';
            document.getElementById('exercise-library-list').style.display = 'grid';
            
            // Reset the form
            document.getElementById('exercise-library-form').reset();
        });
        
        document.getElementById('back-to-exercises').addEventListener('click', function() {
            // Hide the exercise detail view
            document.getElementById('exercise-detail').style.display = 'none';
            document.getElementById('exercise-library-list').style.display = 'grid';
        });
        
        document.getElementById('exercise-library-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const name = document.getElementById('exercise-lib-name').value.trim();
            const category = document.getElementById('exercise-lib-category').value;
            const equipment = document.getElementById('exercise-lib-equipment').value;
            const muscles = document.getElementById('exercise-lib-muscles').value.trim();
            const description = document.getElementById('exercise-lib-description').value.trim();
            const notes = document.getElementById('exercise-lib-notes').value.trim();
            
            // Create exercise object
            const exercise = {
                id: Date.now(),
                name,
                category,
                equipment,
                muscles,
                description,
                notes,
                createdAt: new Date().toISOString()
            };
            
            // Check if this exercise name already exists
            const existingExercise = exerciseLibrary.find(ex => 
                ex.name.toLowerCase() === name.toLowerCase()
            );
            
            if (existingExercise) {
                if (!confirm('An exercise with this name already exists. Do you want to overwrite it?')) {
                    return;
                }
                
                // Find and update the existing exercise
                const index = exerciseLibrary.findIndex(ex => 
                    ex.name.toLowerCase() === name.toLowerCase()
                );
                
                exerciseLibrary[index] = {
                    ...exercise,
                    id: existingExercise.id  // Preserve the original ID
                };
            } else {
                // Add to exerciseLibrary array
                exerciseLibrary.push(exercise);
            }
            
            // Save to localStorage
            localStorage.setItem('exercise-library', JSON.stringify(exerciseLibrary));
            
            // Hide the add exercise form
            document.getElementById('add-exercise-form').style.display = 'none';
            document.getElementById('exercise-library-list').style.display = 'grid';
            
            // Reset the form
            this.reset();
            
            // Re-render the exercise library
            renderExerciseLibrary();
            
            // Show confirmation
            alert('Exercise saved to library!');
        });
        
        // Search exercises
        document.getElementById('exercise-search').addEventListener('input', function() {
            renderExerciseLibrary();
        });
        
        // Filter exercises by category
        document.getElementById('exercise-category-filter').addEventListener('change', function() {
            renderExerciseLibrary();
        });
        
        function renderExerciseLibrary() {
            const libraryList = document.getElementById('exercise-library-list');
            const emptyState = document.getElementById('empty-exercises');
            const searchTerm = document.getElementById('exercise-search').value.toLowerCase();
            const categoryFilter = document.getElementById('exercise-category-filter').value;
            
            // Show the library list, hide other views
            libraryList.style.display = 'grid';
            document.getElementById('add-exercise-form').style.display = 'none';
            document.getElementById('exercise-detail').style.display = 'none';
            
            // Filter exercises by search term and category
            let filteredExercises = [...exerciseLibrary];
            
            if (searchTerm) {
                filteredExercises = filteredExercises.filter(exercise => 
                    exercise.name.toLowerCase().includes(searchTerm) ||
                    exercise.muscles.toLowerCase().includes(searchTerm) ||
                    exercise.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (categoryFilter !== 'all') {
                filteredExercises = filteredExercises.filter(exercise => exercise.category === categoryFilter);
            }
            
            // Sort exercises by name
            filteredExercises.sort((a, b) => a.name.localeCompare(b.name));
            
            if (filteredExercises.length === 0) {
                emptyState.style.display = 'block';
                libraryList.innerHTML = '';
                libraryList.appendChild(emptyState);
                return;
            }
            
            emptyState.style.display = 'none';
            libraryList.innerHTML = '';
            
            filteredExercises.forEach(exercise => {
                const exerciseCard = document.createElement('div');
                exerciseCard.className = `exercise-card ${exercise.category}`;
                exerciseCard.dataset.id = exercise.id;
                
                exerciseCard.innerHTML = `
                    <div class="exercise-title">${exercise.name}</div>
                    <div class="exercise-muscles">${exercise.muscles || 'No muscles specified'}</div>
                    <div class="exercise-equipment">${getEquipmentName(exercise.equipment)}</div>
                `;
                
                // Make card clickable to view details
                exerciseCard.addEventListener('click', function() {
                    showExerciseDetail(exercise.id);
                });
                
                libraryList.appendChild(exerciseCard);
            });
        }
        
        function showExerciseDetail(exerciseId) {
            const exercise = exerciseLibrary.find(ex => ex.id === exerciseId);
            if (!exercise) return;
            
            const detailContainer = document.getElementById('exercise-detail');
            const detailContent = document.getElementById('exercise-detail-content');
            
            // Hide the library list, show detail view
            document.getElementById('exercise-library-list').style.display = 'none';
            detailContainer.style.display = 'block';
            
            // Format muscles as tags
            const muscleTagsHtml = exercise.muscles
                .split(',')
                .map(muscle => `<span class="muscle-tag">${muscle.trim()}</span>`)
                .join('');
            
            // Create HTML for detail view
            detailContent.innerHTML = `
                <div class="exercise-detail-header">
                    <div class="exercise-detail-name">${exercise.name}</div>
                    <span class="exercise-detail-category ${exercise.category}">${getCategoryName(exercise.category)}</span>
                </div>
                
                <div class="exercise-detail-section">
                    <h3>Equipment Needed</h3>
                    <div class="exercise-detail-equipment">
                        <span class="equipment-tag">${getEquipmentName(exercise.equipment)}</span>
                    </div>
                </div>
                
                <div class="exercise-detail-section">
                    <h3>Muscles Targeted</h3>
                    <div class="exercise-detail-muscles">
                        ${muscleTagsHtml || '<span class="muscle-tag">No muscles specified</span>'}
                    </div>
                </div>
                
                <div class="exercise-detail-section">
                    <h3>Description</h3>
                    <div class="exercise-detail-content">
                        ${exercise.description || 'No description provided.'}
                    </div>
                </div>
                
                ${exercise.notes ? `
                <div class="exercise-detail-section">
                    <h3>Personal Notes</h3>
                    <div class="exercise-detail-content">
                        ${exercise.notes}
                    </div>
                </div>
                ` : ''}
                
                <div class="exercise-detail-actions">
                    <button class="action-button edit-exercise-btn" data-id="${exercise.id}">Edit Exercise</button>
                    <button class="action-button delete-exercise-btn" data-id="${exercise.id}">Delete Exercise</button>
                </div>
            `;
            
            // Add event listeners for edit and delete buttons
            detailContent.querySelector('.edit-exercise-btn').addEventListener('click', function() {
                editExercise(exercise.id);
            });
            
            detailContent.querySelector('.delete-exercise-btn').addEventListener('click', function() {
                if (confirm('Are you sure you want to delete this exercise?')) {
                    exerciseLibrary = exerciseLibrary.filter(ex => ex.id !== exercise.id);
                    localStorage.setItem('exercise-library', JSON.stringify(exerciseLibrary));
                    
                    // Go back to the library list
                    document.getElementById('exercise-detail').style.display = 'none';
                    document.getElementById('exercise-library-list').style.display = 'grid';
                    
                    renderExerciseLibrary();
                }
            });
        }
        
        function editExercise(exerciseId) {
            const exercise = exerciseLibrary.find(ex => ex.id === exerciseId);
            if (!exercise) return;
            
            // Populate the form with exercise data
            document.getElementById('exercise-lib-name').value = exercise.name;
            document.getElementById('exercise-lib-category').value = exercise.category;
            document.getElementById('exercise-lib-equipment').value = exercise.equipment;
            document.getElementById('exercise-lib-muscles').value = exercise.muscles;
            document.getElementById('exercise-lib-description').value = exercise.description;
            document.getElementById('exercise-lib-notes').value = exercise.notes;
            
            // Hide detail view, show form
            document.getElementById('exercise-detail').style.display = 'none';
            document.getElementById('add-exercise-form').style.display = 'block';
            
            // Change form submit behavior temporarily
            const form = document.getElementById('exercise-library-form');
            const originalOnSubmit = form.onsubmit;
            
            form.onsubmit = function(e) {
                e.preventDefault();
                
                // Get updated values
                const name = document.getElementById('exercise-lib-name').value.trim();
                const category = document.getElementById('exercise-lib-category').value;
                const equipment = document.getElementById('exercise-lib-equipment').value;
                const muscles = document.getElementById('exercise-lib-muscles').value.trim();
                const description = document.getElementById('exercise-lib-description').value.trim();
                const notes = document.getElementById('exercise-lib-notes').value.trim();
                
                // Update exercise
                const exerciseIndex = exerciseLibrary.findIndex(ex => ex.id === exerciseId);
                exerciseLibrary[exerciseIndex] = {
                    ...exerciseLibrary[exerciseIndex],
                    name,
                    category,
                    equipment,
                    muscles,
                    description,
                    notes
                };
                
                // Save to localStorage
                localStorage.setItem('exercise-library', JSON.stringify(exerciseLibrary));
                
                // Hide form, show library list
                document.getElementById('add-exercise-form').style.display = 'none';
                document.getElementById('exercise-library-list').style.display = 'grid';
                
                // Reset form
                form.reset();
                
                // Restore original submit handler
                form.onsubmit = originalOnSubmit;
                
                // Re-render library
                renderExerciseLibrary();
                
                // Show confirmation
                alert('Exercise updated successfully!');
            };
        }
        
        // Helper function to get readable equipment name
        function getEquipmentName(code) {
            const equipmentMap = {
                'none': 'Bodyweight',
                'dumbbells': 'Dumbbells',
                'barbell': 'Barbell',
                'kettlebell': 'Kettlebell',
                'resistance': 'Resistance Bands',
                'cable': 'Cable Machine',
                'machine': 'Weight Machine',
                'cardio': 'Cardio Equipment',
                'other': 'Other Equipment'
            };
            
            return equipmentMap[code] || code;
        }
        
        // Helper function to get readable category name
        function getCategoryName(code) {
            const categoryMap = {
                'upper': 'Upper Body',
                'lower': 'Lower Body',
                'core': 'Core',
                'cardio': 'Cardio',
                'flexibility': 'Flexibility',
                'other': 'Other'
            };
            
            return categoryMap[code] || code;
        }
        
        // Personal Records functionality
        document.getElementById('open-records').addEventListener('click', function() {
            document.getElementById('records-modal').style.display = 'flex';
            renderPersonalRecords();
        });
        
        document.getElementById('close-records-modal').addEventListener('click', function() {
            document.getElementById('records-modal').style.display = 'none';
        });
        
        document.getElementById('add-record-btn').addEventListener('click', function() {
            // Show the add record form
            document.getElementById('add-record-form').style.display = 'block';
            
            // Pre-fill date with today's date
            document.getElementById('record-date').valueAsDate = new Date();
        });
        
        document.getElementById('cancel-record').addEventListener('click', function() {
            // Hide the add record form
            document.getElementById('add-record-form').style.display = 'none';
            
            // Reset the form
            document.getElementById('record-form').reset();
        });
        
        document.getElementById('record-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const exerciseName = document.getElementById('record-name').value.trim();
            const category = document.getElementById('record-category').value;
            const value = parseFloat(document.getElementById('record-value').value);
            const unit = document.getElementById('record-unit').value;
            const date = document.getElementById('record-date').value;
            const notes = document.getElementById('record-notes').value.trim();
            
            // Create record object
            const record = {
                id: Date.now(),
                exerciseName,
                category,
                value,
                unit,
                date,
                notes,
                createdAt: new Date().toISOString()
            };
            
            // Check if this is a new personal record
            let isPersonalRecord = true;
            
            // Find previous records for this exercise with the same unit
            const previousRecords = personalRecords.filter(r => 
                r.exerciseName.toLowerCase() === exerciseName.toLowerCase() && 
                r.unit === unit
            );
            
            // For time-based units (min, sec), lower is better
            if (unit === 'min' || unit === 'sec') {
                const bestRecord = previousRecords.reduce((best, current) => {
                    return (best === null || current.value < best.value) ? current : best;
                }, null);
                
                isPersonalRecord = !bestRecord || value < bestRecord.value;
            } else {
                // For other units (weight, reps, distance), higher is better
                const bestRecord = previousRecords.reduce((best, current) => {
                    return (best === null || current.value > best.value) ? current : best;
                }, null);
                
                isPersonalRecord = !bestRecord || value > bestRecord.value;
            }
            
            // Add to personalRecords array
            personalRecords.push(record);
            
            // Save to localStorage
            localStorage.setItem('personal-records', JSON.stringify(personalRecords));
            
            // Hide the add record form
            document.getElementById('add-record-form').style.display = 'none';
            
            // Reset the form
            this.reset();
            
            // Re-render the records list
            renderPersonalRecords();
            
            // Show confirmation message
            if (isPersonalRecord) {
                alert('New personal record added! 🎉');
            } else {
                alert('Record added successfully!');
            }
        });
        
        // Filter records by category
        document.getElementById('records-category-filter').addEventListener('change', function() {
            renderPersonalRecords();
        });
        
        function renderPersonalRecords() {
            const recordsList = document.getElementById('records-list');
            const emptyState = document.getElementById('empty-records');
            const categoryFilter = document.getElementById('records-category-filter').value;
            
            // Filter records by category if needed
            let filteredRecords = [...personalRecords];
            if (categoryFilter !== 'all') {
                filteredRecords = filteredRecords.filter(record => record.category === categoryFilter);
            }
            
            // Sort records by date (newest first)
            filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredRecords.length === 0) {
                emptyState.style.display = 'block';
                recordsList.innerHTML = '';
                recordsList.appendChild(emptyState);
                return;
            }
            
            emptyState.style.display = 'none';
            recordsList.innerHTML = '';
            
            filteredRecords.forEach(record => {
                // Create record card element
                const recordCard = document.createElement('div');
                recordCard.className = `record-card ${record.category}`;
                recordCard.dataset.id = record.id;
                
                // Format date
                const recordDate = new Date(record.date);
                const formattedDate = recordDate.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                // Check if it's a personal best
                let personalBest = false;
                const sameExerciseRecords = personalRecords.filter(r => 
                    r.exerciseName.toLowerCase() === record.exerciseName.toLowerCase() && 
                    r.unit === record.unit
                );
                
                if (record.unit === 'min' || record.unit === 'sec') {
                    // For time units, lower is better
                    const bestValue = Math.min(...sameExerciseRecords.map(r => r.value));
                    personalBest = record.value === bestValue;
                } else {
                    // For other units, higher is better
                    const bestValue = Math.max(...sameExerciseRecords.map(r => r.value));
                    personalBest = record.value === bestValue;
                }
                
                // Create HTML for record card
                recordCard.innerHTML = `
                    <div class="record-actions">
                        <button class="record-btn edit-record" data-id="${record.id}" title="Edit Record">✏️</button>
                        <button class="record-btn delete-record" data-id="${record.id}" title="Delete Record">🗑️</button>
                    </div>
                    <div class="record-header">
                        <div class="record-title">${record.exerciseName}</div>
                        <span class="record-category ${record.category}">${record.category}</span>
                    </div>
                    <div class="record-value">${record.value} ${record.unit} ${personalBest ? '🏆' : ''}</div>
                    <div class="record-date">${formattedDate}</div>
                    ${record.notes ? `<div class="record-notes">${record.notes}</div>` : ''}
                `;
                
                recordsList.appendChild(recordCard);
            });
            
            // Add event listeners for delete and edit buttons
            document.querySelectorAll('.delete-record').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    if (confirm('Are you sure you want to delete this record?')) {
                        personalRecords = personalRecords.filter(record => record.id !== id);
                        localStorage.setItem('personal-records', JSON.stringify(personalRecords));
                        renderPersonalRecords();
                    }
                });
            });
            
            document.querySelectorAll('.edit-record').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    const record = personalRecords.find(r => r.id === id);
                    
                    if (record) {
                        // Populate the form with the record's data
                        document.getElementById('record-name').value = record.exerciseName;
                        document.getElementById('record-category').value = record.category;
                        document.getElementById('record-value').value = record.value;
                        document.getElementById('record-unit').value = record.unit;
                        document.getElementById('record-date').value = record.date;
                        document.getElementById('record-notes').value = record.notes || '';
                        
                        // Show the form
                        document.getElementById('add-record-form').style.display = 'block';
                        
                        // Change the submit handler temporarily to update instead of create
                        const form = document.getElementById('record-form');
                        const originalOnSubmit = form.onsubmit;
                        
                        form.onsubmit = function(e) {
                            e.preventDefault();
                            
                            // Update the record
                            const recordIndex = personalRecords.findIndex(r => r.id === id);
                            personalRecords[recordIndex] = {
                                ...personalRecords[recordIndex],
                                exerciseName: document.getElementById('record-name').value.trim(),
                                category: document.getElementById('record-category').value,
                                value: parseFloat(document.getElementById('record-value').value),
                                unit: document.getElementById('record-unit').value,
                                date: document.getElementById('record-date').value,
                                notes: document.getElementById('record-notes').value.trim()
                            };
                            
                            // Save to localStorage
                            localStorage.setItem('personal-records', JSON.stringify(personalRecords));
                            
                            // Hide the form
                            document.getElementById('add-record-form').style.display = 'none';
                            
                            // Reset the form
                            form.reset();
                            
                            // Re-render the records list
                            renderPersonalRecords();
                            
                            // Restore original submit handler
                            form.onsubmit = originalOnSubmit;
                            
                            // Show confirmation
                            alert('Record updated successfully!');
                        };
                    }
                });
            });
        }
        
        // Initial render
        renderWorkouts();
        updateSummary();
        updateGoalProgress();
        renderCharts();
        
        // ============================
        // WORKOUT TEMPLATES SYSTEM
        // ============================
        
        // Open templates modal
        document.getElementById('open-templates').addEventListener('click', function() {
            document.getElementById('template-selector-modal').style.display = 'flex';
            renderTemplateList();
        });
        
        // Close template modals
        document.getElementById('close-template-selector-modal').addEventListener('click', function() {
            document.getElementById('template-selector-modal').style.display = 'none';
        });
        
        document.getElementById('close-template-creator-modal').addEventListener('click', function() {
            document.getElementById('template-creator-modal').style.display = 'none';
        });
        
        document.getElementById('close-active-template-modal').addEventListener('click', function() {
            if (confirm('Are you sure you want to exit? Your progress will be lost.')) {
                document.getElementById('active-template-modal').style.display = 'none';
            }
        });
        
        // Create new template button
        document.getElementById('create-new-template').addEventListener('click', function() {
            // Close template selector modal
            document.getElementById('template-selector-modal').style.display = 'none';
            
            // Reset template creator form
            document.getElementById('template-name').value = '';
            document.getElementById('exercise-list').innerHTML = '';
            
            // Show template creator modal
            document.getElementById('template-creator-modal').style.display = 'flex';
        });
        
        // Cancel template creation
        document.getElementById('cancel-template').addEventListener('click', function() {
            document.getElementById('template-creator-modal').style.display = 'none';
            document.getElementById('template-selector-modal').style.display = 'flex';
        });
        
        // Add set button
        document.getElementById('add-set').addEventListener('click', function() {
            const setsList = document.getElementById('sets-list');
            const newSet = document.createElement('div');
            newSet.className = 'set-item';
            
            newSet.innerHTML = `
                <div class="form-group">
                    <label>Target Reps</label>
                    <input type="number" class="set-reps" min="1" value="10">
                </div>
                <div class="form-group">
                    <label>Rest Time (seconds)</label>
                    <input type="number" class="set-rest" min="0" value="60">
                </div>
                <button type="button" class="remove-set">×</button>
            `;
            
            setsList.appendChild(newSet);
            
            // Add event listener to remove set button
            newSet.querySelector('.remove-set').addEventListener('click', function() {
                setsList.removeChild(newSet);
            });
        });
        
        // Add exercise to template
        document.getElementById('add-exercise-to-template').addEventListener('click', function() {
            const exerciseName = document.getElementById('exercise-name').value.trim();
            const exerciseNotes = document.getElementById('exercise-notes').value.trim();
            
            if (!exerciseName) {
                alert('Please enter an exercise name');
                return;
            }
            
            // Get sets data
            const setItems = document.querySelectorAll('#sets-list .set-item');
            if (setItems.length === 0) {
                alert('Please add at least one set');
                return;
            }
            
            const sets = [];
            setItems.forEach(setItem => {
                const reps = parseInt(setItem.querySelector('.set-reps').value) || 10;
                const rest = parseInt(setItem.querySelector('.set-rest').value) || 60;
                
                sets.push({
                    targetReps: reps,
                    restTime: rest
                });
            });
            
            // Add exercise to list
            const exerciseList = document.getElementById('exercise-list');
            const exerciseItem = document.createElement('div');
            exerciseItem.className = 'exercise-item';
            
            let setsHtml = '';
            sets.forEach((set, index) => {
                setsHtml += `
                    <div class="exercise-set">
                        Set ${index + 1}: ${set.targetReps} reps, ${set.restTime}s rest
                    </div>
                `;
            });
            
            exerciseItem.innerHTML = `
                <h4>${exerciseName}</h4>
                ${exerciseNotes ? `<div class="exercise-notes">${exerciseNotes}</div>` : ''}
                <div class="exercise-sets">
                    ${setsHtml}
                </div>
                <button type="button" class="remove-exercise">×</button>
            `;
            
            exerciseList.appendChild(exerciseItem);
            
            // Add exercise data as a data attribute
            exerciseItem.dataset.exercise = JSON.stringify({
                name: exerciseName,
                notes: exerciseNotes,
                sets: sets
            });
            
            // Add event listener to remove exercise button
            exerciseItem.querySelector('.remove-exercise').addEventListener('click', function() {
                exerciseList.removeChild(exerciseItem);
            });
            
            // Reset exercise form
            document.getElementById('exercise-name').value = '';
            document.getElementById('exercise-notes').value = '';
            document.getElementById('sets-list').innerHTML = `
                <div class="set-item">
                    <div class="form-group">
                        <label>Target Reps</label>
                        <input type="number" class="set-reps" min="1" value="10">
                    </div>
                    <div class="form-group">
                        <label>Rest Time (seconds)</label>
                        <input type="number" class="set-rest" min="0" value="60">
                    </div>
                </div>
            `;
        });
        
        // Save template
        document.getElementById('save-template').addEventListener('click', function() {
            const templateName = document.getElementById('template-name').value.trim();
            
            if (!templateName) {
                alert('Please enter a template name');
                return;
            }
            
            const exerciseItems = document.querySelectorAll('#exercise-list .exercise-item');
            if (exerciseItems.length === 0) {
                alert('Please add at least one exercise');
                return;
            }
            
            const exercises = [];
            exerciseItems.forEach(item => {
                exercises.push(JSON.parse(item.dataset.exercise));
            });
            
            // Create template object
            const template = {
                id: Date.now(),
                name: templateName,
                exercises: exercises,
                createdAt: new Date().toISOString(),
                lastUsed: null
            };
            
            // Add to templates array
            templates.push(template);
            
            // Save to localStorage
            localStorage.setItem('workout-templates', JSON.stringify(templates));
            
            // Close template creator modal
            document.getElementById('template-creator-modal').style.display = 'none';
            
            // Show template selector modal with updated list
            document.getElementById('template-selector-modal').style.display = 'flex';
            renderTemplateList();
            
            alert('Template saved successfully!');
        });
        
        // Render template list
        function renderTemplateList() {
            const templateList = document.getElementById('template-list');
            
            if (templates.length === 0) {
                templateList.innerHTML = '<p class="empty-templates">No templates created yet. Create your first template to get started!</p>';
                return;
            }
            
            templateList.innerHTML = '';
            
            templates.forEach(template => {
                const templateCard = document.createElement('div');
                templateCard.className = 'template-card';
                templateCard.dataset.id = template.id;
                
                const lastUsedText = template.lastUsed 
                    ? `Last used: ${new Date(template.lastUsed).toLocaleDateString()}`
                    : 'Never used';
                
                templateCard.innerHTML = `
                    <div class="template-card-actions">
                        <button type="button" class="edit-template" data-id="${template.id}" title="Edit Template">✏️</button>
                        <button type="button" class="delete-template" data-id="${template.id}" title="Delete Template">🗑️</button>
                    </div>
                    <h3>${template.name}</h3>
                    <div class="template-card-info">${lastUsedText}</div>
                    <div class="template-card-exercise-count">${template.exercises.length} exercise${template.exercises.length !== 1 ? 's' : ''}</div>
                `;
                
                // Make the card clickable to start the workout
                templateCard.addEventListener('click', function(e) {
                    // Don't start the workout if the click was on a button
                    if (e.target.tagName === 'BUTTON') return;
                    
                    startTemplateWorkout(template.id);
                });
                
                templateList.appendChild(templateCard);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-template').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.dataset.id);
                    editTemplate(id);
                });
            });
            
            document.querySelectorAll('.delete-template').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.dataset.id);
                    if (confirm('Are you sure you want to delete this template?')) {
                        templates = templates.filter(template => template.id !== id);
                        localStorage.setItem('workout-templates', JSON.stringify(templates));
                        renderTemplateList();
                    }
                });
            });
        }
        
        // Edit template
        function editTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            
            if (!template) {
                alert('Template not found');
                return;
            }
            
            // Close template selector modal
            document.getElementById('template-selector-modal').style.display = 'none';
            
            // Fill template creator form
            document.getElementById('template-name').value = template.name;
            document.getElementById('exercise-list').innerHTML = '';
            
            // Add exercises to list
            template.exercises.forEach(exercise => {
                const exerciseItem = document.createElement('div');
                exerciseItem.className = 'exercise-item';
                
                let setsHtml = '';
                exercise.sets.forEach((set, index) => {
                    setsHtml += `
                        <div class="exercise-set">
                            Set ${index + 1}: ${set.targetReps} reps, ${set.restTime}s rest
                        </div>
                    `;
                });
                
                exerciseItem.innerHTML = `
                    <h4>${exercise.name}</h4>
                    ${exercise.notes ? `<div class="exercise-notes">${exercise.notes}</div>` : ''}
                    <div class="exercise-sets">
                        ${setsHtml}
                    </div>
                    <button type="button" class="remove-exercise">×</button>
                `;
                
                document.getElementById('exercise-list').appendChild(exerciseItem);
                
                // Add exercise data as a data attribute
                exerciseItem.dataset.exercise = JSON.stringify(exercise);
                
                // Add event listener to remove exercise button
                exerciseItem.querySelector('.remove-exercise').addEventListener('click', function() {
                    document.getElementById('exercise-list').removeChild(exerciseItem);
                });
            });
            
            // Update save button to save the edited template
            const saveButton = document.getElementById('save-template');
            const originalOnClick = saveButton.onclick;
            saveButton.onclick = function() {
                const templateName = document.getElementById('template-name').value.trim();
                
                if (!templateName) {
                    alert('Please enter a template name');
                    return;
                }
                
                const exerciseItems = document.querySelectorAll('#exercise-list .exercise-item');
                if (exerciseItems.length === 0) {
                    alert('Please add at least one exercise');
                    return;
                }
                
                const exercises = [];
                exerciseItems.forEach(item => {
                    exercises.push(JSON.parse(item.dataset.exercise));
                });
                
                // Update template object
                const templateIndex = templates.findIndex(t => t.id === templateId);
                templates[templateIndex] = {
                    ...templates[templateIndex],
                    name: templateName,
                    exercises: exercises
                };
                
                // Save to localStorage
                localStorage.setItem('workout-templates', JSON.stringify(templates));
                
                // Close template creator modal
                document.getElementById('template-creator-modal').style.display = 'none';
                
                // Show template selector modal with updated list
                document.getElementById('template-selector-modal').style.display = 'flex';
                renderTemplateList();
                
                alert('Template updated successfully!');
                
                // Restore original onclick after saving
                saveButton.onclick = originalOnClick;
            };
            
            // Show template creator modal
            document.getElementById('template-creator-modal').style.display = 'flex';
        }
        
        // Start template workout
        function startTemplateWorkout(templateId) {
            const template = templates.find(t => t.id === templateId);
            
            if (!template) {
                alert('Template not found');
                return;
            }
            
            // Update lastUsed
            template.lastUsed = new Date().toISOString();
            localStorage.setItem('workout-templates', JSON.stringify(templates));
            
            // Close template selector modal
            document.getElementById('template-selector-modal').style.display = 'none';
            
            // Prepare active template data
            const activeTemplate = {
                id: template.id,
                name: template.name,
                exercises: template.exercises.map(exercise => ({
                    ...exercise,
                    completed: false,
                    sets: exercise.sets.map(set => ({
                        ...set,
                        completed: false,
                        actualReps: 0,
                        weight: 0
                    }))
                })),
                currentExerciseIndex: 0,
                currentSetIndex: 0,
                startTime: new Date().toISOString()
            };
            
            // Store the active template in our global variable
            currentActiveTemplate = activeTemplate;
            
            // Fill active template modal
            document.getElementById('active-template-name').textContent = template.name;
            document.getElementById('total-exercises').textContent = template.exercises.length;
            document.getElementById('completed-exercises').textContent = '0';
            document.getElementById('template-progress-fill').style.width = '0%';
            
            // Show first exercise
            renderActiveExercise(activeTemplate);
            
            // Show active template modal
            document.getElementById('active-template-modal').style.display = 'flex';
            
            // Set up finish workout button
            document.getElementById('finish-workout').onclick = function() {
                finishTemplateWorkout(); // No parameter needed - will use global currentActiveTemplate
            };
            
            // Set up cancel workout button
            document.getElementById('cancel-workout').onclick = function() {
                if (confirm('Are you sure you want to cancel this workout? Your progress will be lost.')) {
                    document.getElementById('active-template-modal').style.display = 'none';
                    currentActiveTemplate = null; // Clear global variable on cancel
                }
            };
        }
        
        // Render active exercise
        function renderActiveExercise(activeTemplate) {
            // Update global currentActiveTemplate (in case it was updated)
            if (activeTemplate) {
                currentActiveTemplate = activeTemplate;
            }
            const exerciseContainer = document.getElementById('active-exercise-container');
            
            // Get current exercise and set
            const currentExercise = activeTemplate.exercises[activeTemplate.currentExerciseIndex];
            const currentSet = currentExercise.sets[activeTemplate.currentSetIndex];
            
            // Create HTML for sets progress
            let setsProgressHtml = '';
            currentExercise.sets.forEach((set, index) => {
                let setClass = '';
                if (index === activeTemplate.currentSetIndex) {
                    setClass = 'current-set';
                } else if (set.completed) {
                    setClass = 'completed-set';
                }
                
                setsProgressHtml += `
                    <div class="set-number ${setClass}">
                        ${index + 1}
                    </div>
                `;
            });
            
            // Check if we have previous performance data for this exercise
            const previousPerformance = getPreviousPerformance(activeTemplate.id, currentExercise.name);
            let previousPerformanceHtml = '';
            
            if (previousPerformance) {
                previousPerformanceHtml = `
                    <div class="previous-performance">
                        <h4>Previous Performance:</h4>
                        ${previousPerformance.sets.map((set, index) => `
                            <div class="previous-set">
                                Set ${index + 1}: ${set.weight} lbs × ${set.actualReps} reps
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Build exercise HTML
            const exerciseHtml = `
                <div class="active-exercise">
                    <h3>${currentExercise.name}</h3>
                    ${currentExercise.notes ? `<div class="exercise-notes">${currentExercise.notes}</div>` : ''}
                    
                    <div class="set-progress">
                        ${setsProgressHtml}
                    </div>
                    
                    <div class="active-set-info">
                        <h4>Set ${activeTemplate.currentSetIndex + 1} - Target: ${currentSet.targetReps} reps</h4>
                        ${previousPerformanceHtml}
                    </div>
                    
                    <form class="active-set-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="actual-weight">Weight (lbs)</label>
                                <input type="number" id="actual-weight" min="0" step="2.5" required>
                            </div>
                            <div class="form-group">
                                <label for="actual-reps">Reps Completed</label>
                                <input type="number" id="actual-reps" min="0" required>
                            </div>
                        </div>
                        <button type="submit" id="complete-set">Complete Set</button>
                    </form>
                </div>
            `;
            
            exerciseContainer.innerHTML = exerciseHtml;
            
            // Pre-fill with previous set data if available
            const prevSetIndex = activeTemplate.currentSetIndex - 1;
            if (prevSetIndex >= 0 && currentExercise.sets[prevSetIndex].completed) {
                document.getElementById('actual-weight').value = currentExercise.sets[prevSetIndex].weight;
            } else if (previousPerformance && previousPerformance.sets[activeTemplate.currentSetIndex]) {
                document.getElementById('actual-weight').value = previousPerformance.sets[activeTemplate.currentSetIndex].weight;
            }
            
            // Add form submission handler
            document.querySelector('.active-set-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const weight = parseFloat(document.getElementById('actual-weight').value) || 0;
                const reps = parseInt(document.getElementById('actual-reps').value) || 0;
                
                // Update set data
                activeTemplate.exercises[activeTemplate.currentExerciseIndex]
                    .sets[activeTemplate.currentSetIndex].completed = true;
                activeTemplate.exercises[activeTemplate.currentExerciseIndex]
                    .sets[activeTemplate.currentSetIndex].weight = weight;
                activeTemplate.exercises[activeTemplate.currentExerciseIndex]
                    .sets[activeTemplate.currentSetIndex].actualReps = reps;
                
                // Check if we need to start rest timer
                const isLastSet = activeTemplate.currentSetIndex === currentExercise.sets.length - 1;
                
                if (!isLastSet) {
                    // Start rest timer for next set
                    startRestTimer(activeTemplate, currentSet.restTime);
                } else {
                    // Mark exercise as completed
                    activeTemplate.exercises[activeTemplate.currentExerciseIndex].completed = true;
                    
                    // Calculate progress
                    const completedExercises = activeTemplate.exercises.filter(ex => ex.completed).length;
                    const totalExercises = activeTemplate.exercises.length;
                    const progress = Math.round((completedExercises / totalExercises) * 100);
                    
                    document.getElementById('completed-exercises').textContent = completedExercises;
                    document.getElementById('template-progress-fill').style.width = `${progress}%`;
                    
                    // Check if it's the last exercise
                    const isLastExercise = activeTemplate.currentExerciseIndex === activeTemplate.exercises.length - 1;
                    
                    if (!isLastExercise) {
                        // Move to next exercise
                        activeTemplate.currentExerciseIndex++;
                        activeTemplate.currentSetIndex = 0;
                        
                        // Show next exercise
                        renderActiveExercise(activeTemplate);
                    } else {
                        // Workout completed!
                        alert('Workout completed! 💪');
                        finishTemplateWorkout(activeTemplate);
                    }
                }
            });
        }
        
        // Start rest timer
        function startRestTimer(activeTemplate, restTime) {
            // Show rest timer container
            const restTimerContainer = document.getElementById('rest-timer-container');
            restTimerContainer.style.display = 'block';
            
            // Hide active exercise container
            document.getElementById('active-exercise-container').style.display = 'none';
            
            let secondsRemaining = restTime;
            updateRestTimerDisplay(secondsRemaining);
            
            // Start countdown
            const timerId = setInterval(() => {
                secondsRemaining--;
                updateRestTimerDisplay(secondsRemaining);
                
                if (secondsRemaining <= 0) {
                    clearInterval(timerId);
                    
                    // Move to next set
                    activeTemplate.currentSetIndex++;
                    
                    // Hide rest timer container
                    restTimerContainer.style.display = 'none';
                    
                    // Show active exercise container
                    document.getElementById('active-exercise-container').style.display = 'block';
                    
                    // Show next set
                    renderActiveExercise(activeTemplate);
                }
            }, 1000);
            
            // Set up skip rest button
            document.getElementById('skip-rest').onclick = function() {
                clearInterval(timerId);
                
                // Move to next set
                activeTemplate.currentSetIndex++;
                
                // Hide rest timer container
                restTimerContainer.style.display = 'none';
                
                // Show active exercise container
                document.getElementById('active-exercise-container').style.display = 'block';
                
                // Show next set
                renderActiveExercise(activeTemplate);
            };
        }
        
        // Update rest timer display
        function updateRestTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            document.getElementById('rest-timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // Global variable to store the current active template
        let currentActiveTemplate = null;
        
        // Finish template workout
        function finishTemplateWorkout(activeTemplate) {
            // Handle case where activeTemplate is not passed
            if (!activeTemplate && currentActiveTemplate) {
                activeTemplate = currentActiveTemplate;
            }
            
            if (!activeTemplate) {
                console.error("No active template available to finish");
                alert("Error: Could not finish workout. Please try again.");
                return;
            }
            
            // Save history
            saveTemplateHistory(activeTemplate);
            
            // Create workout object
            const workout = {
                id: Date.now(),
                type: 'strength', // Default to strength for template workouts
                name: `Template: ${activeTemplate.name}`,
                duration: Math.round((new Date() - new Date(activeTemplate.startTime)) / 60000), // Convert ms to minutes
                intensity: 'high', // Default to high for template workouts
                date: new Date().toISOString().split('T')[0],
                notes: generateWorkoutNotes(activeTemplate),
                timestamp: new Date().toISOString(),
                templateId: activeTemplate.id
            };
            
            // Add to workouts array
            workouts.push(workout);
            
            // Save to localStorage
            localStorage.setItem('workouts', JSON.stringify(workouts));
            
            // Update UI
            renderWorkouts();
            updateSummary();
            updateGoalProgress();
            renderCharts();
            
            // Reset the current active template
            currentActiveTemplate = null;
            
            // Close active template modal
            document.getElementById('active-template-modal').style.display = 'none';
            
            // Show confirmation
            alert('Workout saved successfully!');
        }
        
        // Get previous performance data
        function getPreviousPerformance(templateId, exerciseName) {
            if (!templateHistory[templateId]) {
                return null;
            }
            
            // Find the most recent workout that contains this exercise
            const workouts = templateHistory[templateId];
            const sortedWorkouts = workouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            for (const workout of sortedWorkouts) {
                const exercise = workout.exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.sets.some(set => set.completed)) {
                    return exercise;
                }
            }
            
            return null;
        }
        
        // Save template history
        function saveTemplateHistory(activeTemplate) {
            const historyEntry = {
                templateId: activeTemplate.id,
                templateName: activeTemplate.name,
                date: new Date().toISOString(),
                exercises: activeTemplate.exercises
            };
            
            // Initialize history for this template if it doesn't exist
            if (!templateHistory[activeTemplate.id]) {
                templateHistory[activeTemplate.id] = [];
            }
            
            // Add history entry
            templateHistory[activeTemplate.id].push(historyEntry);
            
            // Limit history to last 10 entries per template
            if (templateHistory[activeTemplate.id].length > 10) {
                templateHistory[activeTemplate.id] = templateHistory[activeTemplate.id].slice(-10);
            }
            
            // Save to localStorage
            safeSaveItem('template-history', templateHistory);
        }
        
        // Generate workout notes from template
        function generateWorkoutNotes(activeTemplate) {
            let notes = `Completed template: ${activeTemplate.name}\n\n`;
            
            activeTemplate.exercises.forEach((exercise, exIndex) => {
                notes += `${exIndex + 1}. ${exercise.name}\n`;
                
                exercise.sets.forEach((set, setIndex) => {
                    if (set.completed) {
                        notes += `   Set ${setIndex + 1}: ${set.weight} lbs × ${set.actualReps} reps\n`;
                    }
                });
                
                notes += '\n';
            });
            
            return notes;
        }
        
        // Event listeners for new features
        
        // 1. Workout Comparison Feature
        document.getElementById('open-comparison').addEventListener('click', function() {
            document.getElementById('comparison-modal').style.display = 'flex';
            
            // Set default dates
            const today = new Date();
            const lastWeekStart = new Date(today);
            lastWeekStart.setDate(today.getDate() - 7);
            
            const prevWeekEnd = new Date(lastWeekStart);
            prevWeekEnd.setDate(prevWeekEnd.getDate() - 1);
            
            const prevWeekStart = new Date(prevWeekEnd);
            prevWeekStart.setDate(prevWeekEnd.getDate() - 6);
            
            // Set dates for custom date inputs
            document.getElementById('period-1-start').valueAsDate = lastWeekStart;
            document.getElementById('period-1-end').valueAsDate = today;
            document.getElementById('period-2-start').valueAsDate = prevWeekStart;
            document.getElementById('period-2-end').valueAsDate = prevWeekEnd;
        });
        
        // Show/hide custom date inputs based on dropdown selection
        document.getElementById('comparison-period-1').addEventListener('change', function() {
            document.getElementById('custom-dates-1').style.display = 
                this.value === 'custom' ? 'block' : 'none';
        });
        
        document.getElementById('comparison-period-2').addEventListener('change', function() {
            document.getElementById('custom-dates-2').style.display = 
                this.value === 'custom' ? 'block' : 'none';
        });
        
        // Generate comparison
        document.getElementById('generate-comparison').addEventListener('click', function() {
            generateWorkoutComparison();
        });
        
        // Function to generate workout comparison between two periods
        function generateWorkoutComparison() {
            // Get date ranges based on selections
            const period1Type = document.getElementById('comparison-period-1').value;
            const period2Type = document.getElementById('comparison-period-2').value;
            
            let period1Start, period1End, period2Start, period2End;
            const today = new Date();
            
            // Set period 1 dates
            if (period1Type === 'custom') {
                period1Start = document.getElementById('period-1-start').valueAsDate;
                period1End = document.getElementById('period-1-end').valueAsDate;
            } else {
                period1End = new Date(today);
                if (period1Type === 'last7') {
                    period1Start = new Date(today);
                    period1Start.setDate(today.getDate() - 7);
                } else if (period1Type === 'last30') {
                    period1Start = new Date(today);
                    period1Start.setDate(today.getDate() - 30);
                } else if (period1Type === 'last90') {
                    period1Start = new Date(today);
                    period1Start.setDate(today.getDate() - 90);
                }
            }
            
            // Set period 2 dates
            if (period2Type === 'custom') {
                period2Start = document.getElementById('period-2-start').valueAsDate;
                period2End = document.getElementById('period-2-end').valueAsDate;
            } else {
                if (period2Type === 'previous7') {
                    period2End = new Date(period1Start);
                    period2End.setDate(period2End.getDate() - 1);
                    period2Start = new Date(period2End);
                    period2Start.setDate(period2Start.getDate() - 6);
                } else if (period2Type === 'previous30') {
                    period2End = new Date(period1Start);
                    period2End.setDate(period2End.getDate() - 1);
                    period2Start = new Date(period2End);
                    period2Start.setDate(period2Start.getDate() - 29);
                } else if (period2Type === 'previous90') {
                    period2End = new Date(period1Start);
                    period2End.setDate(period2End.getDate() - 1);
                    period2Start = new Date(period2End);
                    period2Start.setDate(period2Start.getDate() - 89);
                }
            }
            
            // Filter workouts for each period
            const period1Workouts = workouts.filter(workout => {
                const workoutDate = new Date(workout.date);
                return workoutDate >= period1Start && workoutDate <= period1End;
            });
            
            const period2Workouts = workouts.filter(workout => {
                const workoutDate = new Date(workout.date);
                return workoutDate >= period2Start && workoutDate <= period2End;
            });
            
            // Calculate metrics
            const period1Count = period1Workouts.length;
            const period2Count = period2Workouts.length;
            
            const period1Duration = period1Workouts.reduce((total, w) => total + w.duration, 0);
            const period2Duration = period2Workouts.reduce((total, w) => total + w.duration, 0);
            
            const period1IntensityScore = period1Workouts.reduce((total, w) => {
                return total + (w.intensity === 'high' ? 3 : w.intensity === 'medium' ? 2 : 1);
            }, 0) / (period1Count || 1);
            
            const period2IntensityScore = period2Workouts.reduce((total, w) => {
                return total + (w.intensity === 'high' ? 3 : w.intensity === 'medium' ? 2 : 1);
            }, 0) / (period2Count || 1);
            
            // Calculate percent changes
            const countChange = period2Count === 0 ? 100 : ((period1Count - period2Count) / period2Count) * 100;
            const durationChange = period2Duration === 0 ? 100 : ((period1Duration - period2Duration) / period2Duration) * 100;
            const intensityChange = period2IntensityScore === 0 ? 100 : ((period1IntensityScore - period2IntensityScore) / period2IntensityScore) * 100;
            
            // Update UI
            document.querySelector('.period-1-value:nth-of-type(1)').textContent = period1Count;
            document.querySelector('.period-2-value:nth-of-type(1)').textContent = period2Count;
            
            document.querySelector('.period-1-value:nth-of-type(2)').textContent = period1Duration + ' min';
            document.querySelector('.period-2-value:nth-of-type(2)').textContent = period2Duration + ' min';
            
            document.querySelector('.period-1-value:nth-of-type(3)').textContent = period1IntensityScore.toFixed(1);
            document.querySelector('.period-2-value:nth-of-type(3)').textContent = period2IntensityScore.toFixed(1);
            
            // Update change indicators
            const changeElements = document.querySelectorAll('.comparison-change');
            
            updateChangeElement(changeElements[0], countChange);
            updateChangeElement(changeElements[1], durationChange);
            updateChangeElement(changeElements[2], intensityChange);
            
            // Generate insights
            const insightsList = document.getElementById('comparison-insights-list');
            insightsList.innerHTML = '';
            
            // Add date range info
            const formatDateRange = (start, end) => {
                return `${start.toLocaleDateString()} to ${end.toLocaleDateString()}`;
            };
            
            const addInsight = (text) => {
                const li = document.createElement('li');
                li.textContent = text;
                insightsList.appendChild(li);
            };
            
            addInsight(`Comparing: ${formatDateRange(period1Start, period1End)} vs ${formatDateRange(period2Start, period2End)}`);
            
            // Add insights based on changes
            if (Math.abs(countChange) > 10) {
                addInsight(`Workout frequency ${countChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(countChange).toFixed(0)}%`);
            }
            
            if (Math.abs(durationChange) > 10) {
                addInsight(`Total workout time ${durationChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(durationChange).toFixed(0)}%`);
            }
            
            if (Math.abs(intensityChange) > 10) {
                addInsight(`Workout intensity ${intensityChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(intensityChange).toFixed(0)}%`);
            }
            
            // Add type breakdown comparison
            const period1Types = countWorkoutTypes(period1Workouts);
            const period2Types = countWorkoutTypes(period2Workouts);
            
            Object.keys(period1Types).forEach(type => {
                const p1Count = period1Types[type];
                const p2Count = period2Types[type] || 0;
                if (p1Count > 0 || p2Count > 0) {
                    const typeChange = p2Count === 0 ? 100 : ((p1Count - p2Count) / p2Count) * 100;
                    if (Math.abs(typeChange) > 20) {
                        addInsight(`${capitalize(type)} workouts ${typeChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(typeChange).toFixed(0)}%`);
                    }
                }
            });
        }
        
        // Helper for workout comparison
        function updateChangeElement(element, change) {
            element.textContent = (change > 0 ? '+' : '') + change.toFixed(0) + '%';
            element.className = 'comparison-change ' + 
                (change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral');
        }
        
        // Helper to count workout types
        function countWorkoutTypes(workouts) {
            return workouts.reduce((counts, workout) => {
                counts[workout.type] = (counts[workout.type] || 0) + 1;
                return counts;
            }, {});
        }
        
        function capitalize(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        // 2. Nutrition Tracker Feature
        document.getElementById('open-nutrition').addEventListener('click', function() {
            document.getElementById('nutrition-modal').style.display = 'flex';
            
            // Set today's date
            const today = new Date();
            document.getElementById('nutrition-date').valueAsDate = today;
            
            // Initialize nutrition data for today if needed
            const dateStr = today.toISOString().split('T')[0];
            if (!nutritionData[dateStr]) {
                nutritionData[dateStr] = {
                    breakfast: [],
                    lunch: [],
                    dinner: [],
                    snacks: []
                };
            }
            
            // Render nutrition data
            renderNutritionData(today);
        });
        
        // Nutrition date navigation
        document.getElementById('prev-day').addEventListener('click', function() {
            const date = document.getElementById('nutrition-date').valueAsDate;
            date.setDate(date.getDate() - 1);
            document.getElementById('nutrition-date').valueAsDate = date;
            renderNutritionData(date);
        });
        
        document.getElementById('next-day').addEventListener('click', function() {
            const date = document.getElementById('nutrition-date').valueAsDate;
            date.setDate(date.getDate() + 1);
            document.getElementById('nutrition-date').valueAsDate = date;
            renderNutritionData(date);
        });
        
        document.getElementById('nutrition-date').addEventListener('change', function() {
            renderNutritionData(this.valueAsDate);
        });
        
        // Add food buttons
        document.querySelectorAll('.add-food-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.getElementById('food-meal-type').value = this.dataset.meal;
                document.getElementById('add-food-modal').style.display = 'flex';
            });
        });
        
        // Close nested modal
        document.querySelector('.close-nested-modal').addEventListener('click', function() {
            document.getElementById('add-food-modal').style.display = 'none';
        });
        
        // Add food form submission
        document.getElementById('add-food-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const mealType = document.getElementById('food-meal-type').value;
            const foodName = document.getElementById('food-name').value;
            const foodServing = document.getElementById('food-serving').value;
            const calories = parseFloat(document.getElementById('food-calories').value);
            const protein = parseFloat(document.getElementById('food-protein').value);
            const carbs = parseFloat(document.getElementById('food-carbs').value);
            const fat = parseFloat(document.getElementById('food-fat').value);
            
            const date = document.getElementById('nutrition-date').valueAsDate;
            const dateStr = date.toISOString().split('T')[0];
            
            // Initialize date data if needed
            if (!nutritionData[dateStr]) {
                nutritionData[dateStr] = {
                    breakfast: [],
                    lunch: [],
                    dinner: [],
                    snacks: []
                };
            }
            
            // Add food item
            nutritionData[dateStr][mealType].push({
                name: foodName,
                serving: foodServing,
                calories: calories,
                protein: protein,
                carbs: carbs,
                fat: fat
            });
            
            // Save to localStorage
            localStorage.setItem('nutrition-data', JSON.stringify(nutritionData));
            
            // Render updated data
            renderNutritionData(date);
            
            // Close modal and reset form
            document.getElementById('add-food-modal').style.display = 'none';
            this.reset();
        });
        
        // Function to render nutrition data
        function renderNutritionData(date) {
            const dateStr = date.toISOString().split('T')[0];
            
            // Initialize date data if needed
            if (!nutritionData[dateStr]) {
                nutritionData[dateStr] = {
                    breakfast: [],
                    lunch: [],
                    dinner: [],
                    snacks: []
                };
            }
            
            // Calculate totals
            let totalCalories = 0;
            let totalProtein = 0;
            let totalCarbs = 0;
            let totalFat = 0;
            
            const dayData = nutritionData[dateStr];
            
            ['breakfast', 'lunch', 'dinner', 'snacks'].forEach(meal => {
                if (dayData[meal]) {
                    dayData[meal].forEach(item => {
                        totalCalories += item.calories;
                        totalProtein += item.protein;
                        totalCarbs += item.carbs;
                        totalFat += item.fat;
                    });
                }
            });
            
            // Update summary
            document.getElementById('total-calories').textContent = Math.round(totalCalories);
            document.getElementById('total-protein').textContent = Math.round(totalProtein) + 'g';
            document.getElementById('total-carbs').textContent = Math.round(totalCarbs) + 'g';
            document.getElementById('total-fat').textContent = Math.round(totalFat) + 'g';
            
            // Render meal sections
            renderMealItems('breakfast', dayData.breakfast);
            renderMealItems('lunch', dayData.lunch);
            renderMealItems('dinner', dayData.dinner);
            renderMealItems('snacks', dayData.snacks);
        }
        
        // Helper function to render meal items
        function renderMealItems(mealType, items) {
            const container = document.getElementById(`${mealType}-items`);
            container.innerHTML = '';
            
            if (!items || items.length === 0) {
                container.innerHTML = '<div class="empty-meal">No items added</div>';
                return;
            }
            
            items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'food-item';
                itemElement.innerHTML = `
                    <div class="food-item-info">
                        <div class="food-item-name">${item.name}</div>
                        <div class="food-item-serving">${item.serving}</div>
                    </div>
                    <div class="food-item-macros">
                        <div class="food-item-calories">${Math.round(item.calories)} cal</div>
                        <div>P: ${Math.round(item.protein)}g</div>
                        <div>C: ${Math.round(item.carbs)}g</div>
                        <div>F: ${Math.round(item.fat)}g</div>
                    </div>
                    <div class="food-item-actions">
                        <button class="food-item-remove" data-meal="${mealType}" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                container.appendChild(itemElement);
            });
            
            // Add event listeners for remove buttons
            container.querySelectorAll('.food-item-remove').forEach(button => {
                button.addEventListener('click', function() {
                    const meal = this.dataset.meal;
                    const index = parseInt(this.dataset.index);
                    const date = document.getElementById('nutrition-date').valueAsDate;
                    const dateStr = date.toISOString().split('T')[0];
                    
                    // Remove item
                    nutritionData[dateStr][meal].splice(index, 1);
                    localStorage.setItem('nutrition-data', JSON.stringify(nutritionData));
                    
                    // Re-render
                    renderNutritionData(date);
                });
            });
        }
        
        // 3. Social Sharing Feature
        document.querySelectorAll('.share-workout-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const workoutId = parseInt(this.dataset.id);
                const workout = workouts.find(w => w.id === workoutId);
                
                if (workout) {
                    showShareModal(workout);
                }
            });
        });
        
        function showShareModal(workout) {
            // Format date
            const workoutDate = new Date(workout.date);
            const formattedDate = workoutDate.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            });
            
            // Populate share modal
            document.getElementById('share-title').textContent = workout.name;
            document.getElementById('share-date').textContent = formattedDate;
            document.getElementById('share-type').textContent = workout.type;
            document.getElementById('share-duration').innerHTML = `<i class="far fa-clock"></i> ${workout.duration} mins`;
            document.getElementById('share-intensity').innerHTML = `<i class="fas fa-thermometer-${workout.intensity === 'low' ? 'quarter' : workout.intensity === 'medium' ? 'half' : 'full'}"></i> ${workout.intensity}`;
            document.getElementById('share-notes').textContent = workout.notes || 'No notes for this workout.';
            
            // Generate share text
            const shareText = `I just completed a ${workout.duration} minute ${workout.type} workout (${workout.name}) on ${formattedDate}! 💪\n\n#fitness #workout #healthylifestyle`;
            document.getElementById('share-content').value = shareText;
            
            // Show modal
            document.getElementById('share-modal').style.display = 'flex';
        }
        
        // Copy to clipboard function
        document.getElementById('copy-content').addEventListener('click', function() {
            const contentArea = document.getElementById('share-content');
            contentArea.select();
            document.execCommand('copy');
            alert('Content copied to clipboard!');
        });
        
        // Platform sharing
        
        /**
         * Enhanced template selector modal
         * Creates an improved UI for selecting and managing workout templates
         * Adds search, sorting, and better visual presentation of templates
         */
        function enhanceTemplateUI() {
            // Create enhanced template selector modal if it doesn't exist
            let templateSelectorModal = document.getElementById('template-selector-modal');
            
            if (templateSelectorModal) {
                // Update the existing modal content with enhanced UI
                templateSelectorModal.innerHTML = `
                    <div class="modal-content template-selector-content">
                        <span class="close-modal" id="close-template-selector-modal">&times;</span>
                        <h2><i class="fas fa-clipboard-list"></i> Workout Templates</h2>
                        <p class="template-description">Choose a template to start your workout or create a new template.</p>
                        
                        <div class="template-search">
                            <div class="search-input-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="template-search" placeholder="Search templates...">
                            </div>
                            <div class="template-filters">
                                <select id="template-sort">
                                    <option value="recent">Recently Used</option>
                                    <option value="name-asc">Name (A-Z)</option>
                                    <option value="name-desc">Name (Z-A)</option>
                                    <option value="created">Date Created</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="template-list-container">
                            <div id="template-list" class="template-grid">
                                <!-- Templates will be rendered here -->
                            </div>
                        </div>
                        
                        <div class="template-selector-actions">
                            <button type="button" id="create-new-template" class="primary-action-button">
                                <i class="fas fa-plus-circle"></i> Create New Template
                            </button>
                            <button type="button" id="close-template-selector" class="secondary-action-button">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                `;
                
                // Set up event listeners
                document.getElementById('close-template-selector-modal').addEventListener('click', function() {
                    templateSelectorModal.style.display = 'none';
                });
                
                document.getElementById('close-template-selector').addEventListener('click', function() {
                    templateSelectorModal.style.display = 'none';
                });
                
                document.getElementById('create-new-template').addEventListener('click', function() {
                    templateSelectorModal.style.display = 'none';
                    document.getElementById('template-creator-modal').style.display = 'flex';
                });
                
                // Set up search functionality
                document.getElementById('template-search').addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    const templateCards = document.querySelectorAll('.template-card');
                    
                    templateCards.forEach(card => {
                        const templateName = card.querySelector('h3').textContent.toLowerCase();
                        if (templateName.includes(searchTerm)) {
                            card.style.display = 'flex';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
                
                // Set up sorting functionality
                document.getElementById('template-sort').addEventListener('change', function() {
                    renderTemplateList(this.value);
                });
            }
        }
        
        // Call the function when the page loads
        enhanceTemplateUI();
        
        /**
         * Template-focused UI enhancements
         * Handles the quick workout form visibility and form submission
         */
        
        // Show quick workout form when button is clicked
        document.getElementById('start-quick-workout').addEventListener('click', function() {
            document.getElementById('quick-workout-form').style.display = 'block';
        });
        
        // Hide quick workout form when cancel button is clicked
        document.getElementById('cancel-quick-workout').addEventListener('click', function() {
            document.getElementById('quick-workout-form').style.display = 'none';
        });
        
        // Handle quick workout form submission
        // This fixes the issue where the Start Workout button didn't do anything
        document.getElementById('start-quick-workout').addEventListener('click', function() {
            // Show the form
            document.getElementById('quick-workout-form').style.display = 'block';
            
            // Set today's date as default
            document.getElementById('workout-date').valueAsDate = new Date();
            
            // Focus on the first input field
            document.getElementById('workout-type').focus();
        });
        
        /**
         * Template search functionality
         * Filters template cards based on user search input
         */
        const templateSearchInput = document.getElementById('template-search');
        if (templateSearchInput) {
            templateSearchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                const templateCards = document.querySelectorAll('.template-card');
                
                templateCards.forEach(card => {
                    const templateName = card.querySelector('h3').textContent.toLowerCase();
                    if (templateName.includes(searchTerm)) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }
        
        /**
         * Template sorting functionality
         * Allows users to sort templates by different criteria (recent, name, creation date)
         */
        const templateSortSelect = document.getElementById('template-sort');
        if (templateSortSelect) {
            templateSortSelect.addEventListener('change', function() {
                const sortBy = this.value;
                renderTemplateList(sortBy);
            });
        }
        
        /**
         * Enhanced template list rendering function
         * Renders the template cards with sorting and improved UI
         * @param {string} sortBy - Sorting criteria (recent, name-asc, name-desc, created)
         */
        function renderTemplateList(sortBy = 'recent') {
            const templateList = document.getElementById('template-list');
            
            if (!templateList) return;
            
            if (templates.length === 0) {
                templateList.innerHTML = `
                    <div class="empty-templates">
                        <i class="fas fa-clipboard-list empty-icon"></i>
                        <p>No templates created yet</p>
                        <button id="create-first-template" class="primary-button">Create Your First Template</button>
                    </div>
                `;
                
                // Add event listener to the new button
                document.getElementById('create-first-template').addEventListener('click', function() {
                    document.getElementById('template-creator-modal').style.display = 'flex';
                });
                
                return;
            }
            
            // Sort templates based on selected option
            let sortedTemplates = [...templates];
            
            switch(sortBy) {
                case 'recent':
                    sortedTemplates.sort((a, b) => {
                        // If lastUsed is null, put at the end
                        if (!a.lastUsed) return 1;
                        if (!b.lastUsed) return -1;
                        return new Date(b.lastUsed) - new Date(a.lastUsed);
                    });
                    break;
                case 'name-asc':
                    sortedTemplates.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    sortedTemplates.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'created':
                    sortedTemplates.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
            }
            
            templateList.innerHTML = '';
            
            sortedTemplates.forEach(template => {
                const templateCard = document.createElement('div');
                templateCard.className = 'template-card';
                templateCard.dataset.id = template.id;
                
                const lastUsedText = template.lastUsed 
                    ? `Last used: ${new Date(template.lastUsed).toLocaleDateString()}`
                    : 'Never used';
                
                const exerciseCount = template.exercises.length;
                const totalSets = template.exercises.reduce((sum, exercise) => sum + exercise.sets.length, 0);
                
                templateCard.innerHTML = `
                    <div class="template-card-header">
                        <h3>${template.name}</h3>
                        <div class="template-card-actions">
                            <button type="button" class="edit-template" data-id="${template.id}" title="Edit Template">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="delete-template" data-id="${template.id}" title="Delete Template">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="template-card-info">
                        <div class="template-date">${lastUsedText}</div>
                        <div class="template-stats">
                            <span title="Exercises"><i class="fas fa-dumbbell"></i> ${exerciseCount}</span>
                            <span title="Total Sets"><i class="fas fa-layers"></i> ${totalSets}</span>
                        </div>
                    </div>
                    <button class="start-template-workout" data-id="${template.id}">
                        <i class="fas fa-play"></i> Start Workout
                    </button>
                `;
                
                // Make the start button clickable to start the workout
                templateCard.querySelector('.start-template-workout').addEventListener('click', function(e) {
                    e.stopPropagation();
                    startTemplateWorkout(template.id);
                });
                
                // Add event listeners for edit and delete buttons
                templateCard.querySelector('.edit-template').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.dataset.id);
                    editTemplate(id);
                });
                
                templateCard.querySelector('.delete-template').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = parseInt(this.dataset.id);
                    if (confirm('Are you sure you want to delete this template?')) {
                        templates = templates.filter(template => template.id !== id);
                        localStorage.setItem('workout-templates', JSON.stringify(templates));
                        renderTemplateList(sortBy);
                    }
                });
                
                templateList.appendChild(templateCard);
            });
        }
        document.querySelectorAll('.platform-btn').forEach(button => {
            button.addEventListener('click', function() {
                const platform = this.dataset.platform;
                const text = encodeURIComponent(document.getElementById('share-content').value);
                const title = encodeURIComponent(document.getElementById('share-title').textContent);
                
                let url;
                switch(platform) {
                    case 'twitter':
                        url = `https://twitter.com/intent/tweet?text=${text}`;
                        break;
                    case 'facebook':
                        url = `https://www.facebook.com/sharer/sharer.php?u=https://example.com&quote=${text}`;
                        break;
                    case 'whatsapp':
                        url = `https://wa.me/?text=${text}`;
                        break;
                    case 'email':
                        url = `mailto:?subject=My Workout: ${title}&body=${text}`;
                        break;
                    case 'instagram':
                        alert('Instagram does not support direct sharing via links. Please take a screenshot and share manually.');
                        return;
                }
                
                if (url) window.open(url, '_blank');
            });
        });
        
        // Share options
        document.getElementById('share-text').addEventListener('click', function() {
            document.getElementById('share-content').select();
            document.execCommand('copy');
            alert('Text copied to clipboard! You can now paste it anywhere.');
        });
        
        document.getElementById('share-link').addEventListener('click', function() {
            // In a real app, this would generate a unique link to the workout
            alert('In a production app, this would generate a unique, shareable link to this workout.');
        });
        
        document.getElementById('share-image').addEventListener('click', function() {
            // In a real app, this would generate an image of the workout card
            alert('In a production app, this would generate a shareable image of your workout.');
        });
        
        // Tabs functionality
        document.addEventListener('DOMContentLoaded', function() {
            setupTabNavigation();
            setupImportExport();
        });
        
        function setupTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-button');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all tab buttons
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to the clicked button
                    this.classList.add('active');
                    
                    // Get the tab ID to show
                    const tabId = this.getAttribute('data-tab');
                    
                    // Hide all tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show the selected tab content
                    document.getElementById(tabId + '-tab').classList.add('active');
                });
            });
            
            // Update mobile nav buttons to work with tabs
            const mobileNavButtons = document.querySelectorAll('.mobile-nav-tab');
            mobileNavButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all tab buttons
                    mobileNavButtons.forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to the clicked button
                    this.classList.add('active');
                    
                    // Get the tab to show based on data-tab or index
                    let tabToShow = this.getAttribute('data-tab');
                    if (!tabToShow) {
                        // Determine by index
                        const index = Array.from(mobileNavButtons).indexOf(this);
                        const tabMapping = ['workouts', 'exercise-library', 'goals', 'timer', 'stats', 'settings'];
                        tabToShow = tabMapping[Math.min(index, tabMapping.length - 1)];
                    }
                    
                    // Find and click the corresponding desktop tab button
                    const desktopTabButton = document.querySelector(`.tab-button[data-tab="${tabToShow}"]`);
                    if (desktopTabButton) {
                        desktopTabButton.click();
                    }
                });
            });
            
            // Link existing action buttons to tabs
            linkActionButtonsToTabs();
        }
        
        function linkActionButtonsToTabs() {
            // Map action buttons to tab IDs
            const buttonToTabMap = {
                'open-timer': 'timer',
                'open-goals': 'goals',
                'open-stats': 'stats',
                'open-exercise-library': 'exercise-library'
            };
            
            // Add click handlers to each button
            for (const buttonId in buttonToTabMap) {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Find and click the corresponding tab button
                        const tabButton = document.querySelector(`.tab-button[data-tab="${buttonToTabMap[buttonId]}"]`);
                        if (tabButton) {
                            tabButton.click();
                        }
                    });
                }
            }
        }
        
        // PR tracking and records functionality
        // Re-use the existing personalRecords variable that was declared earlier
        
        // Function to check for new PRs when a workout is logged
        function checkForPersonalRecords(workout) {
            if (workout.exercises) {
                workout.exercises.forEach(exercise => {
                    // Handle strength PRs
                    if (exercise.sets && exercise.sets.length > 0) {
                        // Find maximum weight for this exercise
                        let maxWeight = 0;
                        let maxReps = 0;
                        
                        exercise.sets.forEach(set => {
                            if (set.weight > maxWeight) {
                                maxWeight = set.weight;
                            }
                            if (set.reps > maxReps) {
                                maxReps = set.reps;
                            }
                        });
                        
                        // Check if this is a PR for weight
                        const existingWeightPR = personalRecords.find(
                            pr => pr.exerciseName === exercise.name && pr.metric === 'weight'
                        );
                        
                        if (!existingWeightPR || maxWeight > existingWeightPR.value) {
                            // This is a new PR!
                            if (existingWeightPR) {
                                existingWeightPR.value = maxWeight;
                                existingWeightPR.date = workout.date;
                            } else {
                                personalRecords.push({
                                    id: Date.now(),
                                    exerciseName: exercise.name,
                                    metric: 'weight',
                                    value: maxWeight,
                                    unit: 'lbs',
                                    date: workout.date,
                                    type: 'strength'
                                });
                            }
                        }
                        
                        // Check if this is a PR for reps
                        const existingRepsPR = personalRecords.find(
                            pr => pr.exerciseName === exercise.name && pr.metric === 'reps'
                        );
                        
                        if (!existingRepsPR || maxReps > existingRepsPR.value) {
                            // This is a new PR!
                            if (existingRepsPR) {
                                existingRepsPR.value = maxReps;
                                existingRepsPR.date = workout.date;
                            } else {
                                personalRecords.push({
                                    id: Date.now() + 1,
                                    exerciseName: exercise.name,
                                    metric: 'reps',
                                    value: maxReps,
                                    unit: 'reps',
                                    date: workout.date,
                                    type: 'strength'
                                });
                            }
                        }
                    }
                    
                    // Handle cardio PRs (distance/time)
                    if (exercise.type === 'cardio') {
                        if (exercise.distance) {
                            const existingDistancePR = personalRecords.find(
                                pr => pr.exerciseName === exercise.name && pr.metric === 'distance'
                            );
                            
                            if (!existingDistancePR || exercise.distance > existingDistancePR.value) {
                                if (existingDistancePR) {
                                    existingDistancePR.value = exercise.distance;
                                    existingDistancePR.date = workout.date;
                                } else {
                                    personalRecords.push({
                                        id: Date.now() + 2,
                                        exerciseName: exercise.name,
                                        metric: 'distance',
                                        value: exercise.distance,
                                        unit: exercise.distanceUnit || 'miles',
                                        date: workout.date,
                                        type: 'cardio'
                                    });
                                }
                            }
                        }
                        
                        if (exercise.duration && exercise.distance) {
                            // Calculate pace (time per mile/km)
                            const pace = exercise.duration / exercise.distance;
                            const existingPacePR = personalRecords.find(
                                pr => pr.exerciseName === exercise.name && pr.metric === 'pace'
                            );
                            
                            if (!existingPacePR || pace < existingPacePR.value) {
                                if (existingPacePR) {
                                    existingPacePR.value = pace;
                                    existingPacePR.date = workout.date;
                                } else {
                                    personalRecords.push({
                                        id: Date.now() + 3,
                                        exerciseName: exercise.name,
                                        metric: 'pace',
                                        value: pace,
                                        unit: 'min/' + (exercise.distanceUnit || 'mile'),
                                        date: workout.date,
                                        type: 'cardio'
                                    });
                                }
                            }
                        }
                    }
                });
                
                // Save the updated records
                localStorage.setItem('personal-records', JSON.stringify(personalRecords));
                renderRecordsTab();
            }
        }
        
        // Function to render the records tab
        function renderRecordsTab() {
            const recordsList = document.getElementById('records-list');
            const totalRecordsElement = document.getElementById('total-records');
            const recentPRElement = document.getElementById('recent-pr');
            const strengthPRsElement = document.getElementById('strength-prs');
            const cardioPRsElement = document.getElementById('cardio-prs');
            
            if (!recordsList) return;
            
            // Update summary stats
            totalRecordsElement.textContent = personalRecords.length;
            
            // Count recent PRs (last 30 days)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentPRs = personalRecords.filter(pr => new Date(pr.date) >= thirtyDaysAgo);
            recentPRElement.textContent = recentPRs.length;
            
            // Count strength and cardio PRs
            const strengthPRs = personalRecords.filter(pr => pr.type === 'strength');
            const cardioPRs = personalRecords.filter(pr => pr.type === 'cardio');
            strengthPRsElement.textContent = strengthPRs.length;
            cardioPRsElement.textContent = cardioPRs.length;
            
            // Get filter values
            const typeFilter = document.getElementById('record-type-filter').value;
            const sortBy = document.getElementById('record-sort').value;
            
            // Filter records
            let filteredRecords = [...personalRecords];
            if (typeFilter !== 'all') {
                filteredRecords = filteredRecords.filter(record => record.type === typeFilter);
            }
            
            // Sort records
            switch(sortBy) {
                case 'recent':
                    filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'name':
                    filteredRecords.sort((a, b) => a.exerciseName.localeCompare(b.exerciseName));
                    break;
                case 'value':
                    filteredRecords.sort((a, b) => b.value - a.value);
                    break;
            }
            
            // Clear list
            recordsList.innerHTML = '';
            
            if (filteredRecords.length === 0) {
                recordsList.innerHTML = '<div class="empty-state">No personal records yet. Complete workouts to set records!</div>';
                return;
            }
            
            // Render records
            filteredRecords.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                // Format date
                const recordDate = new Date(record.date);
                const formattedDate = recordDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric' 
                });
                
                // Format value based on metric
                let formattedValue = record.value;
                if (record.metric === 'pace') {
                    const minutes = Math.floor(record.value);
                    const seconds = Math.round((record.value - minutes) * 60);
                    formattedValue = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
                
                recordItem.innerHTML = `
                    <div class="record-exercise">${record.exerciseName}</div>
                    <div class="record-details">
                        <div class="record-metric"><span class="tag ${record.type}">${record.metric}</span></div>
                        <div class="record-value">${formattedValue} ${record.unit}</div>
                        <div class="record-date">${formattedDate}</div>
                    </div>
                `;
                
                recordsList.appendChild(recordItem);
            });
            
            // Render PR chart
            renderPRChart();
        }
        
        // Function to render the PR chart
        function renderPRChart() {
            const chartContainer = document.getElementById('pr-chart-container');
            if (!chartContainer || personalRecords.length === 0) return;
            
            const canvas = document.getElementById('pr-chart');
            const ctx = canvas.getContext('2d');
            
            // Calculate canvas dimensions
            const canvasWidth = canvas.clientWidth;
            const canvasHeight = canvas.clientHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // Chart configurations
            const chartPadding = 40;
            const barPadding = 5;
            
            // Group records by exercise name and find top exercises
            const exerciseGroups = {};
            personalRecords.forEach(record => {
                if (!exerciseGroups[record.exerciseName]) {
                    exerciseGroups[record.exerciseName] = [];
                }
                exerciseGroups[record.exerciseName].push(record);
            });
            
            // Sort exercises by number of records and take top 8
            const topExercises = Object.keys(exerciseGroups)
                .sort((a, b) => exerciseGroups[b].length - exerciseGroups[a].length)
                .slice(0, 8);
            
            // Chart data
            const chartData = topExercises.map(exercise => {
                // For each exercise, get the most recent PR of each metric
                const records = exerciseGroups[exercise];
                const metrics = {};
                
                records.forEach(record => {
                    if (!metrics[record.metric] || new Date(record.date) > new Date(metrics[record.metric].date)) {
                        metrics[record.metric] = record;
                    }
                });
                
                return {
                    name: exercise,
                    records: Object.values(metrics)
                };
            });
            
            // Calculate bar width based on number of exercises
            const barWidth = (canvasWidth - 2 * chartPadding - (topExercises.length + 1) * barPadding) / topExercises.length;
            
            // Find max value for scaling
            const maxValue = Math.max(...chartData.flatMap(ex => ex.records.map(r => {
                // For weight and reps, use the value directly
                if (r.metric === 'weight' || r.metric === 'reps' || r.metric === 'distance') {
                    return r.value;
                }
                // For pace, lower is better so invert the scale
                return 0; // Skip pace for the y-axis scale
            })), 1);
            
            // Draw chart background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // Draw axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath();
            ctx.moveTo(chartPadding, chartPadding);
            ctx.lineTo(chartPadding, canvasHeight - chartPadding);
            ctx.lineTo(canvasWidth - chartPadding, canvasHeight - chartPadding);
            ctx.stroke();
            
            // Draw y-axis labels
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            for (let i = 0; i <= 5; i++) {
                const value = Math.round(maxValue * (i / 5));
                const y = canvasHeight - chartPadding - ((canvasHeight - 2 * chartPadding) * (i / 5));
                
                ctx.fillText(value.toString(), chartPadding - 5, y);
                
                // Draw horizontal grid lines
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.beginPath();
                ctx.moveTo(chartPadding, y);
                ctx.lineTo(canvasWidth - chartPadding, y);
                ctx.stroke();
            }
            
            // Draw title
            ctx.textAlign = 'center';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Top Exercise Personal Records', canvasWidth / 2, 15);
            
            // Draw x-axis labels and bars
            const colors = {
                'weight': 'rgba(0, 153, 255, 0.7)', // Blue
                'reps': 'rgba(153, 51, 255, 0.7)',  // Purple
                'distance': 'rgba(255, 77, 77, 0.7)', // Red
                'pace': 'rgba(0, 204, 153, 0.7)'    // Green
            };
            
            chartData.forEach((exercise, index) => {
                const x = chartPadding + index * (barWidth + barPadding) + barPadding;
                
                // Draw exercise name (x-axis label)
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.save();
                ctx.translate(x + barWidth / 2, canvasHeight - chartPadding + 5);
                ctx.rotate(Math.PI / 4); // Rotate 45 degrees
                ctx.fillText(exercise.name.substring(0, 12) + (exercise.name.length > 12 ? '...' : ''), 0, 0);
                ctx.restore();
                
                // Draw bars for each metric
                exercise.records.forEach((record, metricIndex) => {
                    // Skip pace for visual clarity
                    if (record.metric === 'pace') return;
                    
                    const barHeight = (record.value / maxValue) * (canvasHeight - 2 * chartPadding);
                    
                    const metricX = x + (metricIndex * (barWidth / exercise.records.length));
                    const metricWidth = barWidth / exercise.records.length - 2;
                    
                    ctx.fillStyle = colors[record.metric];
                    ctx.fillRect(
                        metricX,
                        canvasHeight - chartPadding - barHeight,
                        metricWidth,
                        barHeight
                    );
                    
                    // If bar is tall enough, add value label
                    if (barHeight > 30) {
                        ctx.fillStyle = 'white';
                        ctx.font = '9px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(
                            record.value.toString(),
                            metricX + metricWidth / 2,
                            canvasHeight - chartPadding - barHeight + 15
                        );
                    }
                });
            });
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'chart-legend';
            legend.innerHTML = `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${colors.weight}"></div>
                    <span>Weight</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${colors.reps}"></div>
                    <span>Reps</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${colors.distance}"></div>
                    <span>Distance</span>
                </div>
            `;
            
            // Clear any existing legend
            const existingLegend = chartContainer.querySelector('.chart-legend');
            if (existingLegend) {
                existingLegend.remove();
            }
            
            chartContainer.appendChild(legend);
        }
        
        // Add event listener for the Records button
        document.getElementById('open-records').addEventListener('click', function() {
            document.querySelector('.tab-button[data-tab="records"]').click();
        });
        
        // Add event listeners for record filters
        document.getElementById('record-type-filter').addEventListener('change', renderRecordsTab);
        document.getElementById('record-sort').addEventListener('change', renderRecordsTab);
        
        // Hook into workout saving to check for new PRs
        const originalAddWorkout = document.getElementById('submit-workout').onclick;
        document.getElementById('submit-workout').onclick = function() {
            if (originalAddWorkout) originalAddWorkout();
            
            // Check for PRs in the most recent workout
            if (workouts.length > 0) {
                checkForPersonalRecords(workouts[workouts.length - 1]);
            }
        };
        
        // Add mobile navigation
        const body = document.querySelector('body');
        const mobileNav = document.createElement('div');
        mobileNav.className = 'mobile-nav';
        mobileNav.innerHTML = `
            <div class="mobile-nav-tabs">
                <a href="#" class="mobile-nav-tab active" data-tab="workouts">
                    <i class="fas fa-dumbbell"></i>
                    <span>Workouts</span>
                </a>
                <a href="#" class="mobile-nav-tab" data-tab="exercise-library">
                    <i class="fas fa-book"></i>
                    <span>Exercises</span>
                </a>
                <a href="#" class="mobile-nav-tab" data-tab="goals">
                    <i class="fas fa-bullseye"></i>
                    <span>Goals</span>
                </a>
                <a href="#" class="mobile-nav-tab" data-tab="timer">
                    <i class="fas fa-stopwatch"></i>
                    <span>Timer</span>
                </a>
                <a href="#" class="mobile-nav-tab" data-tab="stats">
                    <i class="fas fa-chart-line"></i>
                    <span>Stats</span>
                </a>
                <a href="#" class="mobile-nav-tab" data-tab="records">
                    <i class="fas fa-trophy"></i>
                    <span>Records</span>
                </a>
                <a href="#" class="mobile-nav-tab" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        `;
        body.appendChild(mobileNav);
        
        // Initialize the records tab
        renderRecordsTab();
    </script>
</body>
</html>
